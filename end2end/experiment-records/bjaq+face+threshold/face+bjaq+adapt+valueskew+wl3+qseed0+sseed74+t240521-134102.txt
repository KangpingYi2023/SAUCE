Input arguments = Namespace(data_update='valueskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 74, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.21252703666687
tensor(0.9960)
result is  tensor(380643.6250)
Enter testHyper
ReportEsts: [1.180446743965149, 1.0554801225662231, 1.4182846546173096, 1.045272707939148, 1.2651785612106323, 1.140891671180725, 1.1573328971862793, 1.1576193571090698, 1.104007363319397, 1.0983989238739014, 1.0654608011245728, 1.1457626819610596, 1.1178786754608154, 1.0379464626312256, 1.1874723434448242, 1.4151439666748047, 1.4223755598068237, 1.1352732181549072, 1.2168946266174316, 1.0637755393981934, 1.1007802486419678, 1.0890610218048096, 1.1199833154678345, 1.0140876770019531, 1.0294861793518066, 1.0099457502365112, 1.091497778892517, 1.2992759943008423, 1.073537826538086, 1.0150748491287231, 1.147924780845642, 1.2526203393936157, 1.1806341409683228, 1.1014158725738525, 1.092818260192871, 1.18795907497406, 1.4676871299743652, 1.0334258079528809, 1.0439296960830688, 1.0611976385116577, 1.0095360279083252, 1.084784746170044, 1.0650044679641724, 1.0143157243728638, 1.067187786102295, 1.0226757526397705, 1.1067781448364258, 1.2766501903533936, 1.074134111404419, 1.1404399871826172, 1.1189320087432861, 1.277356743812561, 1.0996003150939941, 1.0286085605621338, 1.1241753101348877, 1.046360731124878, 1.2672897577285767, 1.1078755855560303, 1.0087205171585083, 1.3537774085998535, 1.343894362449646, 1.2190896272659302, 1.199032187461853, 1.0852917432785034, 1.2941176891326904, 1.0285714864730835, 1.1117020845413208, 1.0506728887557983, 1.1958503723144531, 1.221052646636963, 1.2234251499176025, 1.0370804071426392, 1.294904112815857, 1.1891826391220093, 1.1989102363586426, 1.0173730850219727, 1.83234441280365, 1.073338270187378, 1.000764012336731, 1.451577067375183, 1.1667702198028564, 1.156032919883728, 1.057640552520752, 1.2289930582046509, 1.2715870141983032, 1.2156087160110474, 1.00321626663208, 1.2357629537582397, 1.0819178819656372, 1.0714818239212036, 1.116966962814331, 1.411770224571228, 1.0183916091918945, 1.3307543992996216, 1.0209424495697021, 1.094049096107483, 1.1394336223602295, 1.331032633781433, 1.034482717514038, 1.2424867153167725, 1.175035834312439, 1.2475969791412354, 1.274709939956665, 1.0066323280334473, 1.0564854145050049, 1.0405042171478271, 1.0127829313278198, 1.1762652397155762, 1.0724624395370483, 1.004144549369812, 1.16567063331604, 1.0984067916870117, 1.278281331062317, 1.0237070322036743, 1.079749584197998, 1.164102554321289, 1.0686583518981934, 1.0810009241104126, 1.28597092628479, 1.0507172346115112, 1.2308425903320312, 1.08527672290802, 1.1606321334838867, 1.2672218084335327, 1.2238372564315796, 1.2119274139404297, 1.1625850200653076, 1.1147410869598389, 1.390639066696167, 1.146626591682434, 1.1806459426879883, 1.319337248802185, 1.1845866441726685, 1.5, 1.1443191766738892, 1.1522709131240845, 1.0615421533584595, 1.0565853118896484, 1.135860562324524, 1.2778891324996948, 1.1455522775650024, 1.0966817140579224, 1.1467249393463135, 1.289253830909729, 1.0374335050582886, 1.0116199254989624, 1.0554109811782837, 1.5979138612747192, 1.0047929286956787, 1.1095170974731445, 1.0386773347854614, 1.1676708459854126, 1.280145525932312, 1.0525823831558228, 1.0520453453063965, 1.1097842454910278, 1.1107672452926636, 1.00900399684906, 1.0483378171920776, 1.1930170059204102, 1.1301273107528687, 1.0765959024429321, 1.0704783201217651, 1.2510013580322266, 1.2372214794158936, 1.0806093215942383, 1.186279296875, 1.2094908952713013, 1.1329982280731201, 1.0262646675109863, 1.1008363962173462, 1.1274183988571167, 1.1818181276321411, 1.134871482849121, 1.0221389532089233, 1.2568687200546265, 1.0053737163543701, 1.1149846315383911, 1.116680383682251, 1.0099557638168335, 1.0115656852722168, 1.0185879468917847, 1.0343557596206665, 1.1123595237731934, 1.2318000793457031, 1.1025370359420776, 1.0586193799972534, 1.2085435390472412, 1.1342052221298218, 1.3879715204238892, 1.0892888307571411, 1.0896083116531372, 1.5136568546295166, 1.3602484464645386, 1.688228726387024, 1.2059738636016846, 1.032888650894165, 1.085714340209961, 1.005340814590454, 1.1548141241073608]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.677511215209961] ms
 --  Average per query NF    [1.363595724105835] ms
 --  Average per query vegas [2.313915491104126] ms
Mean [1.152]  Median [1.117]  95th [1.412]  99th [1.599]  max [1.832]
Mean [1.152]  Median [1.117]  95th [1.412]  99th [1.599]  max [1.832]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.840302 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=valueskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
ValueSample - START
ValueSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[2.9802322e-07 1.7881393e-07 5.9604645e-08 1.3952315e-02 1.3113022e-06]
Distance score: 0.0027908324263989925
SAUCE Drift detection: True
Detection latency: 0.0234s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.054042 | Model-update-time: 2.223592


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=valueskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.17497730255127
tensor(0.9964)
result is  tensor(456950.7188)
Enter testHyper
ReportEsts: [1.1842586994171143, 1.0356189012527466, 1.9887797832489014, 1.581146240234375, 1.2002474069595337, 1.2844105958938599, 1.2412374019622803, 1.02103590965271, 1.2333931922912598, 1.2391960620880127, 1.067361831665039, 3.010441541671753, 1.1599044799804688, 1.1231135129928589, 1.060469388961792, 1.0348801612854004, 1.5058060884475708, 1.4009793996810913, 1.1374479532241821, 1.2165018320083618, 1.0763778686523438, 1.610859751701355, 1.1297911405563354, 1.023517370223999, 1.013056755065918, 1.2257044315338135, 1.0597878694534302, 1.1937148571014404, 1.6485487222671509, 1.7588294744491577, 1.3875291347503662, 1.08695650100708, 1.1287764310836792, 1.032787799835205, 1.041052222251892, 1.135155200958252, 1.3953511714935303, 1.0375136137008667, 1.04221773147583, 1.0088930130004883, 1.2457493543624878, 1.0489977598190308, 8.3483304977417, 1.0470882654190063, 1.071048617362976, 1.0100899934768677, 1.4020395278930664, 1.0572843551635742, 1.399999976158142, 1.0554206371307373, 1.027139663696289, 1.1822346448898315, 1.0709128379821777, 1.0026646852493286, 1.0622040033340454, 1.774452567100525, 1.0810128450393677, 1.0915849208831787, 2.0882186889648438, 1.118723750114441, 1.8236775398254395, 1.0155737400054932, 1.0552942752838135, 1.8202400207519531, 1.0445680618286133, 1.0624604225158691, 1.4293767213821411, 1.0099976062774658, 1.0780088901519775, 1.0476009845733643, 1.4266186952590942, 1.6375911235809326, 1.2446449995040894, 1.0057322978973389, 1.0104081630706787, 2.4599123001098633, 1.1312140226364136, 1.1626758575439453, 1.3201825618743896, 1.2070480585098267, 1.188536524772644, 1.1559194326400757, 1.0524210929870605, 1.3461133241653442, 1.126530647277832, 1.289198637008667, 1.7312830686569214, 1.1233123540878296, 2.2981884479522705, 2.116330862045288, 1.0694329738616943, 1.4797585010528564, 1.1911280155181885, 1.345126748085022, 2.8442819118499756, 1.0536726713180542, 1.130337119102478, 1.3401579856872559, 1.0927717685699463, 1.2242573499679565, 1.2025612592697144, 1.0976824760437012, 1.6729412078857422, 1.0726209878921509, 1.0939167737960815, 1.0913691520690918, 1.0945593118667603, 1.065533995628357, 1.0458452701568604, 1.1011481285095215, 1.2094377279281616, 1.1190290451049805, 1.3518664836883545, 1.4241015911102295, 1.0859407186508179, 1.0783430337905884, 1.127921462059021, 2.592304229736328, 1.0979423522949219, 1.1504424810409546, 1.1745405197143555, 1.376323938369751, 1.1026461124420166, 1.5406275987625122, 1.054700255393982, 1.3780174255371094, 1.0820372104644775, 1.0290076732635498, 1.0154350996017456, 1.0277798175811768, 1.155225157737732, 1.1547521352767944, 1.1022744178771973, 1.2973620891571045, 4.657114505767822, 1.1424400806427002, 1.2488329410552979, 1.2070916891098022, 1.046543836593628, 1.0523862838745117, 1.0143300294876099, 1.095168113708496, 1.0361350774765015, 1.013266682624817, 1.0456126928329468, 1.1426337957382202, 1.2339180707931519, 1.1491042375564575, 1.0147770643234253, 1.0872052907943726, 37.10095977783203, 1.2295514345169067, 1.4877811670303345, 1.0904606580734253, 1.0250756740570068, 3.2586898803710938, 1.1506454944610596, 1.5573770999908447, 1.1053186655044556, 1.087553858757019, 1.0283087491989136, 1.2292392253875732, 1.069502592086792, 1.0451542139053345, 1.1865320205688477, 1.0153061151504517, 1.0462185144424438, 1.179162621498108, 1.0100210905075073, 1.592212438583374, 1.1030138731002808, 1.3899208307266235, 1.3852089643478394, 2.0976924896240234, 1.333380103111267, 1.0024033784866333, 1.0693309307098389, 1.044399380683899, 1.1886662244796753, 1.0183926820755005, 1.8684210777282715, 1.2362792491912842, 1.0213006734848022, 1.3097224235534668, 1.2618920803070068, 2.5889744758605957, 1.0320073366165161, 1.232041358947754, 1.3791662454605103, 1.1658812761306763, 1.0504599809646606, 1.0405046939849854, 1.20245361328125, 2.1938445568084717, 1.2097386121749878, 1.3125, 5.466111183166504, 2.2512004375457764, 1.0960265398025513, 1.2044044733047485]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7487757205963135] ms
 --  Average per query NF    [1.3611865043640137] ms
 --  Average per query vegas [2.3875892162323] ms
Mean [1.524]  Median [1.143]  95th [2.306]  99th [5.495]  max [37.101]
Mean [1.524]  Median [1.143]  95th [2.306]  99th [5.495]  max [37.101]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.401226 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.575927