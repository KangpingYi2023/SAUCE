Input arguments = Namespace(data_update='tupleskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 49, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.167244672775269
tensor(0.9942)
result is  tensor(379943.7812)
Enter testHyper
ReportEsts: [1.0994325876235962, 1.068473219871521, 1.3049659729003906, 1.0831754207611084, 1.2499264478683472, 1.1118465662002563, 1.3022310733795166, 1.1851096153259277, 1.0913214683532715, 1.1033507585525513, 1.0645995140075684, 1.1105931997299194, 1.0224440097808838, 1.0245535373687744, 1.141156792640686, 1.3795965909957886, 1.431115746498108, 1.2105700969696045, 1.1959203481674194, 1.0892857313156128, 1.2168797254562378, 1.152495265007019, 1.1394119262695312, 1.0397893190383911, 1.2185739278793335, 1.1103074550628662, 1.1345720291137695, 1.5214319229125977, 1.0260848999023438, 1.105380892753601, 1.1784321069717407, 1.091117262840271, 1.0017553567886353, 1.0142216682434082, 1.1441278457641602, 1.1328051090240479, 1.2770925760269165, 1.1347932815551758, 1.0581772327423096, 1.2605987787246704, 1.0542409420013428, 1.137639045715332, 1.13392174243927, 1.0512549877166748, 1.075005292892456, 1.0986394882202148, 1.054556131362915, 1.2673805952072144, 1.1548908948898315, 1.059221625328064, 1.2099738121032715, 1.2769696712493896, 1.0425543785095215, 1.235937476158142, 1.3896088600158691, 1.0091228485107422, 1.1196261644363403, 1.2458384037017822, 1.1053599119186401, 1.4637681245803833, 1.1997123956680298, 1.1696903705596924, 1.2194124460220337, 1.104126214981079, 1.3043478727340698, 1.2000000476837158, 1.1256732940673828, 1.0539228916168213, 1.0104597806930542, 1.3473684787750244, 1.063301920890808, 1.0445388555526733, 1.2829383611679077, 1.042117953300476, 1.1172301769256592, 1.0439927577972412, 1.8577607870101929, 1.0020757913589478, 1.0371079444885254, 1.4503298997879028, 1.235907793045044, 1.053464651107788, 1.0387260913848877, 1.2263476848602295, 1.3021904230117798, 1.1607909202575684, 1.0722516775131226, 1.0603278875350952, 1.0081355571746826, 1.009121298789978, 1.0737359523773193, 1.3333039283752441, 1.037411093711853, 1.3107882738113403, 1.1142857074737549, 1.1655709743499756, 1.126591444015503, 1.2294740676879883, 1.0909091234207153, 1.209811806678772, 1.1852388381958008, 1.1422386169433594, 1.1018930673599243, 1.0081180334091187, 1.053033471107483, 1.0338339805603027, 1.1071795225143433, 1.2233856916427612, 1.1246345043182373, 1.0062168836593628, 1.0388233661651611, 1.0821791887283325, 1.0938893556594849, 1.0567936897277832, 1.1152197122573853, 1.0460829734802246, 1.111935019493103, 1.0175416469573975, 1.2579402923583984, 1.179056167602539, 1.2402997016906738, 1.091831088066101, 1.0342735052108765, 1.1956794261932373, 1.2010658979415894, 1.2180148363113403, 1.11715567111969, 1.2960344552993774, 1.338821530342102, 1.0814963579177856, 1.0803000926971436, 1.016737699508667, 1.31292724609375, 1.5, 1.1066802740097046, 1.1388815641403198, 1.0068628787994385, 1.2253658771514893, 1.073474645614624, 1.3013604879379272, 1.1294240951538086, 1.02979576587677, 1.01495361328125, 1.2159500122070312, 1.0226261615753174, 1.1535890102386475, 1.1318483352661133, 1.5214219093322754, 1.05784273147583, 1.0330153703689575, 1.1091729402542114, 1.1399821043014526, 1.355531096458435, 1.0991253852844238, 1.126050591468811, 1.034902572631836, 1.0437405109405518, 1.0104107856750488, 1.1262803077697754, 1.0967472791671753, 1.0710285902023315, 1.0038801431655884, 1.0123337507247925, 1.3178621530532837, 1.0976743698120117, 1.0685395002365112, 1.0653507709503174, 1.2644773721694946, 1.2081878185272217, 1.0302616357803345, 1.0649665594100952, 1.0273338556289673, 1.1688311100006104, 1.1464080810546875, 1.0269324779510498, 1.0925689935684204, 1.025753140449524, 1.2382887601852417, 1.1232935190200806, 1.051677942276001, 1.1847975254058838, 1.0070186853408813, 1.0332127809524536, 1.0847803354263306, 1.0916334390640259, 1.1226215362548828, 1.0528945922851562, 1.344685673713684, 1.0055108070373535, 1.0898085832595825, 1.0453219413757324, 1.0468499660491943, 1.5080580711364746, 1.2467821836471558, 1.9370800256729126, 1.0521172285079956, 1.1548562049865723, 1.1692308187484741, 1.0510820150375366, 1.1217795610427856]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7602198123931885] ms
 --  Average per query NF    [1.3669705390930176] ms
 --  Average per query vegas [2.393249273300171] ms
Mean [1.147]  Median [1.111]  95th [1.380]  99th [1.525]  max [1.937]
Mean [1.147]  Median [1.111]  95th [1.380]  99th [1.525]  max [1.937]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.841142 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=tupleskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
TupleSkewSample - START
0.001
TupleSkewSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[2.6226044e-06 1.9139051e-04 4.8577785e-05 1.0192394e-05 1.0609627e-05]
Distance score: 5.267858432489447e-05
SAUCE Drift detection: True
Detection latency: 0.0240s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.004711 | Model-update-time: 2.252665


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=tupleskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.160911321640015
tensor(0.9974)
result is  tensor(457405.4688)
Enter testHyper
ReportEsts: [1.1470832824707031, 1.017349362373352, 1.5232876539230347, 1.5376983880996704, 1.0139516592025757, 1.0308388471603394, 1.2640502452850342, 1.0769107341766357, 1.1407616138458252, 1.2370061874389648, 1.0249391794204712, 1.2870813608169556, 1.0826873779296875, 1.2551900148391724, 1.001263976097107, 1.0222034454345703, 1.4728761911392212, 1.1154853105545044, 1.0246707201004028, 1.3503121137619019, 1.0626155138015747, 1.1556447744369507, 1.0953843593597412, 1.1230254173278809, 1.2420375347137451, 1.237657070159912, 1.14332914352417, 1.3327711820602417, 1.4182589054107666, 1.129357099533081, 1.4005235433578491, 1.5, 1.0698578357696533, 1.6731703281402588, 1.0243154764175415, 1.249494194984436, 1.1654022932052612, 1.0064440965652466, 1.5036122798919678, 1.0456438064575195, 1.1393331289291382, 1.2605364322662354, 1.117626667022705, 1.1079591512680054, 1.058347463607788, 1.1618472337722778, 1.2602570056915283, 1.152509093284607, 1.3809523582458496, 1.0067216157913208, 1.0551351308822632, 1.0788930654525757, 1.0082778930664062, 1.0432738065719604, 1.1127207279205322, 1.5685994625091553, 1.1111198663711548, 1.081729531288147, 1.2383196353912354, 1.0661351680755615, 1.2099323272705078, 1.0968955755233765, 1.047897219657898, 1.2192001342773438, 1.0372495651245117, 1.0337496995925903, 1.347290277481079, 1.003459095954895, 1.1139694452285767, 1.041131854057312, 1.1255747079849243, 1.1631938219070435, 1.1422407627105713, 1.1274493932724, 1.100160837173462, 1.3080081939697266, 1.217003345489502, 1.2209957838058472, 1.1755030155181885, 1.0734002590179443, 1.0222371816635132, 1.0221306085586548, 1.0364793539047241, 1.0527963638305664, 1.4403388500213623, 1.1076923608779907, 1.1239352226257324, 1.3386993408203125, 1.2670568227767944, 1.3562809228897095, 1.2105131149291992, 1.0558298826217651, 1.2148709297180176, 1.220077633857727, 1.1001241207122803, 1.1045129299163818, 1.0951899290084839, 1.2727701663970947, 1.023371696472168, 1.0744657516479492, 1.2362295389175415, 1.1744619607925415, 1.0303030014038086, 1.4800788164138794, 1.1055395603179932, 1.4506022930145264, 1.0409460067749023, 1.2700706720352173, 1.0257879495620728, 1.025128722190857, 1.225472092628479, 1.1616941690444946, 1.0553175210952759, 1.203526258468628, 1.2423481941223145, 1.0118422508239746, 1.165310025215149, 1.320212483406067, 1.2214275598526, 2.771186351776123, 1.0308767557144165, 1.3121495246887207, 1.0177284479141235, 1.5098038911819458, 1.0623775720596313, 1.2482951879501343, 1.1473925113677979, 1.068145751953125, 1.1116150617599487, 1.038975715637207, 1.1387969255447388, 1.2081310749053955, 1.191309928894043, 1.2797619104385376, 1.3795348405838013, 1.3410295248031616, 1.0872782468795776, 1.0474259853363037, 1.0675737857818604, 1.0070390701293945, 1.026900291442871, 1.0254287719726562, 1.0838271379470825, 1.190900206565857, 1.1069927215576172, 1.071191430091858, 1.178770899772644, 1.0704702138900757, 1.2658430337905884, 1.089565634727478, 1.0695022344589233, 1.0824435949325562, 1.010679841041565, 1.1113393306732178, 1.0431243181228638, 1.3409271240234375, 1.0933831930160522, 1.0873016119003296, 1.1250603199005127, 1.00943922996521, 1.0078877210617065, 1.365476131439209, 1.4761793613433838, 1.1717146635055542, 1.1494921445846558, 1.0529899597167969, 1.2116237878799438, 1.0229830741882324, 1.0566191673278809, 1.1815263032913208, 1.0087342262268066, 1.0437811613082886, 1.9821937084197998, 1.0579670667648315, 1.0207730531692505, 1.0353325605392456, 1.289347529411316, 1.0805844068527222, 1.1662482023239136, 1.1269372701644897, 1.7894736528396606, 1.1974393129348755, 1.0110199451446533, 1.6003972291946411, 1.2828844785690308, 1.2609812021255493, 1.0712393522262573, 1.0494379997253418, 1.32561194896698, 1.012553095817566, 1.1520694494247437, 1.1588561534881592, 1.3148624897003174, 1.737810492515564, 1.0137622356414795, 1.0376523733139038, 1.3419852256774902, 1.0214499235153198, 1.0575079917907715, 1.111360788345337]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.719538450241089] ms
 --  Average per query NF    [1.3551890850067139] ms
 --  Average per query vegas [2.364349365234375] ms
Mean [1.179]  Median [1.123]  95th [1.504]  99th [1.791]  max [2.771]
Mean [1.179]  Median [1.123]  95th [1.504]  99th [1.791]  max [2.771]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.382222 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.506010