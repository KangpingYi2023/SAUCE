Input arguments = Namespace(data_update='valueskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 17, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.162094354629517
tensor(0.9995)
result is  tensor(381979.9375)
Enter testHyper
ReportEsts: [1.2401707172393799, 1.0053142309188843, 1.2830768823623657, 1.2693198919296265, 1.2343205213546753, 1.0980556011199951, 1.2863335609436035, 1.0602153539657593, 1.0699673891067505, 1.1613595485687256, 1.0430662631988525, 1.2016949653625488, 1.0324993133544922, 1.0647321939468384, 1.0272529125213623, 1.1989976167678833, 1.2982478141784668, 1.2328978776931763, 1.2311574220657349, 1.15816330909729, 1.0840215682983398, 1.0566349029541016, 1.1476666927337646, 1.0111780166625977, 1.0410029888153076, 1.2251355648040771, 1.113738775253296, 1.3554342985153198, 1.0226917266845703, 1.0706946849822998, 1.1706278324127197, 1.238567590713501, 1.0305646657943726, 1.0362902879714966, 1.1444984674453735, 1.1473292112350464, 1.4420204162597656, 1.2114876508712769, 1.0629658699035645, 1.1174850463867188, 1.071964144706726, 1.110304832458496, 1.058634877204895, 1.0361639261245728, 1.0684555768966675, 1.0124716758728027, 1.1099557876586914, 1.3950049877166748, 1.0321643352508545, 1.0795261859893799, 1.2425875663757324, 1.3739811182022095, 1.016754388809204, 1.3289650678634644, 1.0606149435043335, 1.0020862817764282, 1.249532699584961, 1.2112334966659546, 1.3826171159744263, 1.385286808013916, 1.34642493724823, 1.1275526285171509, 1.3650308847427368, 1.0533698797225952, 1.1827956438064575, 1.1428571939468384, 1.1246637105941772, 1.0946331024169922, 1.1704622507095337, 1.5263158082962036, 1.1520514488220215, 1.0379778146743774, 1.2052761316299438, 1.0740361213684082, 1.0371387004852295, 1.11514151096344, 1.7405906915664673, 1.0352879762649536, 1.0814063549041748, 1.5350877046585083, 1.0585607290267944, 1.0443657636642456, 1.0411558151245117, 1.1785529851913452, 1.2122089862823486, 1.0711302757263184, 1.1282899379730225, 1.1195964813232422, 1.0351933240890503, 1.005587100982666, 1.0961450338363647, 1.4150749444961548, 1.0234403610229492, 1.325945496559143, 1.0103627443313599, 1.1728876829147339, 1.0863194465637207, 1.378482460975647, 1.0, 1.128920555114746, 1.2008798122406006, 1.0853692293167114, 1.0197491645812988, 1.002936840057373, 1.0688284635543823, 1.0141113996505737, 1.2197985649108887, 1.2198952436447144, 1.1001225709915161, 1.0, 1.1512722969055176, 1.123681664466858, 1.058294415473938, 1.0129108428955078, 1.094007134437561, 1.1464647054672241, 1.0899434089660645, 1.0050302743911743, 1.4031236171722412, 1.0475293397903442, 1.3105337619781494, 1.1077687740325928, 1.1316263675689697, 1.1326125860214233, 1.2911821603775024, 1.1698307991027832, 1.1161829233169556, 1.2866852283477783, 1.3137755393981934, 1.1152304410934448, 1.077662467956543, 1.134393334388733, 1.2423865795135498, 1.4642857313156128, 1.0305460691452026, 1.0538198947906494, 1.0681442022323608, 1.140487790107727, 1.0783642530441284, 1.1174064874649048, 1.0960724353790283, 1.0894434452056885, 1.185387134552002, 1.2846275568008423, 1.0009856224060059, 1.0146257877349854, 1.0444813966751099, 1.6866838932037354, 1.0074557065963745, 1.1110085248947144, 1.3762885332107544, 1.189719319343567, 1.3393148183822632, 1.068762183189392, 1.1754494905471802, 1.0526221990585327, 1.0282032489776611, 1.0194147825241089, 1.0655361413955688, 1.2472097873687744, 1.2880053520202637, 1.1294257640838623, 1.0040689706802368, 1.276566743850708, 1.2259740829467773, 1.019538164138794, 1.0278551578521729, 1.136284351348877, 1.1804651021957397, 1.061783790588379, 1.0547974109649658, 1.1438902616500854, 1.097402572631836, 1.1408348083496094, 1.049386978149414, 1.0739314556121826, 1.0208333730697632, 1.1845712661743164, 1.0778356790542603, 1.1694186925888062, 1.059414267539978, 1.0096529722213745, 1.0234872102737427, 1.100102186203003, 1.1376312971115112, 1.07716703414917, 1.0288467407226562, 1.2325900793075562, 1.1618858575820923, 1.4101766347885132, 1.0868754386901855, 1.0162907838821411, 1.6183725595474243, 1.3410543203353882, 1.9011931419372559, 1.0808700323104858, 1.134347677230835, 1.1343283653259277, 1.0560723543167114, 1.1215803623199463]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.661627769470215] ms
 --  Average per query NF    [1.358652114868164] ms
 --  Average per query vegas [2.302975654602051] ms
Mean [1.152]  Median [1.115]  95th [1.403]  99th [1.687]  max [1.901]
Mean [1.152]  Median [1.115]  95th [1.403]  99th [1.687]  max [1.901]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.784272 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=valueskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
ValueSample - START
ValueSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[5.9604645e-08 1.2324750e-02 8.3446503e-07 5.9604645e-07 9.5367432e-07]
Distance score: 0.0024654387962073088
SAUCE Drift detection: True
Detection latency: 0.0232s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.041600 | Model-update-time: 2.225579


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=valueskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.168410062789917
tensor(0.9949)
result is  tensor(456256.2188)
Enter testHyper
ReportEsts: [1.1725937128067017, 1.2138839960098267, 1.2907153367996216, 2.5914382934570312, 1.0625989437103271, 2.7826778888702393, 1.1377904415130615, 1.1363599300384521, 10.60444450378418, 1.1554887294769287, 1.0509145259857178, 1.2779085636138916, 1.1380090713500977, 1.1444557905197144, 4.834810256958008, 1.030803918838501, 1.5698254108428955, 1.057201862335205, 1.073479413986206, 1.2756329774856567, 1.3673198223114014, 1.9478946924209595, 1.0567965507507324, 1.1419591903686523, 1.154404878616333, 1.17998206615448, 1.1128857135772705, 1.3147835731506348, 2.669010639190674, 1.0670732259750366, 1.3805360794067383, 1.3785713911056519, 2.9790375232696533, 1.0531682968139648, 1.2454406023025513, 1.2057806253433228, 1.2747477293014526, 1.0454974174499512, 1.2675114870071411, 1.0408308506011963, 1.1850733757019043, 1.189016580581665, 1.2204419374465942, 1.0656360387802124, 1.1156747341156006, 1.0329937934875488, 1.2702443599700928, 1.139371395111084, 1.2952381372451782, 1.2014797925949097, 1.1765711307525635, 1.215343713760376, 1.0066158771514893, 1.013841152191162, 1.020971417427063, 1.4607045650482178, 1.2088007926940918, 1.197156310081482, 1.0161981582641602, 1.0811264514923096, 1.6165049076080322, 1.0448940992355347, 1.0126639604568481, 1.5689655542373657, 1.0095536708831787, 1.366552472114563, 1.3743464946746826, 1.0640448331832886, 1.186009168624878, 1.3492175340652466, 1.0974152088165283, 1.036619782447815, 1.0909624099731445, 1.0122604370117188, 1.1879855394363403, 1.0418018102645874, 525.0, 5.630889892578125, 1.3373903036117554, 1.175641655921936, 1.1948134899139404, 1.2578768730163574, 1.0878745317459106, 1.0830035209655762, 1.3521634340286255, 1.697872281074524, 1.782370924949646, 1.26188063621521, 1.1067627668380737, 1.0529028177261353, 1.0542185306549072, 1.0421466827392578, 1.4255410432815552, 1.080436110496521, 15.176605224609375, 1.1743090152740479, 1.040710210800171, 1.0031152963638306, 1.0159502029418945, 1.2827779054641724, 1.1495126485824585, 1.3685272932052612, 1.169451117515564, 1.3883330821990967, 1.0409393310546875, 1.171829342842102, 1.0150384902954102, 1.0331116914749146, 1.3303571939468384, 1.0323683023452759, 1.145117998123169, 1.05738365650177, 1.137930989265442, 1.2154549360275269, 1.2834922075271606, 1.0030109882354736, 1.2643873691558838, 1.09751296043396, 1.0950113534927368, 1.0697674751281738, 1.1226649284362793, 1.0532662868499756, 1.0710941553115845, 1.4572077989578247, 1.1653518676757812, 1.1534817218780518, 1.072279691696167, 1.2691705226898193, 1.263522744178772, 1.0208183526992798, 1.295401930809021, 1.3309295177459717, 1.082006573677063, 1.596969723701477, 1.363051414489746, 1.0755606889724731, 1.0585776567459106, 1.0266492366790771, 1.244879126548767, 1.177701473236084, 1.06416654586792, 1.0655930042266846, 1.201612949371338, 1.081679105758667, 1.0218185186386108, 4.056781768798828, 1.3024691343307495, 1.0031185150146484, 1.0316647291183472, 1.032265543937683, 1.145632266998291, 1.078247308731079, 1.0961458683013916, 1.1813430786132812, 1.2349175214767456, 1.4445509910583496, 1.068367600440979, 1.0703125, 1.037536382675171, 1.1028528213500977, 1.092664122581482, 1.1357142925262451, 1.1017310619354248, 1.2269107103347778, 1.0602829456329346, 7.139534950256348, 1.2403773069381714, 1.1858564615249634, 1259.0, 1.0185387134552002, 1.012588381767273, 1.199750542640686, 1.384792685508728, 1.0716170072555542, 1.1456032991409302, 1.2523919343948364, 1.2269803285598755, 1.333245038986206, 1.043684959411621, 1.0376211404800415, 2.0, 1.0111358165740967, 3.137805938720703, 1.3566906452178955, 1.2092267274856567, 1.0072481632232666, 5.920634746551514, 1.222596526145935, 1.3745753765106201, 1.021074891090393, 1.0923433303833008, 1.4442442655563354, 1.1013927459716797, 1.4780148267745972, 1.0231292247772217, 1.0793042182922363, 1.269564151763916, 1.172666072845459, 1.5952380895614624, 1.0959631204605103]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7385189533233643] ms
 --  Average per query NF    [1.356903314590454] ms
 --  Average per query vegas [2.38161563873291] ms
Mean [10.359]  Median [1.160]  95th [2.987]  99th [20.275]  max [1259.000]
Mean [10.359]  Median [1.160]  95th [2.987]  99th [20.275]  max [1259.000]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.417972 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.537401