Input arguments = Namespace(data_update='valueskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 9, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.16792917251587
tensor(0.9963)
result is  tensor(380745.5312)
Enter testHyper
ReportEsts: [1.1818181276321411, 1.0756367444992065, 1.2251733541488647, 1.1134976148605347, 1.2289679050445557, 1.1315312385559082, 1.2957183122634888, 1.1504757404327393, 1.0712378025054932, 1.1194119453430176, 1.1309216022491455, 1.1404660940170288, 1.0695503950119019, 1.0401785373687744, 1.160339117050171, 1.3897929191589355, 1.4211479425430298, 1.158907413482666, 1.150091290473938, 1.0102040767669678, 1.0094131231307983, 1.0591795444488525, 1.1358076333999634, 1.0742684602737427, 1.0599526166915894, 1.0967450141906738, 1.107826590538025, 1.325944185256958, 1.0859872102737427, 1.008307695388794, 1.1599857807159424, 1.1590064764022827, 1.1463040113449097, 1.0229051113128662, 1.140009880065918, 1.094200611114502, 1.1609447002410889, 1.1124322414398193, 1.0361422300338745, 1.2289820909500122, 1.044308066368103, 1.051886796951294, 1.0718740224838257, 1.0707248449325562, 1.0735262632369995, 1.0839002132415771, 1.059869647026062, 1.2834558486938477, 1.0750830173492432, 1.0524535179138184, 1.2163587808609009, 1.3925974369049072, 1.1841696500778198, 1.140097975730896, 1.0355207920074463, 1.0069540739059448, 1.286915898323059, 1.1356321573257446, 1.0231271982192993, 1.3704769611358643, 1.309576153755188, 1.2054411172866821, 1.3687430620193481, 1.1331082582473755, 1.2595419883728027, 1.2285714149475098, 1.175257682800293, 1.0648025274276733, 1.0627148151397705, 1.2842105627059937, 1.0596760511398315, 1.0369207859039307, 1.3036800622940063, 1.0726518630981445, 1.0841996669769287, 1.2276508808135986, 2.094210624694824, 1.0239107608795166, 1.0861492156982422, 1.231350302696228, 1.0645639896392822, 1.283637523651123, 1.1364010572433472, 1.103874921798706, 1.2672368288040161, 1.1708688735961914, 1.0762399435043335, 1.0729382038116455, 1.0109487771987915, 1.0788623094558716, 1.0134888887405396, 1.3707937002182007, 1.0292102098464966, 1.2500567436218262, 1.101694941520691, 1.0979399681091309, 1.0913187265396118, 1.1761209964752197, 1.034482717514038, 1.1508285999298096, 1.27173912525177, 1.0528005361557007, 1.0160516500473022, 1.002936840057373, 1.0830544233322144, 1.0517805814743042, 1.1224955320358276, 1.1815009117126465, 1.0520647764205933, 1.0025328397750854, 1.2948709726333618, 1.0882079601287842, 1.1604028940200806, 1.0427460670471191, 1.1772342920303345, 1.1761658191680908, 1.0554953813552856, 1.0657809972763062, 1.150352120399475, 1.0745302438735962, 1.2913999557495117, 1.1470263004302979, 1.1242915391921997, 1.2292627096176147, 1.200581431388855, 1.1824184656143188, 1.0805058479309082, 1.1752092838287354, 1.3060016632080078, 1.1102204322814941, 1.145243525505066, 1.1656216382980347, 1.2694220542907715, 1.4642857313156128, 1.0393755435943604, 1.0362299680709839, 1.0246667861938477, 1.1830893754959106, 1.0300263166427612, 1.3165863752365112, 1.1277315616607666, 1.1683685779571533, 1.0700393915176392, 1.1195197105407715, 1.1937270164489746, 1.0332404375076294, 1.0700531005859375, 1.4477771520614624, 1.09549880027771, 1.0671875476837158, 1.1588256359100342, 1.143955945968628, 1.294952630996704, 1.1833490133285522, 1.227060079574585, 1.0738499164581299, 1.2813762426376343, 1.0162997245788574, 1.0298212766647339, 1.1023575067520142, 1.0991284847259521, 1.1319255828857422, 1.1635979413986206, 1.3031989336013794, 1.1291866302490234, 1.1655898094177246, 1.132710337638855, 1.26593017578125, 1.0543758869171143, 1.081408143043518, 1.0570920705795288, 1.0149253606796265, 1.1428571939468384, 1.228278398513794, 1.0596048831939697, 1.19655442237854, 1.0249004364013672, 1.3115088939666748, 1.206818699836731, 1.0000388622283936, 1.0501110553741455, 1.0145306587219238, 1.024592399597168, 1.092952013015747, 1.116986632347107, 1.1405919790267944, 1.0990512371063232, 1.2607017755508423, 1.064347267150879, 1.3793740272521973, 1.0740810632705688, 1.0131129026412964, 1.5811634063720703, 1.3631935119628906, 1.537305474281311, 1.1653637886047363, 1.1556065082550049, 1.1875, 1.0227999687194824, 1.0814409255981445]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.748462200164795] ms
 --  Average per query NF    [1.3599872589111328] ms
 --  Average per query vegas [2.388474941253662] ms
Mean [1.149]  Median [1.126]  95th [1.370]  99th [1.538]  max [2.094]
Mean [1.149]  Median [1.126]  95th [1.370]  99th [1.538]  max [2.094]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.814159 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=valueskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
ValueSample - START
ValueSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[1.0442078e-02 4.1723251e-07 8.3446503e-07 9.5367432e-07 0.0000000e+00]
Distance score: 0.002088856650516391
SAUCE Drift detection: True
Detection latency: 0.0238s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.044564 | Model-update-time: 2.227954


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=valueskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.165961265563965
tensor(0.9936)
result is  tensor(455652.6875)
Enter testHyper
ReportEsts: [1.0502755641937256, 1.027239203453064, 1.0949008464813232, 1.153030514717102, 1.2309422492980957, 1.0, 1.2052510976791382, 1.075872778892517, 4.0340986251831055, 1.2299257516860962, 1.0445986986160278, 1.0716685056686401, 1.016990303993225, 1.1377638578414917, 115.68367004394531, 1.223262906074524, 1.3430523872375488, 1.163061499595642, 1.012931227684021, 1.304996371269226, 1.2551850080490112, 1.6828703880310059, 1.146997094154358, 1.1925784349441528, 1.1454758644104004, 1.4358419179916382, 1.0568767786026, 1.1662719249725342, 1.3058985471725464, 1.325454592704773, 1.0890178680419922, 1.2323943376541138, 1.0004111528396606, 1.006847858428955, 1.0858099460601807, 1.0447577238082886, 1.059077501296997, 1.202953577041626, 1.1644227504730225, 1.193414330482483, 1.0623928308486938, 1.0117772817611694, 21.845144271850586, 1.0745795965194702, 1.0099925994873047, 1.1546363830566406, 1.2339935302734375, 1.391680121421814, 1.0038909912109375, 1.442136526107788, 1.0627377033233643, 1.014809012413025, 1.2576993703842163, 1.2284412384033203, 1.2700527906417847, 1.1668027639389038, 1.2161052227020264, 1.126248836517334, 1.0392935276031494, 1.1228924989700317, 1.4125560522079468, 1.1515063047409058, 2.3640873432159424, 1.7693625688552856, 1.0011783838272095, 1.0307865142822266, 1.3723434209823608, 1.1921635866165161, 1.2544889450073242, 1.3552751541137695, 1.0252424478530884, 1.2904459238052368, 1.0207358598709106, 1.0656863451004028, 1.0866389274597168, 1.2027027606964111, 10.444681167602539, 1.0405049324035645, 1.1370370388031006, 1.0889564752578735, 1.1433765888214111, 1.0, 1.2695796489715576, 1.0301281213760376, 1.1163455247879028, 1.2999999523162842, 1.2737939357757568, 1.5511730909347534, 1.3102695941925049, 1.4784170389175415, 1.089836835861206, 1.2931573390960693, 1.4639185667037964, 1.077500820159912, 1.0835487842559814, 1.0410484075546265, 3.3138625621795654, 1.0375465154647827, 1.4236935377120972, 1.2291561365127563, 1.4224233627319336, 1.0811591148376465, 1.0882352590560913, 1.253425121307373, 1.136084794998169, 1.7074614763259888, 1.0512531995773315, 1.0032992362976074, 1.2309941053390503, 1.0864542722702026, 1.3056726455688477, 1.126573085784912, 1.2907673120498657, 1.2270766496658325, 1.1715481281280518, 1.3550026416778564, 1.0444186925888062, 1.2007626295089722, 1.431288480758667, 1.0800000429153442, 1.0560221672058105, 1.1008230447769165, 3.583585262298584, 4.203610897064209, 1.041041374206543, 1.0919501781463623, 1.23135244846344, 1.053125023841858, 1.001710295677185, 1.048272728919983, 1.2839813232421875, 1.0954654216766357, 1.1474192142486572, 1.0045592784881592, 1.643784761428833, 1.0917072296142578, 1.1659504175186157, 1.2371950149536133, 1.287574052810669, 1.0967298746109009, 1.131278157234192, 1.0648127794265747, 1.2409977912902832, 1.06693696975708, 1.653706431388855, 1.0657938718795776, 1.575757622718811, 1.1851532459259033, 1.0043631792068481, 1.2793749570846558, 1.0485742092132568, 1.138710856437683, 1.1530723571777344, 1.0730019807815552, 1.0348291397094727, 1.2707774639129639, 1.3232214450836182, 1.0703125, 1.0062313079833984, 1.5397815704345703, 2.0647850036621094, 1.3196429014205933, 1.0604469776153564, 1.1732581853866577, 1.274986743927002, 1.3852657079696655, 1.0095949172973633, 1.10739004611969, 8.282782554626465, 1.027060866355896, 1.1678153276443481, 1.1669539213180542, 1.5188343524932861, 1.1719456911087036, 1.042510986328125, 1.0025622844696045, 1.2181144952774048, 1.0911509990692139, 1.0589154958724976, 1.2594726085662842, 1.3777778148651123, 1.1695659160614014, 1.1128865480422974, 1.3761507272720337, 2.058138132095337, 1.2246370315551758, 2.0473685264587402, 1.183720588684082, 1.2254537343978882, 1.1327370405197144, 2.2842745780944824, 1.0522648096084595, 1.1582289934158325, 2.1167619228363037, 1.1324836015701294, 1.4468084573745728, 1.600757360458374, 1.0412392616271973, 1.226209044456482, 1.021059274673462]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.744950294494629] ms
 --  Average per query NF    [1.355811357498169] ms
 --  Average per query vegas [2.38913893699646] ms
Mean [2.023]  Median [1.165]  95th [2.125]  99th [10.559]  max [115.684]
Mean [2.023]  Median [1.165]  95th [2.125]  99th [10.559]  max [115.684]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.380942 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.516955