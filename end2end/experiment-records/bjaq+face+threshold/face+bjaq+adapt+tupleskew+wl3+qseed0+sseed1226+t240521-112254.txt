Input arguments = Namespace(data_update='tupleskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 1226, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.15355110168457
tensor(0.9939)
result is  tensor(379818.6562)
Enter testHyper
ReportEsts: [1.0719177722930908, 1.0379666090011597, 1.3082411289215088, 1.0082802772521973, 1.2462620735168457, 1.1628650426864624, 1.2436734437942505, 1.1362413167953491, 1.0693333148956299, 1.110922932624817, 1.0534021854400635, 1.0944914817810059, 1.0170402526855469, 1.0825892686843872, 1.1151026487350464, 1.3078882694244385, 1.3272522687911987, 1.1029691696166992, 1.1395208835601807, 1.038265347480774, 1.109005331993103, 1.1322789192199707, 1.0958291292190552, 1.0268125534057617, 1.068038821220398, 1.0379747152328491, 1.091497778892517, 1.316218376159668, 1.0380258560180664, 1.006306529045105, 1.112805962562561, 1.2136812210083008, 1.15354585647583, 1.014549970626831, 1.2309751510620117, 1.05561363697052, 1.3871889114379883, 1.0454155206680298, 1.0013329982757568, 1.0366467237472534, 1.0359333753585815, 1.0362844467163086, 1.063665747642517, 1.0268981456756592, 1.1166279315948486, 1.00453519821167, 1.0909091234207153, 1.2111015319824219, 1.0247766971588135, 1.162436604499817, 1.2131578922271729, 1.3099160194396973, 1.0140749216079712, 1.120396614074707, 1.1188737154006958, 1.024459719657898, 1.3093458414077759, 1.1777377128601074, 1.197204828262329, 1.415286660194397, 1.4020167589187622, 1.2032856941223145, 1.4536100625991821, 1.038007140159607, 1.3360323905944824, 1.1428571939468384, 1.2590361833572388, 1.058013916015625, 1.2327240705490112, 1.263157844543457, 1.1883364915847778, 1.0081795454025269, 1.15495765209198, 1.183518886566162, 1.2497191429138184, 1.0643173456192017, 2.069276809692383, 1.079148769378662, 1.0326614379882812, 1.3420796394348145, 1.2080693244934082, 1.0122759342193604, 1.0040534734725952, 1.258547067642212, 1.1966948509216309, 1.0867749452590942, 1.2653874158859253, 1.2234047651290894, 1.088486909866333, 1.0332531929016113, 1.1130027770996094, 1.1870090961456299, 1.0054386854171753, 1.2978070974349976, 1.0317460298538208, 1.07999849319458, 1.11074960231781, 1.183477520942688, 1.0, 1.1466155052185059, 1.1265474557876587, 1.1553966999053955, 1.0618804693222046, 1.0051244497299194, 1.0020920038223267, 1.0538374185562134, 1.3172379732131958, 1.1867364645004272, 1.104888677597046, 1.064721703529358, 1.0591981410980225, 1.0973782539367676, 1.1563793420791626, 1.0831021070480347, 1.1217108964920044, 1.101941704750061, 1.0718899965286255, 1.1536179780960083, 1.2774266004562378, 1.0036709308624268, 1.2189918756484985, 1.0768593549728394, 1.208975076675415, 1.2327463626861572, 1.3047480583190918, 1.1566240787506104, 1.0967626571655273, 1.1159050464630127, 1.2510120868682861, 1.1122244596481323, 1.1235566139221191, 1.2650400400161743, 1.2495338916778564, 1.5, 1.12787926197052, 1.0336499214172363, 1.0449950695037842, 1.098211407661438, 1.0071887969970703, 1.36350679397583, 1.1165812015533447, 1.15329110622406, 1.2941527366638184, 1.0744297504425049, 1.0371084213256836, 1.0372107028961182, 1.0583949089050293, 1.4126510620117188, 1.0689853429794312, 1.1336647272109985, 1.1956647634506226, 1.1884373426437378, 1.2963157892227173, 1.1217955350875854, 1.0183361768722534, 1.0540941953659058, 1.1043163537979126, 1.0604952573776245, 1.0851367712020874, 1.2032228708267212, 1.2241058349609375, 1.1041301488876343, 1.0781428813934326, 1.24105966091156, 1.20561945438385, 1.1127952337265015, 1.2341656684875488, 1.2690706253051758, 1.0476607084274292, 1.0275187492370605, 1.0344306230545044, 1.0350342988967896, 1.1298701763153076, 1.189990520477295, 1.2677111625671387, 1.2794952392578125, 1.0102040767669678, 1.3180782794952393, 1.221947193145752, 1.148239254951477, 1.0679775476455688, 1.100404977798462, 1.0089211463928223, 1.1031664609909058, 1.1742122173309326, 1.1331924200057983, 1.003637433052063, 1.1921035051345825, 1.0284899473190308, 1.3890347480773926, 1.0366008281707764, 1.0486420392990112, 1.5402051210403442, 1.497769832611084, 1.9298886060714722, 1.2242577075958252, 1.0118093490600586, 1.1515151262283325, 1.022444248199463, 1.047377109527588]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7872636318206787] ms
 --  Average per query NF    [1.3642942905426025] ms
 --  Average per query vegas [2.422969341278076] ms
Mean [1.151]  Median [1.116]  95th [1.387]  99th [1.544]  max [2.069]
Mean [1.151]  Median [1.116]  95th [1.387]  99th [1.544]  max [2.069]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.835396 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=tupleskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
TupleSkewSample - START
0.001
TupleSkewSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[7.9214573e-05 1.8036366e-04 8.9406967e-07 2.3812056e-04 1.0371208e-05]
Distance score: 0.00010179281525779516
SAUCE Drift detection: True
Detection latency: 0.0227s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.049346 | Model-update-time: 2.340487


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=tupleskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.21116852760315
tensor(0.9960)
result is  tensor(456773.8438)
Enter testHyper
ReportEsts: [1.0491520166397095, 1.0419344902038574, 1.0325778722763062, 1.0555704832077026, 1.0081557035446167, 1.055019497871399, 1.0576292276382446, 1.0537372827529907, 1.0367517471313477, 1.0136611461639404, 1.0198254585266113, 1.077236533164978, 1.1026252508163452, 1.059523105621338, 1.029634714126587, 1.0309076309204102, 1.145326018333435, 1.1615217924118042, 1.0179953575134277, 1.4277229309082031, 1.0584133863449097, 1.2538776397705078, 1.0391709804534912, 1.0056002140045166, 1.0646436214447021, 1.1872249841690063, 1.2297722101211548, 1.3563799858093262, 1.2331936359405518, 1.4537549018859863, 1.0385429859161377, 1.381355881690979, 1.2595336437225342, 1.016008973121643, 1.102486252784729, 1.1324013471603394, 1.2410260438919067, 1.008449912071228, 1.2382373809814453, 1.0135267972946167, 1.0437827110290527, 1.1212815046310425, 1.0242966413497925, 1.1214040517807007, 1.0463248491287231, 1.0604568719863892, 1.2009468078613281, 1.0591332912445068, 1.3904762268066406, 1.071507453918457, 1.0228121280670166, 1.0450973510742188, 1.0419968366622925, 1.0477917194366455, 1.0793756246566772, 1.6366119384765625, 1.3758429288864136, 1.1195058822631836, 1.201751947402954, 1.1742855310440063, 1.183223009109497, 1.0247750282287598, 3.730769157409668, 1.2224515676498413, 1.1125407218933105, 1.0688227415084839, 1.3534181118011475, 1.1882742643356323, 1.14681875705719, 1.135608434677124, 1.143843173980713, 1.170271635055542, 1.0057564973831177, 1.0314521789550781, 1.1944432258605957, 1.175553321838379, 1.563894510269165, 1.0795124769210815, 1.4212220907211304, 1.0032027959823608, 1.0879942178726196, 1.0740975141525269, 1.0907174348831177, 1.1580592393875122, 1.5023969411849976, 1.6510637998580933, 1.1660789251327515, 1.8065681457519531, 1.028885841369629, 1.0318853855133057, 1.087782382965088, 1.075441837310791, 1.4935373067855835, 1.175561547279358, 1.351960301399231, 1.0335997343063354, 1.0290724039077759, 1.2395949363708496, 1.2173638343811035, 1.3733799457550049, 1.109507441520691, 1.0983175039291382, 1.076517105102539, 1.1022231578826904, 1.1889861822128296, 1.171768069267273, 1.113222599029541, 1.0277318954467773, 1.02949857711792, 1.243422031402588, 1.0288230180740356, 1.0768617391586304, 1.1520806550979614, 1.2280317544937134, 1.0455284118652344, 1.1298103332519531, 1.1045781373977661, 1.3827940225601196, 1.0137858390808105, 1.0530973672866821, 1.0025962591171265, 1.1428571939468384, 1.1409701108932495, 1.1479697227478027, 1.1238378286361694, 1.2236826419830322, 1.0865634679794312, 1.0766773223876953, 1.1564332246780396, 1.02241849899292, 1.0088627338409424, 1.0278986692428589, 1.1165056228637695, 2.3206934928894043, 1.7455731630325317, 1.0753214359283447, 1.1475886106491089, 1.0829458236694336, 1.1022132635116577, 1.0207847356796265, 1.0821019411087036, 1.1986953020095825, 1.0749796628952026, 1.0225796699523926, 1.012190341949463, 1.0734719038009644, 1.2559523582458496, 1.0767847299575806, 1.1470452547073364, 1.0265172719955444, 1.4030755758285522, 1.0365973711013794, 1.2106201648712158, 1.0040273666381836, 1.0166666507720947, 1.35903799533844, 1.1805310249328613, 1.078740119934082, 1.2686570882797241, 1.0590970516204834, 1.0567677021026611, 1.0790081024169922, 1.394046425819397, 1.0010324716567993, 1.1572891473770142, 1.0837420225143433, 1.0844883918762207, 1.0694743394851685, 1.0065807104110718, 1.384948492050171, 1.178208351135254, 1.0568188428878784, 1.723220705986023, 1.0864849090576172, 1.2930084466934204, 1.084438443183899, 1.295415997505188, 1.2035969495773315, 1.1566498279571533, 1.0031318664550781, 1.8421052694320679, 1.0310431718826294, 1.075826644897461, 1.383421540260315, 1.390868067741394, 1.3245539665222168, 1.0092600584030151, 1.0593620538711548, 1.5662684440612793, 1.0302070379257202, 1.0721545219421387, 1.0585460662841797, 1.1746207475662231, 1.6484935283660889, 1.1153417825698853, 1.0086945295333862, 1.0735056400299072, 1.0633496046066284, 1.5315788984298706, 1.068928837776184]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7071895599365234] ms
 --  Average per query NF    [1.3573408126831055] ms
 --  Average per query vegas [2.349848747253418] ms
Mean [1.175]  Median [1.089]  95th [1.564]  99th [1.847]  max [3.731]
Mean [1.175]  Median [1.089]  95th [1.564]  99th [1.847]  max [3.731]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.379244 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.659568