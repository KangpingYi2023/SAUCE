Input arguments = Namespace(data_update='sample', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 12, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.162539005279541
tensor(0.9972)
result is  tensor(381086.5938)
Enter testHyper
ReportEsts: [1.1334261894226074, 1.025862693786621, 1.226264476776123, 1.1145504713058472, 1.259928822517395, 1.090198040008545, 1.2912739515304565, 1.1848324537277222, 1.0744268894195557, 1.088127851486206, 1.0792419910430908, 1.1868643760681152, 1.0821583271026611, 1.0714285373687744, 1.1587064266204834, 1.1820015907287598, 1.258056879043579, 1.147387146949768, 1.1872841119766235, 1.28316330909729, 1.1566766500473022, 1.1061947345733643, 1.2155269384384155, 1.0426679849624634, 1.112064003944397, 1.2649186849594116, 1.0385698080062866, 1.4342806339263916, 1.061586618423462, 1.1115858554840088, 1.1695636510849, 1.1763062477111816, 1.2955681085586548, 1.0476951599121094, 1.0584335327148438, 1.0384615659713745, 1.2699705362319946, 1.1812326908111572, 1.0656075477600098, 1.0504192113876343, 1.03301203250885, 1.0753507614135742, 1.0804367065429688, 1.0194307565689087, 1.0562011003494263, 1.1700680255889893, 1.0620731115341187, 1.191874384880066, 1.1293690204620361, 1.011986255645752, 1.2005208730697632, 1.34375, 1.1072866916656494, 1.4371366500854492, 1.2178958654403687, 1.0397685766220093, 1.2990654706954956, 1.118391752243042, 1.2182464599609375, 1.3510336875915527, 1.3797552585601807, 1.095766305923462, 1.4055941104888916, 1.0835661888122559, 1.325301170349121, 1.1714285612106323, 1.163265347480774, 1.0298179388046265, 1.023697853088379, 1.4105262756347656, 1.0272727012634277, 1.02328622341156, 1.2601594924926758, 1.147655963897705, 1.1492279767990112, 1.1909807920455933, 1.9277238845825195, 1.0176440477371216, 1.0069628953933716, 1.2080110311508179, 1.2927372455596924, 1.019094705581665, 1.00564444065094, 1.1772247552871704, 1.198332667350769, 1.0837446451187134, 1.076981782913208, 1.0176544189453125, 1.1073634624481201, 1.038394570350647, 1.052312970161438, 1.3561557531356812, 1.0247597694396973, 1.283582091331482, 1.048387050628662, 1.0706400871276855, 1.0545058250427246, 1.123375654220581, 1.0526316165924072, 1.1492369174957275, 1.100806474685669, 1.0731070041656494, 1.0436185598373413, 1.0148588418960571, 1.0745816230773926, 1.0603768825531006, 1.1274782419204712, 1.2076789140701294, 1.053849458694458, 1.0004607439041138, 1.0304310321807861, 1.1334623098373413, 1.1060153245925903, 1.1357427835464478, 1.1018893718719482, 1.0707547664642334, 1.0482591390609741, 1.0749387741088867, 1.2135437726974487, 1.2123847007751465, 1.3115986585617065, 1.150338053703308, 1.1683002710342407, 1.0505554676055908, 1.2141473293304443, 1.2101733684539795, 1.0515484809875488, 1.159112811088562, 1.2601957321166992, 1.1042084693908691, 1.183107614517212, 1.1864876747131348, 1.2287135124206543, 1.5, 1.0532383918762207, 1.0538198947906494, 1.0778456926345825, 1.071869969367981, 1.043547511100769, 1.2770360708236694, 1.0976654291152954, 1.0860748291015625, 1.237831473350525, 1.375970482826233, 1.1205871105194092, 1.1307270526885986, 1.058776617050171, 1.3086439371109009, 1.126950979232788, 1.16796875, 1.2259373664855957, 1.1747212409973145, 1.2888540029525757, 1.13262939453125, 1.1687290668487549, 1.0374064445495605, 1.031415581703186, 1.0056275129318237, 1.0603984594345093, 1.1286183595657349, 1.0689986944198608, 1.0559638738632202, 1.0135670900344849, 1.2888582944869995, 1.1442424058914185, 1.0969423055648804, 1.002220630645752, 1.238778829574585, 1.0125898122787476, 1.005021572113037, 1.1259918212890625, 1.0998808145523071, 1.1688311100006104, 1.1867023706436157, 1.0619890689849854, 1.1024036407470703, 1.0088235139846802, 1.175431489944458, 1.177223801612854, 1.108314871788025, 1.1408182382583618, 1.1066884994506836, 1.0407110452651978, 1.1276812553405762, 1.1213328838348389, 1.1131078004837036, 1.0798017978668213, 1.2736618518829346, 1.0126012563705444, 1.162682056427002, 1.033149242401123, 1.0142041444778442, 1.5422859191894531, 1.577019453048706, 1.5783185958862305, 1.175257682800293, 1.056106686592102, 1.1176470518112183, 1.105129361152649, 1.0718127489089966]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7524008750915527] ms
 --  Average per query NF    [1.3616907596588135] ms
 --  Average per query vegas [2.3907101154327393] ms
Mean [1.146]  Median [1.116]  95th [1.376]  99th [1.577]  max [1.928]
Mean [1.146]  Median [1.116]  95th [1.376]  99th [1.577]  max [1.928]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.811672 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=sample', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
Sample - START
Sample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[8.3446503e-07 8.9406967e-07 7.7486038e-07 1.3709068e-06 2.3841858e-07]
Distance score: 8.225441092690744e-07
SAUCE Drift detection: False
Detection latency: 0.0232s

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.022602 | Model-update-time: 0.000000


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=sample', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.216525793075562
tensor(0.9938)
result is  tensor(455749.1250)
Enter testHyper
ReportEsts: [1.0845619440078735, 1.004022479057312, 1.1864407062530518, 1.259254813194275, 1.0174115896224976, 1.1148796081542969, 1.1906030178070068, 1.0432367324829102, 1.0891361236572266, 1.0140268802642822, 1.0167956352233887, 1.4262877702713013, 1.127516746520996, 1.0954248905181885, 1.0938725471496582, 1.038763165473938, 1.0527716875076294, 1.1452082395553589, 1.075008749961853, 1.2400709390640259, 1.061061143875122, 1.3080421686172485, 1.0276432037353516, 1.0653436183929443, 1.1023919582366943, 1.14070725440979, 1.0379137992858887, 1.200844645500183, 1.3008705377578735, 1.7729123830795288, 1.1423728466033936, 1.264285683631897, 1.093754529953003, 1.0996030569076538, 1.0489375591278076, 1.135719895362854, 1.1909329891204834, 1.2131537199020386, 1.1434000730514526, 1.036059021949768, 1.0704964399337769, 1.0518018007278442, 1.133712649345398, 1.0526316165924072, 1.1429318189620972, 1.2086350917816162, 1.1847662925720215, 1.1146429777145386, 1.1589146852493286, 1.1484594345092773, 1.0333812236785889, 1.0473235845565796, 1.2035720348358154, 1.0779685974121094, 1.1164913177490234, 1.320248007774353, 1.158147931098938, 1.0629736185073853, 1.2611111402511597, 1.1164021492004395, 1.4606741666793823, 1.0590969324111938, 1.0132324695587158, 1.2798304557800293, 1.0039417743682861, 1.0117173194885254, 1.2479910850524902, 1.1377125978469849, 1.1463502645492554, 1.1018097400665283, 1.119337797164917, 1.100496768951416, 1.0902432203292847, 1.039905309677124, 1.199814796447754, 1.062162160873413, 1.161065936088562, 1.090573787689209, 1.2613754272460938, 1.0356967449188232, 1.180964469909668, 1.259800672531128, 1.0123573541641235, 1.3354395627975464, 1.3327019214630127, 1.3601398468017578, 1.217513918876648, 1.581428050994873, 1.0686824321746826, 1.2164297103881836, 1.074147343635559, 1.148581624031067, 1.3344366550445557, 1.0084985494613647, 1.2640844583511353, 1.0163601636886597, 1.2249025106430054, 1.1625139713287354, 1.0128048658370972, 1.3241852521896362, 1.0980998277664185, 1.088270664215088, 1.1995073556900024, 1.0451873540878296, 1.0516058206558228, 1.1742222309112549, 1.0202993154525757, 1.0899990797042847, 1.1875, 1.115754246711731, 1.1111372709274292, 1.1048318147659302, 1.1503921747207642, 1.3523224592208862, 1.039495825767517, 1.1570013761520386, 1.1712322235107422, 1.3687723875045776, 1.1525787115097046, 1.1681416034698486, 1.1115514039993286, 1.2275354862213135, 1.0071861743927002, 1.3051905632019043, 1.0685203075408936, 1.0510714054107666, 1.2030086517333984, 1.245641827583313, 1.0316972732543945, 1.3575515747070312, 1.0907877683639526, 1.1837519407272339, 1.1529178619384766, 1.384615421295166, 1.7485148906707764, 1.0261266231536865, 1.0351240634918213, 1.2383137941360474, 1.110345482826233, 1.0589771270751953, 1.0170832872390747, 1.2774816751480103, 1.066131353378296, 1.0393922328948975, 1.0848619937896729, 1.2637261152267456, 1.4853801727294922, 1.1275452375411987, 1.1803770065307617, 1.0946803092956543, 1.040727972984314, 1.0731297731399536, 1.183159351348877, 1.074084997177124, 1.0062427520751953, 1.2167177200317383, 1.1560591459274292, 1.3225806951522827, 1.1372392177581787, 1.2627595663070679, 1.0561326742172241, 1.1508252620697021, 1.2383668422698975, 1.0590767860412598, 1.1338276863098145, 1.1258039474487305, 1.0942553281784058, 1.1334619522094727, 1.118013620376587, 1.2470183372497559, 1.1862167119979858, 1.0716350078582764, 1.5221052169799805, 1.2094930410385132, 1.0688062906265259, 1.043420672416687, 1.094158411026001, 1.1620676517486572, 1.0844076871871948, 1.0255956649780273, 1.4893616437911987, 1.069587230682373, 1.0919386148452759, 1.6631759405136108, 1.2084702253341675, 1.3924882411956787, 1.2958228588104248, 1.074449062347412, 1.4135621786117554, 1.0182806253433228, 1.1795997619628906, 1.037193775177002, 1.2350784540176392, 1.8511312007904053, 1.0015052556991577, 1.2250967025756836, 1.2629120349884033, 1.065565824508667, 1.3430033922195435, 1.0699670314788818]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7431275844573975] ms
 --  Average per query NF    [1.356816291809082] ms
 --  Average per query vegas [2.3863112926483154] ms
Mean [1.163]  Median [1.131]  95th [1.414]  99th [1.749]  max [1.851]
Mean [1.163]  Median [1.131]  95th [1.414]  99th [1.749]  max [1.851]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.261213 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=0 | total-time=26.157515