Input arguments = Namespace(data_update='tupleskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 85, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.167889595031738
tensor(0.9962)
result is  tensor(380722.4375)
Enter testHyper
ReportEsts: [1.1197028160095215, 1.042264699935913, 1.4999383687973022, 1.088439702987671, 1.2212008237838745, 1.0918333530426025, 1.3114360570907593, 1.205744981765747, 1.032322645187378, 1.192805290222168, 1.0749354362487793, 1.125, 1.0831929445266724, 1.0625, 1.1383476257324219, 1.215034008026123, 1.251793384552002, 1.0818289518356323, 1.2343724966049194, 1.0, 1.050115942955017, 1.0660316944122314, 1.127721905708313, 1.0608253479003906, 1.24953031539917, 1.1202532052993774, 1.0929054021835327, 1.5763787031173706, 1.0109983682632446, 1.0855457782745361, 1.1018091440200806, 1.068831205368042, 1.003654956817627, 1.0436776876449585, 1.1854307651519775, 1.174273133277893, 1.3894702196121216, 1.070253610610962, 1.0294861793518066, 1.0265867710113525, 1.066608190536499, 1.1117562055587769, 1.0743240118026733, 1.0288920402526855, 1.1014156341552734, 1.0419501066207886, 1.0689784288406372, 1.2616552114486694, 1.0658904314041138, 1.0879864692687988, 1.1912144422531128, 1.3193488121032715, 1.0096391439437866, 1.1739388704299927, 1.2406927347183228, 1.0530829429626465, 1.3046729564666748, 1.190172791481018, 1.1335513591766357, 1.423142671585083, 1.1700407266616821, 1.164251685142517, 1.3694995641708374, 1.0887593030929565, 1.43478262424469, 1.2285714149475098, 1.1009657382965088, 1.0248154401779175, 1.0398759841918945, 1.24210524559021, 1.0257441997528076, 1.0068292617797852, 1.311509370803833, 1.07606041431427, 1.0710350275039673, 1.078394889831543, 1.9287189245224, 1.0646408796310425, 1.0760869979858398, 1.3050906658172607, 1.1486467123031616, 1.1148440837860107, 1.0638456344604492, 1.144964575767517, 1.2166497707366943, 1.0673483610153198, 1.0481960773468018, 1.1487516164779663, 1.012689471244812, 1.0150095224380493, 1.0508803129196167, 1.3444533348083496, 1.031622052192688, 1.2500567436218262, 1.0833333730697632, 1.123794436454773, 1.2722028493881226, 1.3010421991348267, 1.0, 1.0891302824020386, 1.160056710243225, 1.1296963691711426, 1.0325394868850708, 1.003673791885376, 1.2414226531982422, 1.1168752908706665, 1.1470097303390503, 1.2006981372833252, 1.0573910474777222, 1.0347867012023926, 1.014521837234497, 1.086190938949585, 1.3284695148468018, 1.0438926219940186, 1.0281673669815063, 1.0607476234436035, 1.0562101602554321, 1.0131561756134033, 1.2604615688323975, 1.1148626804351807, 1.1534476280212402, 1.1441285610198975, 1.1354937553405762, 1.177262783050537, 1.2965116500854492, 1.2005778551101685, 1.0167089700698853, 1.2329834699630737, 1.2340255975723267, 1.1442885398864746, 1.0890334844589233, 1.1657381057739258, 1.212243676185608, 1.5357142686843872, 1.027043104171753, 1.1247045993804932, 1.0550068616867065, 1.2452032566070557, 1.0836423635482788, 1.3605974912643433, 1.181990146636963, 1.0067657232284546, 1.0247310400009155, 1.4593183994293213, 1.0985071659088135, 1.0091878175735474, 1.0534332990646362, 1.4520864486694336, 1.0116751194000244, 1.1336647272109985, 1.1708505153656006, 1.1775413751602173, 1.3192287683486938, 1.4060659408569336, 1.1279467344284058, 1.015091896057129, 1.2228457927703857, 1.0022510290145874, 1.1076698303222656, 1.160011887550354, 1.1825753450393677, 1.0440151691436768, 1.0724165439605713, 1.2377806901931763, 1.1512194871902466, 1.0308570861816406, 1.1998159885406494, 1.264142632484436, 1.0162237882614136, 1.0078847408294678, 1.0454312562942505, 1.1091395616531372, 1.1818181276321411, 1.1455163955688477, 1.1086512804031372, 1.0671228170394897, 1.0364431142807007, 1.2830229997634888, 1.0842374563217163, 1.132328748703003, 1.0587406158447266, 1.0526357889175415, 1.0564366579055786, 1.0715014934539795, 1.1419775485992432, 1.1099365949630737, 1.0633039474487305, 1.2584939002990723, 1.1089476346969604, 1.1607681512832642, 1.0188437700271606, 1.0168814659118652, 1.5164718627929688, 1.464669942855835, 1.6776002645492554, 1.2625406980514526, 1.036056637763977, 1.1176470518112183, 1.0145704746246338, 1.1176295280456543]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7053120136260986] ms
 --  Average per query NF    [1.3596010208129883] ms
 --  Average per query vegas [2.3457109928131104] ms
Mean [1.148]  Median [1.111]  95th [1.424]  99th [1.577]  max [1.929]
Mean [1.148]  Median [1.111]  95th [1.424]  99th [1.577]  max [1.929]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.797345 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=tupleskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
TupleSkewSample - START
0.001
TupleSkewSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[8.1896782e-05 4.4345856e-05 5.8352947e-05 3.8373470e-04 2.1183491e-04]
Distance score: 0.00015603304200340062
SAUCE Drift detection: True
Detection latency: 0.0228s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.003698 | Model-update-time: 2.214848


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=tupleskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.174444198608398
tensor(0.9958)
result is  tensor(456677.8438)
Enter testHyper
ReportEsts: [1.1421340703964233, 1.0520447492599487, 1.0795106887817383, 1.5286343097686768, 1.067581295967102, 1.3189964294433594, 1.3196816444396973, 1.0477060079574585, 1.0963455438613892, 1.055314540863037, 1.0288734436035156, 1.2122416496276855, 1.0668257474899292, 1.0223714113235474, 1.0988671779632568, 1.0675121545791626, 1.0347297191619873, 1.0581940412521362, 1.0186233520507812, 1.2375558614730835, 1.0537605285644531, 1.0022825002670288, 1.0229161977767944, 1.0116249322891235, 1.0269337892532349, 1.2705090045928955, 1.066731572151184, 1.341202974319458, 1.5032178163528442, 1.588994026184082, 1.1527323722839355, 1.5932203531265259, 1.2165144681930542, 1.0794306993484497, 1.0203492641448975, 1.0651029348373413, 1.001824975013733, 1.2001917362213135, 1.1177276372909546, 1.0584602355957031, 1.0248217582702637, 1.2318992614746094, 3.4022395610809326, 1.1464773416519165, 1.1733417510986328, 1.0348986387252808, 1.1422206163406372, 1.2347384691238403, 1.3047618865966797, 1.0355273485183716, 1.025132417678833, 1.234708547592163, 1.019978404045105, 1.0674024820327759, 1.0303984880447388, 1.6220017671585083, 1.2240204811096191, 1.0912142992019653, 1.209407091140747, 1.1076323986053467, 1.724056601524353, 1.083207130432129, 1.0991175174713135, 1.1524300575256348, 1.1164768934249878, 1.075438380241394, 1.335152506828308, 1.106897234916687, 1.1337754726409912, 1.1061766147613525, 1.2898842096328735, 1.145016074180603, 1.048999547958374, 1.0576115846633911, 1.1700036525726318, 1.0332330465316772, 1.092484474182129, 1.042531967163086, 1.1492365598678589, 1.1225371360778809, 1.095350742340088, 1.012110710144043, 1.0702219009399414, 1.1790391206741333, 1.293796420097351, 1.5829787254333496, 1.0381067991256714, 1.4519134759902954, 1.010094165802002, 1.034152865409851, 1.1349527835845947, 1.0417732000350952, 1.30892813205719, 1.199750304222107, 1.001813530921936, 1.0442143678665161, 1.1516295671463013, 1.0205034017562866, 1.0802185535430908, 1.0893733501434326, 1.1295278072357178, 1.1721746921539307, 1.051546335220337, 1.2879449129104614, 1.1401143074035645, 1.1475409269332886, 1.1428707838058472, 1.1376991271972656, 1.0744985342025757, 1.051138997077942, 1.2308655977249146, 1.1703152656555176, 1.1394544839859009, 1.2475790977478027, 1.1561506986618042, 1.049771785736084, 1.0591667890548706, 1.2437341213226318, 1.0244909524917603, 1.0973451137542725, 1.0622825622558594, 1.2541345357894897, 1.209734320640564, 1.0099111795425415, 1.1004502773284912, 1.1054478883743286, 1.093891978263855, 1.721864938735962, 1.0642608404159546, 1.3550552129745483, 1.054655909538269, 1.141619086265564, 1.049655795097351, 1.4599807262420654, 2.3034873008728027, 1.0615196228027344, 1.051956295967102, 1.0106992721557617, 1.0115220546722412, 1.038392424583435, 1.047430396080017, 1.1064940690994263, 1.0947635173797607, 1.0104258060455322, 1.0230027437210083, 1.0017023086547852, 1.2267441749572754, 1.0082662105560303, 1.2226365804672241, 1.022011637687683, 1.2326695919036865, 1.0720887184143066, 1.075791597366333, 1.0648869276046753, 1.061686635017395, 1.1065359115600586, 1.153595209121704, 1.0620155334472656, 1.019729733467102, 1.0886452198028564, 1.0267914533615112, 1.0654255151748657, 1.2581963539123535, 1.1954478025436401, 1.0682343244552612, 1.3843971490859985, 1.0415643453598022, 1.0137604475021362, 1.2152401208877563, 1.2155661582946777, 1.0692793130874634, 1.1208226680755615, 1.2724064588546753, 1.1253278255462646, 1.1981987953186035, 1.0415500402450562, 1.1253670454025269, 1.0086596012115479, 1.102879285812378, 1.16915762424469, 1.8421052694320679, 1.276197910308838, 1.1453840732574463, 1.4294168949127197, 1.2222362756729126, 1.1914191246032715, 1.1779989004135132, 1.1087340116500854, 1.3910315036773682, 1.0045685768127441, 1.126588225364685, 1.0852264165878296, 1.3297964334487915, 1.5748552083969116, 1.132158637046814, 1.3859531879425049, 1.6125274896621704, 1.0143773555755615, 1.4066985845565796, 1.1593235731124878]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.741999864578247] ms
 --  Average per query NF    [1.358112096786499] ms
 --  Average per query vegas [2.383887767791748] ms
Mean [1.171]  Median [1.106]  95th [1.575]  99th [1.847]  max [3.402]
Mean [1.171]  Median [1.106]  95th [1.575]  99th [1.847]  max [3.402]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.407544 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.469440