Input arguments = Namespace(data_update='valueskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 1226, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.147431373596191
tensor(0.9957)
result is  tensor(380533.2500)
Enter testHyper
ReportEsts: [1.128710150718689, 1.1401082277297974, 1.367828130722046, 1.216256022453308, 1.2121471166610718, 1.088748574256897, 1.2471051216125488, 1.1447817087173462, 1.0448755025863647, 1.2420251369476318, 1.170542597770691, 1.2072033882141113, 1.0178617238998413, 1.0357142686843872, 1.114768147468567, 1.2274363040924072, 1.1172322034835815, 1.1900237798690796, 1.1057018041610718, 1.1045918464660645, 1.1691398620605469, 1.0015238523483276, 1.1688368320465088, 1.017329216003418, 1.1209670305252075, 1.020295262336731, 1.0633445978164673, 1.3762249946594238, 1.0246981382369995, 1.036008596420288, 1.1504079103469849, 1.1417760848999023, 1.1680021286010742, 1.1282179355621338, 1.0730934143066406, 1.116613745689392, 1.3900002241134644, 1.1069164276123047, 1.1549814939498901, 1.0515048503875732, 1.0962119102478027, 1.0759555101394653, 1.0999109745025635, 1.1773399114608765, 1.1155714988708496, 1.0034013986587524, 1.1167148351669312, 1.1959575414657593, 1.0967696905136108, 1.0338408946990967, 1.2068063020706177, 1.388925552368164, 1.0596139430999756, 1.0943552255630493, 1.0633246898651123, 1.0077084302902222, 1.1887850761413574, 1.1517367362976074, 1.2478972673416138, 1.4010088443756104, 1.2572720050811768, 1.1198128461837769, 1.2817635536193848, 1.1422005891799927, 1.2890625, 1.1142857074737549, 1.0582278966903687, 1.0509428977966309, 1.006988525390625, 1.221052646636963, 1.1584875583648682, 1.105269432067871, 1.214056134223938, 1.2637336254119873, 1.0604279041290283, 1.209898591041565, 1.6616417169570923, 1.0230047702789307, 1.0004469156265259, 1.2964569330215454, 1.2776440382003784, 1.1750929355621338, 1.101824164390564, 1.2016009092330933, 1.2712513208389282, 1.129896640777588, 1.02988600730896, 1.0580580234527588, 1.0627214908599854, 1.0063023567199707, 1.0087342262268066, 1.2879666090011597, 1.004346251487732, 1.2247440814971924, 1.1142857074737549, 1.083072543144226, 1.0467932224273682, 1.2220326662063599, 1.01694917678833, 1.257091999053955, 1.0776315927505493, 1.0632150173187256, 1.0199306011199951, 1.0278184413909912, 1.0376569032669067, 1.0426912307739258, 1.074836015701294, 1.2181501388549805, 1.0780937671661377, 1.0370105504989624, 1.2068407535552979, 1.0821791887283325, 1.1594222784042358, 1.0426030158996582, 1.209110975265503, 1.0271493196487427, 1.0112825632095337, 1.0005161762237549, 1.2542123794555664, 1.2044631242752075, 1.2950260639190674, 1.1352283954620361, 1.1089551448822021, 1.2012022733688354, 1.262596845626831, 1.2085224390029907, 1.1282182931900024, 1.0737892389297485, 1.3261802196502686, 1.1312625408172607, 1.1236152648925781, 1.305458426475525, 1.2557488679885864, 1.3928571939468384, 1.1875611543655396, 1.0123392343521118, 1.0729715824127197, 1.026991844177246, 1.1357015371322632, 1.0159319639205933, 1.0858180522918701, 1.0691986083984375, 1.005827784538269, 1.2894395589828491, 1.0727912187576294, 1.076175570487976, 1.217410922050476, 1.4420846700668335, 1.08774733543396, 1.0926135778427124, 1.2378239631652832, 1.1935648918151855, 1.351069688796997, 1.1706273555755615, 1.168039321899414, 1.057295322418213, 1.0671316385269165, 1.0520540475845337, 1.0112481117248535, 1.1353626251220703, 1.2440049648284912, 1.0848785638809204, 1.078070044517517, 1.2264398336410522, 1.3202797174453735, 1.059573769569397, 1.0370298624038696, 1.1720808744430542, 1.1213916540145874, 1.0310654640197754, 1.1298125982284546, 1.0065786838531494, 1.149350643157959, 1.151145339012146, 1.0148634910583496, 1.0213197469711304, 1.0249004364013672, 1.1995441913604736, 1.0505300760269165, 1.1406280994415283, 1.0298763513565063, 1.009111762046814, 1.0174081325531006, 1.1950970888137817, 1.1137268543243408, 1.071881651878357, 1.0119426250457764, 1.1889476776123047, 1.0732378959655762, 1.393916130065918, 1.0912082195281982, 1.0005091428756714, 1.49973726272583, 1.4293416738510132, 1.6415592432022095, 1.0820770263671875, 1.3052939176559448, 1.085714340209961, 1.0198261737823486, 1.0023572444915771]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7351930141448975] ms
 --  Average per query NF    [1.3576972484588623] ms
 --  Average per query vegas [2.377495765686035] ms
Mean [1.141]  Median [1.116]  95th [1.377]  99th [1.501]  max [1.662]
Mean [1.141]  Median [1.116]  95th [1.377]  99th [1.501]  max [1.662]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.817612 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=valueskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
ValueSample - START
ValueSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[ 1.1192381e-02  9.5367432e-07 -2.9802322e-08  5.9604645e-06
  1.7881393e-07]
Distance score: 0.0022398889996111393
SAUCE Drift detection: True
Detection latency: 0.0231s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.056849 | Model-update-time: 2.217959


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=valueskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.155718564987183
tensor(0.9974)
result is  tensor(457417.8438)
Enter testHyper
ReportEsts: [1.148657202720642, 1.0477997064590454, 1.0184135437011719, 1.0044176578521729, 1.106757402420044, 1.3652955293655396, 1.1582424640655518, 1.0272607803344727, 1.4437689781188965, 1.0163227319717407, 1.0138822793960571, 1.3508771657943726, 1.0047961473464966, 1.0942076444625854, 7.724246501922607, 1.1496624946594238, 1.6857749223709106, 1.1672956943511963, 1.0212572813034058, 1.2482984066009521, 1.1398149728775024, 1.17149817943573, 1.2325588464736938, 1.02060067653656, 1.0134174823760986, 1.352192759513855, 1.1076101064682007, 1.081258773803711, 1.0762641429901123, 1.278947353363037, 1.268433690071106, 1.2246376276016235, 1.0422189235687256, 1.0660386085510254, 1.089052438735962, 1.1782712936401367, 1.0259640216827393, 1.1808234453201294, 1.055776834487915, 1.1377193927764893, 1.0504237413406372, 1.1311672925949097, 15.5346097946167, 1.1025694608688354, 1.044759750366211, 1.0215758085250854, 1.1613399982452393, 1.2218503952026367, 1.0076923370361328, 1.1971509456634521, 1.0477739572525024, 1.0565412044525146, 1.0155041217803955, 1.2442699670791626, 1.3674935102462769, 1.5718129873275757, 1.267021656036377, 1.1135170459747314, 1.026921033859253, 1.0396920442581177, 1.5599021911621094, 1.3759032487869263, 1.1056429147720337, 1.1885507106781006, 1.0633517503738403, 1.0464215278625488, 1.299147129058838, 1.1431584358215332, 1.1113466024398804, 1.327410340309143, 1.1199218034744263, 1.106189250946045, 1.2022372484207153, 1.1027235984802246, 1.0868475437164307, 1.3567492961883545, 13.846672058105469, 1.048629641532898, 1.0065675973892212, 2.9452762603759766, 1.0578608512878418, 1.1998631954193115, 1.3624929189682007, 1.0815849304199219, 2.0901072025299072, 1.2721312046051025, 1.2356889247894287, 1.6687638759613037, 1.906313180923462, 1.6803808212280273, 1.1362799406051636, 1.1191474199295044, 1.3403611183166504, 1.0692282915115356, 1.0867539644241333, 1.0181280374526978, 3.9487345218658447, 1.0673182010650635, 1.3368232250213623, 1.2850720882415771, 1.2856322526931763, 1.0688570737838745, 1.0074074268341064, 1.077191948890686, 1.1825675964355469, 3.780055284500122, 1.0205590724945068, 1.003194808959961, 1.1954022645950317, 1.0895037651062012, 1.1595454216003418, 1.0736057758331299, 1.1027475595474243, 1.1049166917800903, 1.114455223083496, 1.0984300374984741, 1.1258621215820312, 1.4355181455612183, 1.6163216829299927, 1.0303030014038086, 1.072921633720398, 1.0412583351135254, 1.563946008682251, 3.982328176498413, 1.0600695610046387, 1.079054832458496, 1.1748592853546143, 1.0801281929016113, 1.0429965257644653, 1.0902316570281982, 1.137006402015686, 1.1063814163208008, 1.1438697576522827, 1.3299798965454102, 1.8268442153930664, 1.427296757698059, 1.060606598854065, 1.0368320941925049, 1.2773939371109009, 1.1769614219665527, 1.056058406829834, 1.0080807209014893, 1.2723181247711182, 1.0259708166122437, 1.2705364227294922, 1.0285451412200928, 1.4444444179534912, 1.0436947345733643, 1.0193015336990356, 1.2123507261276245, 1.0222712755203247, 1.2774218320846558, 1.1448273658752441, 1.132520079612732, 1.0939760208129883, 1.0028249025344849, 1.1425526142120361, 1.1138211488723755, 1.0854616165161133, 1.0840680599212646, 15.005095481872559, 1.1202380657196045, 2.1714980602264404, 1.1805226802825928, 1.19314706325531, 1.2736486196517944, 1.0002121925354004, 1.1133078336715698, 5.408219337463379, 1.0336248874664307, 1.103361964225769, 1.0930596590042114, 1.6029739379882812, 1.088104486465454, 1.1263447999954224, 1.0040874481201172, 1.0583175420761108, 1.0311388969421387, 1.244708776473999, 1.0533589124679565, 1.4313725233078003, 1.0871174335479736, 1.021662712097168, 1.088384747505188, 1.2343488931655884, 1.3270481824874878, 3.0142722129821777, 1.311638593673706, 1.266955018043518, 1.1120829582214355, 1.0066524744033813, 1.1403478384017944, 1.370404601097107, 1.8767061233520508, 1.0513660907745361, 1.083889365196228, 1.257278323173523, 1.1040339469909668, 1.0713305473327637, 1.1203651428222656]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.703587055206299] ms
 --  Average per query NF    [1.3567471504211426] ms
 --  Average per query vegas [2.3468399047851562] ms
Mean [1.497]  Median [1.120]  95th [2.210]  99th [13.858]  max [15.535]
Mean [1.497]  Median [1.120]  95th [2.210]  99th [13.858]  max [15.535]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.311542 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.464245