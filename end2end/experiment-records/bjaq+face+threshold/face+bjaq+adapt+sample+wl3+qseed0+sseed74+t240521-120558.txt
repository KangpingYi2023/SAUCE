Input arguments = Namespace(data_update='sample', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 74, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.208986520767212
tensor(0.9912)
result is  tensor(378809.2500)
Enter testHyper
ReportEsts: [1.168245792388916, 1.1121211051940918, 1.2743608951568604, 1.1804590225219727, 1.2629233598709106, 1.0849618911743164, 1.1911427974700928, 1.053025245666504, 1.1201117038726807, 1.1256228685379028, 1.0163651704788208, 1.1110169887542725, 1.0825985670089722, 1.0758928060531616, 1.1356359720230103, 1.3844871520996094, 1.2036961317062378, 1.1716152429580688, 1.1820881366729736, 1.079081654548645, 1.0039222240447998, 1.0439364910125732, 1.0850120782852173, 1.0300536155700684, 1.1016091108322144, 1.1365280151367188, 1.0050933361053467, 1.55888032913208, 1.031676173210144, 1.0552334785461426, 1.1106775999069214, 1.166492223739624, 1.1007599830627441, 1.107218861579895, 1.2353401184082031, 1.1467562913894653, 1.4046695232391357, 1.2331880331039429, 1.0791553258895874, 1.0129806995391846, 1.0344727039337158, 1.098935604095459, 1.0685348510742188, 1.1254594326019287, 1.1181069612503052, 1.0499999523162842, 1.134517788887024, 1.2761834859848022, 1.1180808544158936, 1.1032148599624634, 1.152500033378601, 1.331017017364502, 1.0731425285339355, 1.2599554061889648, 1.227320909500122, 1.0009280443191528, 1.3373831510543823, 1.1657649278640747, 1.1161893606185913, 1.408111572265625, 1.45415461063385, 1.182407259941101, 1.3028109073638916, 1.0843759775161743, 1.3580247163772583, 1.399999976158142, 1.1600370407104492, 1.036532998085022, 1.0233243703842163, 1.3368420600891113, 1.1147981882095337, 1.0026201009750366, 1.327624797821045, 1.3254667520523071, 1.2631213665008545, 1.0831443071365356, 2.4416491985321045, 1.008821964263916, 1.1233277320861816, 1.3544821739196777, 1.0776805877685547, 1.2135357856750488, 1.0089763402938843, 1.2022924423217773, 1.1745121479034424, 1.0358632802963257, 1.045196533203125, 1.007566213607788, 1.122444987297058, 1.072006344795227, 1.0831414461135864, 1.3253530263900757, 1.0460203886032104, 1.3623762130737305, 1.167664647102356, 1.0789709091186523, 1.1989338397979736, 1.1752021312713623, 1.0, 1.0787379741668701, 1.1886792182922363, 1.230351448059082, 1.0119173526763916, 1.012445092201233, 1.0686192512512207, 1.0194669961929321, 1.05818510055542, 1.1780104637145996, 1.0744600296020508, 1.0230859518051147, 1.0718170404434204, 1.0558558702468872, 1.2295392751693726, 1.0061806440353394, 1.126347541809082, 1.096618413925171, 1.0670498609542847, 1.1249839067459106, 1.2725708484649658, 1.0206063985824585, 1.1839016675949097, 1.0725817680358887, 1.1174901723861694, 1.2094016075134277, 1.200096845626831, 1.1657036542892456, 1.1004507541656494, 1.081244707107544, 1.2117646932601929, 1.1045423746109009, 1.0681085586547852, 1.083627462387085, 1.1771286725997925, 1.4642857313156128, 1.072941780090332, 1.2305066585540771, 1.0017248392105103, 1.190894365310669, 1.0551578998565674, 1.2943166494369507, 1.1235501766204834, 1.0097609758377075, 1.31130051612854, 1.2714874744415283, 1.1140590906143188, 1.0011647939682007, 1.0733840465545654, 1.4294899702072144, 1.0625537633895874, 1.1267045736312866, 1.339734435081482, 1.1620304584503174, 1.2848200798034668, 1.1509310007095337, 1.1489906311035156, 1.0774543285369873, 1.0993338823318481, 1.0137872695922852, 1.0359917879104614, 1.081587553024292, 1.1509201526641846, 1.1267021894454956, 1.1143511533737183, 1.2427055835723877, 1.1597051620483398, 1.0796853303909302, 1.2655794620513916, 1.508742332458496, 1.0267298221588135, 1.0114952325820923, 1.0520522594451904, 1.1625670194625854, 1.149350643157959, 1.0206208229064941, 1.071866512298584, 1.061036467552185, 1.017301082611084, 1.2225977182388306, 1.26584792137146, 1.2010849714279175, 1.0537866353988647, 1.028123378753662, 1.016947627067566, 1.1327885389328003, 1.191235065460205, 1.0993657112121582, 1.0077744722366333, 1.2943083047866821, 1.0187366008758545, 1.4354537725448608, 1.020045518875122, 1.081409215927124, 1.5025006532669067, 1.4042375087738037, 1.6356321573257446, 1.2641878128051758, 1.0954147577285767, 1.1176470518112183, 1.1514919996261597, 1.107835292816162]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [4.601585865020752] ms
 --  Average per query NF    [1.492297649383545] ms
 --  Average per query vegas [3.109288215637207] ms
Mean [1.156]  Median [1.118]  95th [1.405]  99th [1.560]  max [2.442]
Mean [1.156]  Median [1.118]  95th [1.405]  99th [1.560]  max [2.442]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 12.034969 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=sample', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
Sample - START
Sample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[2.9802322e-07 1.1920929e-07 1.1920929e-07 4.7683716e-07 1.3709068e-06]
Distance score: 4.76837158203125e-07
SAUCE Drift detection: False
Detection latency: 0.0233s

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.024137 | Model-update-time: 0.000000


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=sample', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.185846328735352
tensor(0.9974)
result is  tensor(457393.4062)
Enter testHyper
ReportEsts: [1.0502475500106812, 1.0491015911102295, 1.2663623094558716, 1.2542372941970825, 1.0353106260299683, 1.3594714403152466, 1.1699578762054443, 1.1697388887405396, 1.2298024892807007, 1.011483907699585, 1.0057260990142822, 1.0679209232330322, 1.1343963146209717, 1.1587542295455933, 1.0389777421951294, 1.0538194179534912, 1.1541038751602173, 1.057908058166504, 1.0126523971557617, 1.3443411588668823, 1.1514796018600464, 1.534482717514038, 1.004132628440857, 1.1330645084381104, 1.016276240348816, 1.20310378074646, 1.0427887439727783, 1.1651031970977783, 1.2511210441589355, 1.547957420349121, 1.160097360610962, 1.3138686418533325, 1.0789209604263306, 1.0305665731430054, 1.0009890794754028, 1.2101404666900635, 1.0440278053283691, 1.0703482627868652, 1.0965783596038818, 1.0563372373580933, 1.0329622030258179, 1.0180467367172241, 1.0430117845535278, 1.0366084575653076, 1.035465955734253, 1.0600625276565552, 1.1459193229675293, 1.1357375383377075, 1.04365074634552, 1.0859301090240479, 1.0356333255767822, 1.0256686210632324, 1.0011157989501953, 1.0046993494033813, 1.0193111896514893, 1.519673228263855, 1.1949061155319214, 1.06571626663208, 1.23366117477417, 1.0452911853790283, 1.240986704826355, 1.001153588294983, 1.000495195388794, 1.2592755556106567, 1.1594597101211548, 1.0464251041412354, 1.3056559562683105, 1.0628794431686401, 1.21382474899292, 1.130300760269165, 1.144551157951355, 1.155705213546753, 1.1164987087249756, 1.1308871507644653, 1.0991644859313965, 1.1115145683288574, 1.1402876377105713, 1.0989885330200195, 1.696875810623169, 1.141940712928772, 1.1689140796661377, 1.2128677368164062, 1.179473638534546, 1.081951379776001, 1.2765331268310547, 1.3205574750900269, 1.3401907682418823, 1.652414321899414, 1.0000622272491455, 1.2595977783203125, 1.065625786781311, 1.1927640438079834, 1.479619026184082, 1.098846435546875, 1.338733434677124, 1.0803184509277344, 1.1768094301223755, 1.305443286895752, 1.033974528312683, 1.0151586532592773, 1.1334820985794067, 1.150325059890747, 1.1733967065811157, 1.200516700744629, 1.0880746841430664, 1.1094008684158325, 1.0080726146697998, 1.1718183755874634, 1.2011661529541016, 1.068142056465149, 1.0368971824645996, 1.1136283874511719, 1.1570638418197632, 1.1029738187789917, 1.1806424856185913, 1.012672781944275, 1.0372291803359985, 1.2236512899398804, 1.1581147909164429, 1.1147540807724, 1.046797513961792, 1.1661458015441895, 1.086044430732727, 1.6344611644744873, 1.0304347276687622, 1.2222768068313599, 1.0386372804641724, 1.320661187171936, 1.173301100730896, 1.053772211074829, 1.0984752178192139, 1.0804760456085205, 1.0639179944992065, 1.6230000257492065, 1.6361974477767944, 1.1094890832901, 1.0012478828430176, 1.2780894041061401, 1.082413911819458, 1.0193713903427124, 1.13193678855896, 1.163282871246338, 1.0560879707336426, 1.0757895708084106, 1.0797255039215088, 1.1732726097106934, 1.5232558250427246, 1.0311028957366943, 1.2721930742263794, 1.0221012830734253, 1.2662948369979858, 1.01689612865448, 1.0703222751617432, 1.0992896556854248, 1.0246496200561523, 1.036531686782837, 1.1902377605438232, 1.377049207687378, 1.198939561843872, 1.2233598232269287, 1.1100895404815674, 1.0696171522140503, 1.067747712135315, 1.173884630203247, 1.1671802997589111, 1.0234986543655396, 1.040924072265625, 1.1786744594573975, 1.022719144821167, 1.4138586521148682, 1.042508840560913, 1.0372084379196167, 1.4005202054977417, 1.0722179412841797, 1.0883351564407349, 1.0323385000228882, 1.14363431930542, 1.0967999696731567, 1.0950584411621094, 1.0003694295883179, 1.5952380895614624, 1.1604396104812622, 1.0118584632873535, 1.6667388677597046, 1.4051865339279175, 1.0857490301132202, 1.1256340742111206, 1.1756763458251953, 1.5180003643035889, 1.0504902601242065, 1.1645622253417969, 1.061536192893982, 1.257423758506775, 1.7603986263275146, 1.0036430358886719, 1.2352941036224365, 1.3875478506088257, 1.0741163492202759, 1.3249157667160034, 1.1403247117996216]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7398135662078857] ms
 --  Average per query NF    [1.358569860458374] ms
 --  Average per query vegas [2.3812437057495117] ms
Mean [1.159]  Median [1.114]  95th [1.524]  99th [1.667]  max [1.760]
Mean [1.159]  Median [1.114]  95th [1.524]  99th [1.667]  max [1.760]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.179457 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=0 | total-time=26.263160