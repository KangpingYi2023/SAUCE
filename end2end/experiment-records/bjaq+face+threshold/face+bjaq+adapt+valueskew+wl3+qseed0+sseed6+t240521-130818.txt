Input arguments = Namespace(data_update='valueskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 6, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.211941003799438
tensor(0.9965)
result is  tensor(380828.5625)
Enter testHyper
ReportEsts: [1.0926423072814941, 1.0078922510147095, 1.3550022840499878, 1.1827753782272339, 1.2591824531555176, 1.1328030824661255, 1.1923636198043823, 1.2479348182678223, 1.0602232217788696, 1.1732455492019653, 1.1042205095291138, 1.1387711763381958, 1.013407588005066, 1.046875, 1.0831265449523926, 1.3085623979568481, 1.463523030281067, 1.1777909994125366, 1.102317452430725, 1.0535714626312256, 1.0296411514282227, 1.0105222463607788, 1.1754692792892456, 1.0543615818023682, 1.1217838525772095, 1.169077754020691, 1.079673409461975, 1.4317375421524048, 1.0068925619125366, 1.0969382524490356, 1.1496984958648682, 1.098181962966919, 1.2144067287445068, 1.0188815593719482, 1.1816421747207642, 1.102569818496704, 1.2196234464645386, 1.1826859712600708, 1.0733728408813477, 1.1259880065917969, 1.0057454109191895, 1.0366473197937012, 1.044961929321289, 1.067284345626831, 1.03760826587677, 1.1768707036972046, 1.1565330028533936, 1.34553861618042, 1.0318422317504883, 1.162436604499817, 1.277008295059204, 1.325991153717041, 1.0099189281463623, 1.1728944778442383, 1.1488572359085083, 1.0822901725769043, 1.2523365020751953, 1.316283941268921, 1.19865882396698, 1.5219178199768066, 1.2000575065612793, 1.1420238018035889, 1.1977392435073853, 1.1313982009887695, 1.325301170349121, 1.2285714149475098, 1.1863765716552734, 1.0100504159927368, 1.152599573135376, 1.2736842632293701, 1.0611424446105957, 1.0882986783981323, 1.2164777517318726, 1.1806466579437256, 1.0961896181106567, 1.100172519683838, 1.6719763278961182, 1.0578224658966064, 1.0654191970825195, 1.114768385887146, 1.265321969985962, 1.1468260288238525, 1.0436139106750488, 1.19495689868927, 1.194616675376892, 1.0981512069702148, 1.0048645734786987, 1.1106683015823364, 1.016780972480774, 1.056140661239624, 1.043245553970337, 1.3138312101364136, 1.0302921533584595, 1.2880879640579224, 1.0714285373687744, 1.0836668014526367, 1.2618221044540405, 1.1809688806533813, 1.034482717514038, 1.2238554954528809, 1.0636364221572876, 1.0470333099365234, 1.0274797677993774, 1.000732660293579, 1.0286206007003784, 1.0700955390930176, 1.127583384513855, 1.191972017288208, 1.0442203283309937, 1.0228450298309326, 1.2681710720062256, 1.0973782539367676, 1.2234090566635132, 1.0418384075164795, 1.1089602708816528, 1.1464647054672241, 1.0474847555160522, 1.0267513990402222, 1.2303627729415894, 1.0440999269485474, 1.2877942323684692, 1.0477439165115356, 1.0029339790344238, 1.1447628736495972, 1.152616262435913, 1.2149195671081543, 1.172511100769043, 1.1766700744628906, 1.2918059825897217, 1.1319304704666138, 1.1090792417526245, 1.0649548768997192, 1.162212610244751, 1.4285714626312256, 1.1522163152694702, 1.1136780977249146, 1.0300860404968262, 1.1102439165115356, 1.0591202974319458, 1.530400037765503, 1.1864701509475708, 1.0792068243026733, 1.037490725517273, 1.276747465133667, 1.0999507904052734, 1.124888300895691, 1.1308420896530151, 1.4864952564239502, 1.1172422170639038, 1.0703125, 1.005062460899353, 1.1816433668136597, 1.292235016822815, 1.1219208240509033, 1.1275086402893066, 1.0625275373458862, 1.2104159593582153, 1.0194147825241089, 1.0035499334335327, 1.1803044080734253, 1.0286366939544678, 1.0884467363357544, 1.0729451179504395, 1.246010661125183, 1.24538254737854, 1.109471082687378, 1.1334105730056763, 1.3704553842544556, 1.0232954025268555, 1.0072319507598877, 1.136837124824524, 1.0459431409835815, 1.1818181276321411, 1.0225157737731934, 1.2949591875076294, 1.043339490890503, 1.0607385635375977, 1.209822416305542, 1.0180885791778564, 1.273037314414978, 1.0157945156097412, 1.0207970142364502, 1.0008296966552734, 1.1910111904144287, 1.1724013090133667, 1.167019009590149, 1.0476301908493042, 1.240676760673523, 1.1103620529174805, 1.2014198303222656, 1.0450812578201294, 1.0476685762405396, 1.412871241569519, 1.3165185451507568, 1.6861640214920044, 1.0802675485610962, 1.0641100406646729, 1.1875, 1.27538001537323, 1.115006685256958]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.742067813873291] ms
 --  Average per query NF    [1.365729570388794] ms
 --  Average per query vegas [2.376338243484497] ms
Mean [1.147]  Median [1.123]  95th [1.356]  99th [1.532]  max [1.686]
Mean [1.147]  Median [1.123]  95th [1.356]  99th [1.532]  max [1.686]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.897168 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=valueskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
ValueSample - START
ValueSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[4.1723251e-07 8.9657903e-03 0.0000000e+00 1.7881393e-07 8.3446503e-07]
Distance score: 0.0017934441566467285
SAUCE Drift detection: True
Detection latency: 0.0233s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.045854 | Model-update-time: 2.228226


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=valueskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.168782472610474
tensor(0.9937)
result is  tensor(455722.9375)
Enter testHyper
ReportEsts: [1.0749202966690063, 1.2191632986068726, 1.1516778469085693, 1.2994509935379028, 1.0273447036743164, 1.655103087425232, 1.155061960220337, 1.0528408288955688, 1.3373534679412842, 3.291707992553711, 1.4577428102493286, 1.1745152473449707, 1.1643192768096924, 1.171223759651184, 30.0247745513916, 1.002426266670227, 1.10872220993042, 1.2568647861480713, 1.0021573305130005, 1.271730899810791, 1.1113840341567993, 2.049511671066284, 1.0151829719543457, 3.9215993881225586, 1.2203150987625122, 1.2841739654541016, 1.0116430521011353, 1.3215289115905762, 2.305349111557007, 1.477966070175171, 1.0106819868087769, 1.2340425252914429, 1.0028129816055298, 1.0664080381393433, 1.1959329843521118, 1.051397442817688, 1.342032790184021, 1.0071128606796265, 1.2175049781799316, 1.0254801511764526, 1.3139230012893677, 1.1404852867126465, 1.0284758806228638, 1.3076221942901611, 1.6033045053482056, 1.4838709831237793, 1.5266718864440918, 1.442853569984436, 1.3285714387893677, 1.0513116121292114, 1.244386076927185, 1.0524132251739502, 1.054469108581543, 1.0152817964553833, 1.107454776763916, 1.065364122390747, 1.3148353099822998, 1.2779624462127686, 1.4792389869689941, 1.4522969722747803, 1.531615972518921, 1.024539828300476, 1.9432367086410522, 1.5649725198745728, 1.050121784210205, 5.246449947357178, 1.2351593971252441, 1.091216802597046, 1.1344507932662964, 1.0826489925384521, 1.1391706466674805, 1.2246328592300415, 1.311723232269287, 1.2205333709716797, 2.0261404514312744, 1.0091378688812256, 73.24073791503906, 1.2082066535949707, 1.33598792552948, 1.1805064678192139, 1.2633812427520752, 1.0478380918502808, 1.0874847173690796, 1.199556589126587, 1.3430413007736206, 1.514893651008606, 1.077619194984436, 1.2332016229629517, 1.1056984663009644, 1.007013201713562, 1.018810510635376, 1.1135461330413818, 1.386294960975647, 1.1234757900238037, 44.61827850341797, 1.6751625537872314, 1.0287545919418335, 1.3198696374893188, 1.4963833093643188, 1.3465993404388428, 1.083377718925476, 1.3221065998077393, 1.1592506170272827, 1.2184343338012695, 1.1224308013916016, 1.2872215509414673, 1.0059983730316162, 1.0949796438217163, 1.048710584640503, 1.3831685781478882, 1.9184441566467285, 1.5915192365646362, 1.2351338863372803, 1.2326973676681519, 1.344706416130066, 1.048478603363037, 1.1211206912994385, 1.2901285886764526, 1.1405879259109497, 1.0147058963775635, 1.0924420356750488, 1.1216557025909424, 1.084625482559204, 1.547520637512207, 1.1807363033294678, 1.0247083902359009, 1.1463115215301514, 1.3327974081039429, 1.4452852010726929, 1.1406769752502441, 1.240605115890503, 1.0732877254486084, 1.050868272781372, 1.548076868057251, 1.4610837697982788, 1.0488191843032837, 1.101104497909546, 1.107818841934204, 1.3303923606872559, 1.3935127258300781, 1.2896860837936401, 1.1316317319869995, 1.198049545288086, 1.075785517692566, 1.0058780908584595, 1.150354027748108, 1.40666663646698, 1.0234862565994263, 1.1620173454284668, 1.0795114040374756, 1.2858946323394775, 1.0339943170547485, 1.1056311130523682, 1.0969103574752808, 1.1857155561447144, 2.0466320514678955, 1.0458499193191528, 1.0703125, 1.1247520446777344, 1.1104376316070557, 1.8353683948516846, 1.197619080543518, 1.2620984315872192, 1.074607491493225, 1.3314541578292847, 1.3074073791503906, 1.3204145431518555, 1.4708218574523926, 16.773536682128906, 1.240493893623352, 1.1365327835083008, 1.2024897336959839, 1.2934002876281738, 1.0606509447097778, 1.413009524345398, 1.3889081478118896, 1.1530994176864624, 1.0487632751464844, 1.1052862405776978, 1.2958794832229614, 1.6363636255264282, 1.3872073888778687, 1.1337660551071167, 1.4186713695526123, 1.4751249551773071, 1.1173286437988281, 1.3517203330993652, 1.0543299913406372, 1.5061861276626587, 1.0190417766571045, 1.1076470613479614, 1.1664564609527588, 1.2229323387145996, 1.4602150917053223, 1.012628436088562, 1.0145984888076782, 1.5913583040237427, 4.0740742683410645, 1.1070233583450317, 1.013022541999817]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.724377155303955] ms
 --  Average per query NF    [1.360478401184082] ms
 --  Average per query vegas [2.363898754119873] ms
Mean [2.097]  Median [1.198]  95th [2.047]  99th [30.171]  max [73.241]
Mean [2.097]  Median [1.198]  95th [2.047]  99th [30.171]  max [73.241]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.369993 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.568462