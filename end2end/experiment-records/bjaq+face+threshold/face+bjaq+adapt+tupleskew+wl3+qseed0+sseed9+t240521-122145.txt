Input arguments = Namespace(data_update='tupleskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 9, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.165470600128174
tensor(0.9940)
result is  tensor(379885.9688)
Enter testHyper
ReportEsts: [1.1971168518066406, 1.0414495468139648, 1.2619537115097046, 1.09391450881958, 1.269713282585144, 1.0667643547058105, 1.2403714656829834, 1.033463716506958, 1.0451780557632446, 1.1831942796707153, 1.1102497577667236, 1.18877112865448, 1.04092276096344, 1.0758928060531616, 1.061501145362854, 1.2519863843917847, 1.3667874336242676, 1.1736341714859009, 1.2054510116577148, 1.1045918464660645, 1.342403769493103, 1.0727421045303345, 1.1391708850860596, 1.1114856004714966, 1.0554602146148682, 1.1934900283813477, 1.0923423767089844, 1.5037243366241455, 1.0219357013702393, 1.085342288017273, 1.1046470403671265, 1.1501715183258057, 1.2374815940856934, 1.0418583154678345, 1.1542167663574219, 1.1101014614105225, 1.3205127716064453, 1.2932685613632202, 1.146257758140564, 1.097485065460205, 1.08793306350708, 1.1852927207946777, 1.14156174659729, 1.010282278060913, 1.0807099342346191, 1.0748299360275269, 1.050220251083374, 1.1699061393737793, 1.0249288082122803, 1.0846023559570312, 1.2068063020706177, 1.2575350999832153, 1.1187515258789062, 1.1970338821411133, 1.1834354400634766, 1.0088868141174316, 1.1336448192596436, 1.1462429761886597, 1.051898717880249, 1.4372574090957642, 1.365600824356079, 1.1398475170135498, 1.2883254289627075, 1.199397325515747, 1.2790697813034058, 1.3142857551574707, 1.2730964422225952, 1.0387343168258667, 1.1302255392074585, 1.3368420600891113, 1.0089285373687744, 1.026373267173767, 1.26579749584198, 1.2438914775848389, 1.078360676765442, 1.1107687950134277, 1.953932285308838, 1.025363564491272, 1.088066577911377, 1.3350938558578491, 1.3003836870193481, 1.1148440837860107, 1.0443331003189087, 1.1618928909301758, 1.2265664339065552, 1.0493251085281372, 1.0484356880187988, 1.08282470703125, 1.0590540170669556, 1.033170223236084, 1.073629379272461, 1.4039015769958496, 1.0025243759155273, 1.2446856498718262, 1.21875, 1.0948543548583984, 1.1007720232009888, 1.3623149394989014, 1.01694917678833, 1.116655707359314, 1.1567796468734741, 1.1930793523788452, 1.1710721254348755, 1.0111029148101807, 1.112447738647461, 1.0027821063995361, 1.1457922458648682, 1.228621244430542, 1.0882630348205566, 1.0399904251098633, 1.155635118484497, 1.130183219909668, 1.172985315322876, 1.0390043258666992, 1.0854294300079346, 1.15816330909729, 1.0715217590332031, 1.04991614818573, 1.339897632598877, 1.0416364669799805, 1.1917681694030762, 1.125845193862915, 1.13949453830719, 1.0743463039398193, 1.2950581312179565, 1.1689021587371826, 1.171617865562439, 1.277962565422058, 1.3517060279846191, 1.120908498764038, 1.1863313913345337, 1.2714861631393433, 1.2274705171585083, 1.4285714626312256, 1.1896594762802124, 1.0724599361419678, 1.063881754875183, 1.2969105243682861, 1.077057123184204, 1.1475704908370972, 1.1321618556976318, 1.191597580909729, 1.0891681909561157, 1.4258403778076172, 1.0766375064849854, 1.0543110370635986, 1.0760209560394287, 1.5956811904907227, 1.1056491136550903, 1.0534090995788574, 1.1718337535858154, 1.150749921798706, 1.3444323539733887, 1.191551685333252, 1.2335609197616577, 1.0895884037017822, 1.1520427465438843, 1.0002814531326294, 1.0288493633270264, 1.1644881963729858, 1.262205719947815, 1.0333172082901, 1.0027384757995605, 1.2924138307571411, 1.1512194871902466, 1.0129953622817993, 1.286362648010254, 1.271323323249817, 1.0389925241470337, 1.1006497144699097, 1.1552830934524536, 1.024245023727417, 1.2142857313156128, 1.134147047996521, 1.0159169435501099, 1.0735750198364258, 1.032096266746521, 1.3643648624420166, 1.3293513059616089, 1.0275994539260864, 1.0292932987213135, 1.01035737991333, 1.0065826177597046, 1.1593462228775024, 1.098877191543579, 1.1152219772338867, 1.042525291442871, 1.2576128244400024, 1.068982481956482, 1.4354537725448608, 1.059704303741455, 1.0653244256973267, 1.4502032995224, 1.4236856698989868, 1.84639573097229, 1.085106372833252, 1.1277198791503906, 1.0704225301742554, 1.039703130722046, 1.1016268730163574]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.75404953956604] ms
 --  Average per query NF    [1.3637268543243408] ms
 --  Average per query vegas [2.390322685241699] ms
Mean [1.161]  Median [1.130]  95th [1.405]  99th [1.598]  max [1.954]
Mean [1.161]  Median [1.130]  95th [1.405]  99th [1.598]  max [1.954]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.826452 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=tupleskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
TupleSkewSample - START
0.001
TupleSkewSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[2.7847290e-04 6.4969063e-05 8.3267689e-05 7.1525574e-06 1.4841557e-05]
Distance score: 8.97407517186366e-05
SAUCE Drift detection: True
Detection latency: 0.0225s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.014963 | Model-update-time: 2.257389


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=tupleskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.165580749511719
tensor(0.9939)
result is  tensor(455821.7500)
Enter testHyper
ReportEsts: [1.0993082523345947, 1.0350966453552246, 1.3720238208770752, 1.3001941442489624, 1.0475432872772217, 1.061405897140503, 1.1848758459091187, 1.0397288799285889, 1.0481466054916382, 1.1744606494903564, 1.126128077507019, 1.0033539533615112, 1.4376471042633057, 1.115258812904358, 1.0729423761367798, 1.0247617959976196, 1.1000633239746094, 1.133326530456543, 1.152429461479187, 1.259708046913147, 1.1153767108917236, 1.047217845916748, 1.1016874313354492, 1.042787790298462, 1.183893084526062, 1.062790036201477, 1.0758700370788574, 1.214009404182434, 1.234178900718689, 1.048933506011963, 1.0395480394363403, 1.5847457647323608, 1.5838640928268433, 1.2371355295181274, 1.0698636770248413, 1.1574866771697998, 1.1868244409561157, 1.1809577941894531, 1.5111709833145142, 1.0724129676818848, 1.0772218704223633, 1.2353556156158447, 1.1674776077270508, 1.0179595947265625, 1.058150053024292, 1.091514229774475, 4.752941131591797, 1.1481914520263672, 1.3285714387893677, 1.019992470741272, 1.013996958732605, 1.0104806423187256, 1.0656230449676514, 1.0274436473846436, 1.1079732179641724, 1.5785133838653564, 1.2718532085418701, 1.1685298681259155, 1.3008874654769897, 1.0878697633743286, 1.5200846195220947, 1.0071070194244385, 1.0722278356552124, 1.1581549644470215, 1.0155261754989624, 1.2458231449127197, 1.4012551307678223, 1.0684281587600708, 1.1288132667541504, 1.0133962631225586, 1.1810473203659058, 1.1088026762008667, 1.1207338571548462, 1.0124866962432861, 1.1799986362457275, 1.2593026161193848, 4.6086955070495605, 1.0668646097183228, 1.3490568399429321, 1.1290603876113892, 1.212621808052063, 1.1528713703155518, 1.059918761253357, 1.0095393657684326, 1.237106204032898, 1.6255319118499756, 1.4147535562515259, 1.4863080978393555, 1.0883585214614868, 1.4249471426010132, 1.007680058479309, 1.2093274593353271, 1.321905255317688, 1.1757268905639648, 1.0101909637451172, 1.1800713539123535, 1.004164457321167, 1.235658049583435, 1.1732686758041382, 1.4458333253860474, 1.3295602798461914, 1.114853024482727, 1.9033018350601196, 1.1075053215026855, 1.3217357397079468, 1.2486375570297241, 1.0621436834335327, 1.1983054876327515, 1.0401146411895752, 1.030935525894165, 1.0184376239776611, 1.0712127685546875, 1.2387871742248535, 1.2723602056503296, 1.1766589879989624, 1.0439434051513672, 1.0751991271972656, 1.2701172828674316, 1.0578426122665405, 1.0265486240386963, 1.0705314874649048, 1.3395638465881348, 1.0247929096221924, 1.7573529481887817, 1.005913257598877, 1.2257564067840576, 1.173598051071167, 1.0870968103408813, 1.2681846618652344, 1.014093279838562, 1.3924777507781982, 1.0578726530075073, 1.0247740745544434, 2.0319526195526123, 2.165618419647217, 1.1302634477615356, 1.0205706357955933, 1.2334691286087036, 1.0124266147613525, 1.0123435258865356, 1.1647865772247314, 1.2379708290100098, 1.0550371408462524, 1.0903233289718628, 1.0548924207687378, 1.1199666261672974, 2.5276074409484863, 1.070940375328064, 1.2527590990066528, 1.0908316373825073, 1.1873557567596436, 1.0862832069396973, 1.1248842477798462, 1.000266671180725, 1.067028522491455, 1.066592812538147, 1.109543800354004, 1.0538461208343506, 1.0705398321151733, 1.3258984088897705, 1.157496690750122, 1.1465733051300049, 1.1169872283935547, 1.012288212776184, 1.1474910974502563, 1.072218894958496, 1.0733641386032104, 1.1072721481323242, 1.1087751388549805, 1.256350040435791, 1.1009610891342163, 1.1833391189575195, 1.637474536895752, 1.1147080659866333, 1.0094971656799316, 1.0188735723495483, 1.1706222295761108, 1.0907647609710693, 1.0541422367095947, 1.0461220741271973, 1.9210525751113892, 1.0439103841781616, 1.0715062618255615, 1.3746306896209717, 1.3757941722869873, 1.610465168952942, 1.5028870105743408, 1.0766783952713013, 1.2006486654281616, 1.135404109954834, 1.1434550285339355, 1.124529480934143, 1.3008092641830444, 2.2249622344970703, 1.094067096710205, 1.0387665033340454, 1.336709976196289, 1.0965445041656494, 1.3209877014160156, 1.0211838483810425]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7423276901245117] ms
 --  Average per query NF    [1.3556015491485596] ms
 --  Average per query vegas [2.386726140975952] ms
Mean [1.226]  Median [1.120]  95th [1.626]  99th [2.548]  max [4.753]
Mean [1.226]  Median [1.120]  95th [1.626]  99th [2.548]  max [4.753]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.375809 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.500699