Input arguments = Namespace(data_update='valueskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 90, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.22145128250122
tensor(0.9944)
result is  tensor(380026.5625)
Enter testHyper
ReportEsts: [1.1780544519424438, 1.0681027173995972, 1.5050736665725708, 1.1259212493896484, 1.224366307258606, 1.09713613986969, 1.2700285911560059, 1.0787630081176758, 1.0718740224838257, 1.1462290287017822, 1.1197243928909302, 1.1180084943771362, 1.047537922859192, 1.0022321939468384, 1.1157464981079102, 1.2913663387298584, 1.1977523565292358, 1.1374108791351318, 1.1335431337356567, 1.0025510787963867, 1.125592589378357, 1.2083780765533447, 1.1762393712997437, 1.2021067142486572, 1.0924609899520874, 1.189873456954956, 1.1371058225631714, 1.3715498447418213, 1.0034582614898682, 1.006449580192566, 1.128414273262024, 1.1217049360275269, 1.089130163192749, 1.0634586811065674, 1.2230274677276611, 1.0886340141296387, 1.409423828125, 1.0418813228607178, 1.013628363609314, 1.0325748920440674, 1.0281429290771484, 1.074262261390686, 1.0471832752227783, 1.061185359954834, 1.1088104248046875, 1.1950113773345947, 1.122410535812378, 1.2719985246658325, 1.0336272716522217, 1.0896785259246826, 1.1912144422531128, 1.3411839008331299, 1.1909513473510742, 1.1103312969207764, 1.0128878355026245, 1.0256775617599487, 1.1785047054290771, 1.1177146434783936, 1.2435904741287231, 1.3963133096694946, 1.2957440614700317, 1.1579909324645996, 1.4906752109527588, 1.149204134941101, 1.1785714626312256, 1.3142857551574707, 1.0847750902175903, 1.1044992208480835, 1.0228134393692017, 1.2736842632293701, 1.0635559558868408, 1.121004343032837, 1.2298154830932617, 1.0390926599502563, 1.1392887830734253, 1.186202883720398, 1.6224653720855713, 1.102402687072754, 1.0627810955047607, 1.2239480018615723, 1.0968133211135864, 1.169116497039795, 1.020260214805603, 1.102176308631897, 1.2267227172851562, 1.1177518367767334, 1.111515760421753, 1.153593897819519, 1.0774043798446655, 1.0709013938903809, 1.0796709060668945, 1.4745829105377197, 1.0064911842346191, 1.2638347148895264, 1.1963189840316772, 1.1139249801635742, 1.1901596784591675, 1.303748607635498, 1.01694917678833, 1.1954872608184814, 1.2857142686843872, 1.0935627222061157, 1.0524238348007202, 1.002196192741394, 1.0376569032669067, 1.0590415000915527, 1.1208930015563965, 1.2076789140701294, 1.0454368591308594, 1.0782026052474976, 1.1762958765029907, 1.0943044424057007, 1.1497057676315308, 1.027296543121338, 1.1443144083023071, 1.1884816884994507, 1.083808183670044, 1.0412302017211914, 1.3105146884918213, 1.0383036136627197, 1.0990638732910156, 1.1134952306747437, 1.1514970064163208, 1.2600845098495483, 1.2117247581481934, 1.2091416120529175, 1.1034507751464844, 1.3679256439208984, 1.3446475267410278, 1.1469606161117554, 1.3238966464996338, 1.254597783088684, 1.261963963508606, 1.5714285373687744, 1.0592540502548218, 1.1044893264770508, 1.0190483331680298, 1.146016240119934, 1.0393174886703491, 1.3443429470062256, 1.179849624633789, 1.1423007249832153, 1.1748855113983154, 1.4187207221984863, 1.0664321184158325, 1.0573476552963257, 1.162624478340149, 1.5717726945877075, 1.0480422973632812, 1.0797585248947144, 1.1623879671096802, 1.1652352809906006, 1.290880560874939, 1.080640196800232, 1.1835652589797974, 1.0137654542922974, 1.0574815273284912, 1.0160382986068726, 1.0025527477264404, 1.1786929368972778, 1.0824023485183716, 1.0855811834335327, 1.0224649906158447, 1.3385714292526245, 1.2470277547836304, 1.1268962621688843, 1.186759114265442, 1.379164218902588, 1.0306452512741089, 1.033412218093872, 1.0031425952911377, 1.069622278213501, 1.201298713684082, 1.1592822074890137, 1.1301089525222778, 1.0521990060806274, 1.0238806009292603, 1.2617698907852173, 1.2215771675109863, 1.0065357685089111, 1.0765620470046997, 1.0234464406967163, 1.0046974420547485, 1.1930540800094604, 1.111915946006775, 1.1405919790267944, 1.152959942817688, 1.195276141166687, 1.1212365627288818, 1.3396306037902832, 1.017606258392334, 1.0686099529266357, 1.3639187812805176, 1.552234172821045, 1.5986086130142212, 1.1731234788894653, 1.0858690738677979, 1.1014492511749268, 1.128514051437378, 1.17320716381073]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7415194511413574] ms
 --  Average per query NF    [1.360921859741211] ms
 --  Average per query vegas [2.3805975914001465] ms
Mean [1.155]  Median [1.126]  95th [1.397]  99th [1.572]  max [1.622]
Mean [1.155]  Median [1.126]  95th [1.397]  99th [1.572]  max [1.622]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.874224 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=valueskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
ValueSample - START
ValueSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[5.9604645e-08 1.6689301e-06 3.9207339e-02 1.3113022e-06 5.9604645e-08]
Distance score: 0.007842088118195534
SAUCE Drift detection: True
Detection latency: 0.0233s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.050081 | Model-update-time: 2.259302


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=valueskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.156744480133057
tensor(0.9959)
result is  tensor(456732.0312)
Enter testHyper
ReportEsts: [1.0059442520141602, 1.129158616065979, 1.0568861961364746, 1.1558769941329956, 1.2272318601608276, 1.0102205276489258, 1.046902060508728, 1.1094205379486084, 1.135546326637268, 1.0537713766098022, 1.0837041139602661, 2.420300006866455, 1.2572815418243408, 1.0534472465515137, 1.180201530456543, 1.0188004970550537, 1.2080250978469849, 1.3229405879974365, 1.1647454500198364, 1.0288879871368408, 1.0782030820846558, 1.4373773336410522, 1.047446846961975, 1.0405820608139038, 1.0091570615768433, 1.4178848266601562, 1.079190731048584, 1.34176504611969, 1.4147546291351318, 1.468277931213379, 1.1002906560897827, 1.4152542352676392, 1.13434898853302, 70.67071533203125, 1.2373957633972168, 1.0907833576202393, 1.2164338827133179, 1.0484795570373535, 4.021360874176025, 1.2409924268722534, 1.0182796716690063, 1.2707535028457642, 1.028491497039795, 1.0574696063995361, 1.0205005407333374, 1.1150574684143066, 2.7032830715179443, 1.228462815284729, 1.1627906560897827, 1.147508144378662, 1.1478583812713623, 1.027904987335205, 1.066901683807373, 1.2029885053634644, 2.4623780250549316, 1.4504939317703247, 1.0934065580368042, 1.1240949630737305, 1.2661099433898926, 1.176624059677124, 1.3073170185089111, 1.2405439615249634, 1.6293325424194336, 1.6755813360214233, 1.16795015335083, 1.0518863201141357, 1.1753466129302979, 1.010209083557129, 1.0796316862106323, 1.0239980220794678, 1.400539517402649, 1.2791332006454468, 1.1976451873779297, 1.010374665260315, 1.0144449472427368, 1.5205161571502686, 47.69230651855469, 1.102449893951416, 1.0489963293075562, 1.0011404752731323, 3.42101788520813, 1.1025499105453491, 1.2305244207382202, 1.4114418029785156, 1.435377597808838, 1.2798634767532349, 1.3651199340820312, 1.5605162382125854, 1.142269253730774, 1.09052312374115, 1.0525931119918823, 1.3345630168914795, 1.4125685691833496, 1.0937594175338745, 1.019361972808838, 1.0655198097229004, 1.1506749391555786, 1.238115906715393, 2.227046251296997, 1.1058799028396606, 1.3031655550003052, 1.325323224067688, 1.034313678741455, 1.4790846109390259, 1.0581532716751099, 1.0133752822875977, 1.4104840755462646, 1.0755572319030762, 1.0630372762680054, 1.1225836277008057, 1.0230927467346191, 1.096209168434143, 1.0358960628509521, 1.3479962348937988, 1.1215702295303345, 1.2038664817810059, 1.1593523025512695, 9.957742691040039, 1.0076913833618164, 1.0442477464675903, 1.2248761653900146, 1.3638628721237183, 1.1697609424591064, 1.5380140542984009, 1.143547773361206, 1.0597506761550903, 1.0649374723434448, 1.046583890914917, 1.0059551000595093, 1.1646106243133545, 8.712016105651855, 1.2747564315795898, 1.0193332433700562, 1.2554606199264526, 1.282871961593628, 1.497438907623291, 1.2436726093292236, 1.5274956226348877, 1.0587356090545654, 1.1939846277236938, 1.1467626094818115, 1.333796501159668, 1.243811011314392, 1.139568567276001, 1.2272621393203735, 1.0437500476837158, 1.3888888359069824, 1.2666313648223877, 1.2939852476119995, 1.0688542127609253, 365.0869445800781, 1.0158977508544922, 1.1439845561981201, 1.0309211015701294, 1.0717567205429077, 1.4687997102737427, 1.0385009050369263, 1.2734375, 1.0862301588058472, 1.0641788244247437, 1.039413332939148, 1.169452428817749, 1.1435426473617554, 1.0399041175842285, 1.2218399047851562, 1.0082372426986694, 1.1264338493347168, 1.0283149480819702, 528.3513793945312, 1.3348026275634766, 1.224023461341858, 1.083802342414856, 1.4351297616958618, 1.063838243484497, 1.0, 1.0345394611358643, 1.1124122142791748, 1.32062828540802, 1.1536712646484375, 1.3054497241973877, 1.8157894611358643, 1.3527038097381592, 1.2508530616760254, 3.5126049518585205, 1.143984079360962, 1.5117348432540894, 1.295061707496643, 1.1189042329788208, 1.1766477823257446, 1.209567904472351, 1.1208405494689941, 1.0823274850845337, 1.0229936838150024, 1.9744292497634888, 1.2440630197525024, 2.6349384784698486, 2.1286725997924805, 1.106870174407959, 1.2456964254379272, 1.0477358102798462]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7454402446746826] ms
 --  Average per query NF    [1.36519193649292] ms
 --  Average per query vegas [2.3802483081817627] ms
Mean [6.378]  Median [1.158]  95th [2.638]  99th [73.615]  max [528.351]
Mean [6.378]  Median [1.158]  95th [2.638]  99th [73.615]  max [528.351]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.406471 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.648417