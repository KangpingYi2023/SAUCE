Input arguments = Namespace(data_update='valueskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 3, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.160874605178833
tensor(0.9914)
result is  tensor(378894.2812)
Enter testHyper
ReportEsts: [1.1024112701416016, 1.019711971282959, 1.1952533721923828, 1.06380295753479, 1.2411679029464722, 1.1475869417190552, 1.1601723432540894, 1.1537140607833862, 1.105698585510254, 1.0422130823135376, 1.0663220882415771, 1.0976694822311401, 1.1078464984893799, 1.0267857313156128, 1.1005969047546387, 1.3241857290267944, 1.1731151342391968, 1.1572446823120117, 1.1261167526245117, 1.0714285373687744, 1.1237190961837769, 1.0841134786605835, 1.1377270221710205, 1.0666630268096924, 1.2605570554733276, 1.0415912866592407, 1.01081383228302, 1.3744680881500244, 1.0158061981201172, 1.1150442361831665, 1.242993950843811, 1.0574390888214111, 1.1597827672958374, 1.1005686521530151, 1.2069263458251953, 1.2281477451324463, 1.5685420036315918, 1.013320803642273, 1.0759094953536987, 1.0985628366470337, 1.0018502473831177, 1.128809928894043, 1.0040452480316162, 1.1181875467300415, 1.105852484703064, 1.0907028913497925, 1.1202130317687988, 1.228792667388916, 1.1144037246704102, 1.094754695892334, 1.2163587808609009, 1.1349313259124756, 1.1875522136688232, 1.2452770471572876, 1.2171889543533325, 1.023643970489502, 1.2523365020751953, 1.1313163042068481, 1.1061677932739258, 1.45992112159729, 1.122342824935913, 1.1665222644805908, 1.3274540901184082, 1.111822485923767, 1.375, 1.1428571939468384, 1.1368993520736694, 1.0631712675094604, 1.0780738592147827, 1.4947367906570435, 1.109412670135498, 1.0744519233703613, 1.2613564729690552, 1.0752229690551758, 1.1311789751052856, 1.1448723077774048, 1.9073554277420044, 1.0431252717971802, 1.0784367322921753, 1.3413227796554565, 1.2769086360931396, 1.0717170238494873, 1.057677984237671, 1.19495689868927, 1.2670701742172241, 1.1312754154205322, 1.1222574710845947, 1.0116015672683716, 1.0101265907287598, 1.067501425743103, 1.0785526037216187, 1.252839207649231, 1.0090975761413574, 1.337870717048645, 1.0714285373687744, 1.0472724437713623, 1.2369675636291504, 1.3583167791366577, 1.01694917678833, 1.2187061309814453, 1.1234568357467651, 1.1064783334732056, 1.0028787851333618, 1.012445092201233, 1.1097279787063599, 1.0827969312667847, 1.1152271032333374, 1.1937172412872314, 1.0052695274353027, 1.1193299293518066, 1.2313706874847412, 1.0922646522521973, 1.0834828615188599, 1.0348931550979614, 1.098759651184082, 1.0707547664642334, 1.0043145418167114, 1.1039597988128662, 1.2407301664352417, 1.1024006605148315, 1.2217596769332886, 1.1396440267562866, 1.2426484823226929, 1.216666340827942, 1.215116262435913, 1.240404486656189, 1.1390801668167114, 1.1501796245574951, 1.3493449687957764, 1.1189044713974, 1.1042729616165161, 1.3038897514343262, 1.2218769788742065, 1.4642857313156128, 1.0467419624328613, 1.0021002292633057, 1.0233718156814575, 1.1291056871414185, 1.0253212451934814, 1.261041522026062, 1.1341032981872559, 1.1678715944290161, 1.1509425640106201, 1.360595941543579, 1.0894582271575928, 1.0633968114852905, 1.0411505699157715, 1.4165538549423218, 1.275080919265747, 1.0647016763687134, 1.2166779041290283, 1.1936931610107422, 1.2895288467407227, 1.1015561819076538, 1.247879147529602, 1.0020498037338257, 1.0240205526351929, 1.0196961164474487, 1.0389294624328613, 1.2748433351516724, 1.0929063558578491, 1.2397493124008179, 1.005021572113037, 1.3031989336013794, 1.280868411064148, 1.1321499347686768, 1.2085899114608765, 1.0626112222671509, 1.1174782514572144, 1.0058039426803589, 1.0949206352233887, 1.050208568572998, 1.149350643157959, 1.2286685705184937, 1.125, 1.0683608055114746, 1.0729926824569702, 1.2449462413787842, 1.0985287427902222, 1.047038197517395, 1.0141663551330566, 1.0302754640579224, 1.0095778703689575, 1.046986699104309, 1.0996016263961792, 1.1448203325271606, 1.0152678489685059, 1.2809269428253174, 1.1069086790084839, 1.4941730499267578, 1.0308139324188232, 1.087261438369751, 1.5241655111312866, 1.4854025840759277, 1.852327823638916, 1.0464363098144531, 1.1602751016616821, 1.0555555820465088, 1.1328859329223633, 1.1416335105895996]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.8026821613311768] ms
 --  Average per query NF    [1.376662254333496] ms
 --  Average per query vegas [2.4260199069976807] ms
Mean [1.153]  Median [1.119]  95th [1.377]  99th [1.571]  max [1.907]
Mean [1.153]  Median [1.119]  95th [1.377]  99th [1.571]  max [1.907]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.853517 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=valueskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
ValueSample - START
ValueSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[ 1.1154532e-02  2.3841858e-07  1.8477440e-06 -2.9802322e-08
  5.3644180e-07]
Distance score: 0.002231425140053034
SAUCE Drift detection: True
Detection latency: 0.0233s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.044523 | Model-update-time: 2.230789


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=valueskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.166855335235596
tensor(0.9964)
result is  tensor(456969.0312)
Enter testHyper
ReportEsts: [1.088086485862732, 1.0094337463378906, 1.04283607006073, 1.001791000366211, 1.310265302658081, 1.258492350578308, 1.2184739112854004, 1.0509356260299683, 1.0641461610794067, 1.0817092657089233, 1.0322030782699585, 1.2236453294754028, 1.9734299182891846, 1.0630549192428589, 807.5999755859375, 1.3336254358291626, 3.8223185539245605, 1.1278656721115112, 1.0434455871582031, 1.1005313396453857, 1.0907741785049438, 1.7055283784866333, 1.0863271951675415, 1.111192226409912, 1.1539218425750732, 1.4922397136688232, 1.01469886302948, 1.1029618978500366, 1.1176470518112183, 1.3230489492416382, 1.1101491451263428, 1.3884892463684082, 1.1428272724151611, 1.0472975969314575, 1.090124487876892, 1.0651345252990723, 1.039722204208374, 1.310713529586792, 2.9647438526153564, 1.0523954629898071, 1.0255637168884277, 1.0973261594772339, 144.0, 1.100081205368042, 1.0713387727737427, 1.2058686017990112, 1.9127788543701172, 1.0562427043914795, 1.2429150342941284, 1.197110891342163, 1.041375756263733, 1.0938594341278076, 1.0723592042922974, 1.0872483253479004, 1.16275954246521, 1.493607521057129, 1.3157684803009033, 1.0902374982833862, 1.0258108377456665, 1.1327667236328125, 1.4767441749572754, 1.099246859550476, 1.063055396080017, 1.7555816173553467, 1.1756298542022705, 1.0184739828109741, 1.325561761856079, 1.2462105751037598, 1.0326828956604004, 1.362847089767456, 1.0489729642868042, 1.0338581800460815, 1.1211074590682983, 1.1286972761154175, 1.0163778066635132, 1.0931507349014282, 26.540000915527344, 1.2226603031158447, 1.4436205625534058, 1.0993157625198364, 1.6622856855392456, 1.1537904739379883, 1.2108738422393799, 1.2305943965911865, 1.069523572921753, 1.6382979154586792, 1.2262835502624512, 1.5742435455322266, 1.154429316520691, 1.06443190574646, 1.060323715209961, 1.356899380683899, 1.4219727516174316, 1.0246000289916992, 1.2183104753494263, 1.0746687650680542, 1.0053508281707764, 1.2065602540969849, 2.135193109512329, 2.515336275100708, 1.417577862739563, 1.3193944692611694, 1.0122549533843994, 1.0822616815567017, 1.0136598348617554, 1.0002244710922241, 1.0071293115615845, 1.028056025505066, 1.1432507038116455, 1.012575387954712, 3.551020383834839, 1.1285648345947266, 1.0742775201797485, 1.197750449180603, 1.066834807395935, 1.4141054153442383, 1.0859198570251465, 1.258489727973938, 1.090635895729065, 1.0991735458374023, 1.0979925394058228, 1.076244831085205, 1.0670427083969116, 5.777777671813965, 1.1543325185775757, 1.1723970174789429, 1.1503180265426636, 1.0664557218551636, 1.0591106414794922, 23.274648666381836, 4.127901077270508, 1.1048387289047241, 1.2239617109298706, 4.376321315765381, 1.2345505952835083, 1.3689689636230469, 1.08974289894104, 1.14408278465271, 1.2679541110992432, 1.1877270936965942, 1.0884732007980347, 1.3586905002593994, 1.2833833694458008, 1.2416772842407227, 1.2198470830917358, 1.212842345237732, 1.3764045238494873, 1.1247355937957764, 1.1966643333435059, 1.1071981191635132, 1.0876542329788208, 1.2107048034667969, 1.0678534507751465, 1.0750664472579956, 1.2011815309524536, 1.00789475440979, 1.1914149522781372, 1.0458015203475952, 1.0561959743499756, 1.1347140073776245, 1.1155728101730347, 1.1297619342803955, 1.017227292060852, 1.243249773979187, 1.2349438667297363, 12.266666412353516, 1.0184087753295898, 2.8133609294891357, 184.0, 1.3057012557983398, 1.0723352432250977, 1.1283965110778809, 1.4084415435791016, 1.118700623512268, 1.0618526935577393, 1.0187069177627563, 2.0179812908172607, 1.0894689559936523, 1.2475286722183228, 1.1220356225967407, 1.3617020845413208, 1.1434069871902466, 1.1223942041397095, 1.58412504196167, 1.0618736743927002, 7.6173930168151855, 1.3642261028289795, 1.3055070638656616, 1.4137176275253296, 1.1987860202789307, 1.0326963663101196, 1.020508885383606, 1.2038296461105347, 1.6837960481643677, 1.3003392219543457, 1.0743904113769531, 1.14756441116333, 1.0247604846954346, 1.2555910348892212, 1.5109386444091797]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.734152317047119] ms
 --  Average per query NF    [1.3571953773498535] ms
 --  Average per query vegas [2.3769569396972656] ms
Mean [7.279]  Median [1.139]  95th [3.838]  99th [144.400]  max [807.600]
Mean [7.279]  Median [1.139]  95th [3.838]  99th [144.400]  max [807.600]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.369255 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.525151