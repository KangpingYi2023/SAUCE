Input arguments = Namespace(data_update='valueskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 34, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.164830446243286
tensor(0.9950)
result is  tensor(380241.6875)
Enter testHyper
ReportEsts: [1.1669056415557861, 1.0219109058380127, 1.4410260915756226, 1.0913876295089722, 1.2173539400100708, 1.1029547452926636, 1.094687819480896, 1.041885495185852, 1.1138888597488403, 1.043623924255371, 1.0826873779296875, 1.148728847503662, 1.0806663036346436, 1.0290178060531616, 1.1262112855911255, 1.0513782501220703, 1.1579984426498413, 1.3311164379119873, 1.2327628135681152, 1.005128264427185, 1.0312553644180298, 1.013383150100708, 1.1757258176803589, 1.0632377862930298, 1.1482479572296143, 1.1537070274353027, 1.1120495796203613, 1.496062994003296, 1.0083876848220825, 1.0150748491287231, 1.1599857807159424, 1.2740834951400757, 1.2018228769302368, 1.0815922021865845, 1.2063910961151123, 1.0888748168945312, 1.4189261198043823, 1.26885986328125, 1.0281959772109985, 1.1597604751586914, 1.0316455364227295, 1.0833333730697632, 1.0179237127304077, 1.002384901046753, 1.0849355459213257, 1.023201823234558, 1.1222344636917114, 1.3573094606399536, 1.0603748559951782, 1.1421319246292114, 1.1974025964736938, 1.328080654144287, 1.043738603591919, 1.2945990562438965, 1.121877908706665, 1.0447380542755127, 1.2971962690353394, 1.1804255247116089, 1.2264407873153687, 1.3887499570846558, 1.2585365772247314, 1.1661431789398193, 1.3756992816925049, 1.114025354385376, 1.4042552709579468, 1.1142857074737549, 1.0894874334335327, 1.0704644918441772, 1.0036358833312988, 1.4315789937973022, 1.046296238899231, 1.0240064859390259, 1.3472206592559814, 1.2856770753860474, 1.0736768245697021, 1.1481114625930786, 1.8253626823425293, 1.0648369789123535, 1.100853443145752, 1.313906192779541, 1.1489170789718628, 1.0629947185516357, 1.0449591875076294, 1.1770036220550537, 1.171654462814331, 1.0542839765548706, 1.0488022565841675, 1.2874149084091187, 1.0555611848831177, 1.0299361944198608, 1.040482521057129, 1.5522801876068115, 1.0010830163955688, 1.2606505155563354, 1.065573811531067, 1.0058752298355103, 1.1468695402145386, 1.2673884630203247, 1.034482717514038, 1.1458665132522583, 1.1584157943725586, 1.1378711462020874, 1.0422804355621338, 1.00737464427948, 1.0351922512054443, 1.067061185836792, 1.2070363759994507, 1.2111692428588867, 1.0951004028320312, 1.0240509510040283, 1.2828097343444824, 1.0821791887283325, 1.1039117574691772, 1.075000524520874, 1.1333024501800537, 1.1464647054672241, 1.0550669431686401, 1.0092867612838745, 1.4317842721939087, 1.141863465309143, 1.2391096353530884, 1.0983855724334717, 1.159365177154541, 1.1137710809707642, 1.2839146852493286, 1.15744948387146, 1.1500673294067383, 1.1842405796051025, 1.1902927160263062, 1.1158984899520874, 1.160600185394287, 1.190969705581665, 1.2336854934692383, 1.4285714626312256, 1.0075392723083496, 1.0247511863708496, 1.0393861532211304, 1.1082926988601685, 1.0618422031402588, 1.217695713043213, 1.1191198825836182, 1.1146494150161743, 1.003472089767456, 1.3149195909500122, 1.0760220289230347, 1.084227442741394, 1.1022865772247314, 1.543148398399353, 1.0339601039886475, 1.1615056991577148, 1.201829433441162, 1.118830919265747, 1.356277585029602, 1.1424944400787354, 1.1343823671340942, 1.0270057916641235, 1.0020453929901123, 1.0334833860397339, 1.0603984594345093, 1.0002387762069702, 1.0776137113571167, 1.0170503854751587, 1.011405110359192, 1.2730978727340698, 1.187421441078186, 1.0787630081176758, 1.0920614004135132, 1.2976988554000854, 1.063011884689331, 1.0215840339660645, 1.0452035665512085, 1.0224180221557617, 1.2077921628952026, 1.0618067979812622, 1.1192097663879395, 1.3234413862228394, 1.0078355073928833, 1.2675716876983643, 1.154831051826477, 1.0583397150039673, 1.0146528482437134, 1.1151832342147827, 1.0249221324920654, 1.1297242641448975, 1.164070963859558, 1.1405919790267944, 1.0209660530090332, 1.3332096338272095, 1.025004267692566, 1.4030840396881104, 1.1486655473709106, 1.0823829174041748, 1.500920295715332, 1.7339071035385132, 1.6489859819412231, 1.191149353981018, 1.0781575441360474, 1.1176470518112183, 1.1147119998931885, 1.0433598756790161]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.761998414993286] ms
 --  Average per query NF    [1.3708853721618652] ms
 --  Average per query vegas [2.391113042831421] ms
Mean [1.151]  Median [1.115]  95th [1.429]  99th [1.650]  max [1.825]
Mean [1.151]  Median [1.115]  95th [1.429]  99th [1.650]  max [1.825]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.831756 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=valueskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
ValueSample - START
ValueSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[8.3446503e-07 1.6093254e-06 4.7177792e-02 1.0728836e-06 5.3644180e-07]
Distance score: 0.009436368942260742
SAUCE Drift detection: True
Detection latency: 0.0233s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.048680 | Model-update-time: 2.236681


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=valueskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.22027587890625
tensor(0.9961)
result is  tensor(456822.7500)
Enter testHyper
ReportEsts: [1.1578928232192993, 1.2665156126022339, 1.0616540908813477, 1.024375557899475, 1.3119518756866455, 1.3111968040466309, 1.0340588092803955, 1.3141179084777832, 1.143567442893982, 1.271304726600647, 1.3519525527954102, 1.9808285236358643, 1.274999976158142, 1.1449766159057617, 1.1056588888168335, 1.0643177032470703, 1.3414102792739868, 1.5010846853256226, 1.435778021812439, 1.100184440612793, 1.2302074432373047, 1.8690868616104126, 1.0421963930130005, 1.2897425889968872, 1.1082279682159424, 1.548366665840149, 1.0485674142837524, 1.3884204626083374, 1.2302157878875732, 1.333943247795105, 1.025715708732605, 1.5423728227615356, 1.0354021787643433, 74.42073059082031, 1.0732972621917725, 1.0401495695114136, 1.2437556982040405, 1.1555460691452026, 6.8007354736328125, 1.3548897504806519, 1.0343263149261475, 1.1647509336471558, 1.8180354833602905, 1.0554457902908325, 1.0096927881240845, 1.1072998046875, 2.2445619106292725, 1.0484223365783691, 1.0682730674743652, 1.0504306554794312, 1.1598938703536987, 1.0461244583129883, 1.1316678524017334, 1.0943396091461182, 2.3199665546417236, 1.4222655296325684, 1.0683555603027344, 1.2347090244293213, 1.2473512887954712, 1.0139060020446777, 1.1404255628585815, 1.1490375995635986, 1.9127206802368164, 1.6793348789215088, 1.0809025764465332, 1.0674397945404053, 1.146466612815857, 1.005360722541809, 1.067705750465393, 1.111372470855713, 1.334532380104065, 1.2319014072418213, 1.163490653038025, 1.0906522274017334, 1.0182465314865112, 1.3718926906585693, 320.24603271484375, 1.2319148778915405, 1.5914690494537354, 1.0487549304962158, 3.116252899169922, 1.1766533851623535, 1.1833412647247314, 1.3061960935592651, 1.3966535329818726, 1.3768116235733032, 1.430003046989441, 1.717919111251831, 1.355463981628418, 1.062397837638855, 1.293906807899475, 1.0508052110671997, 1.3816657066345215, 1.194930911064148, 1.4330644607543945, 1.0591015815734863, 1.1804755926132202, 1.3276900053024292, 2.212825059890747, 1.1388590335845947, 1.4386496543884277, 1.434815526008606, 1.038167953491211, 1.398202657699585, 1.0776177644729614, 1.8271335363388062, 1.2236824035644531, 1.1704658269882202, 1.0234603881835938, 1.1735398769378662, 1.0611134767532349, 1.0037051439285278, 1.0082130432128906, 1.0970838069915771, 1.0647034645080566, 1.01134192943573, 1.0278661251068115, 21.850990295410156, 1.017706274986267, 1.0707964897155762, 1.123641014099121, 1.2523365020751953, 1.0761264562606812, 1.630656123161316, 1.2071402072906494, 1.1107410192489624, 1.0349705219268799, 1.063091516494751, 1.1955476999282837, 1.0759150981903076, 23.04492950439453, 1.3464255332946777, 1.0345404148101807, 1.6483790874481201, 1.5577731132507324, 1.2838730812072754, 1.044560432434082, 1.159928560256958, 1.058247447013855, 1.1521329879760742, 1.2013163566589355, 1.0168858766555786, 1.198799729347229, 1.1491752862930298, 1.2057698965072632, 1.026139736175537, 1.546012282371521, 1.0807318687438965, 1.0557079315185547, 1.0675314664840698, 382.6428527832031, 1.0617773532867432, 1.096908450126648, 1.1082196235656738, 1.1133323907852173, 1.4623538255691528, 1.002819299697876, 1.3153846263885498, 1.0419763326644897, 1.0680745840072632, 1.0155773162841797, 1.154157042503357, 1.3280813694000244, 1.160202145576477, 1.1735317707061768, 1.0322250127792358, 1.2225338220596313, 1.1266098022460938, 1832.0, 1.1404246091842651, 1.051774501800537, 1.0274300575256348, 1.4778459072113037, 1.0031976699829102, 1.0094724893569946, 1.0440082550048828, 1.149532675743103, 1.2199746370315552, 1.238991379737854, 1.2580416202545166, 1.8157894611358643, 1.2832930088043213, 1.1419678926467896, 1.1328868865966797, 1.3847399950027466, 1.421553373336792, 1.1883623600006104, 1.0155566930770874, 1.1217581033706665, 1.0902483463287354, 1.205049991607666, 1.232570767402649, 1.0200051069259644, 2.102912664413452, 1.172021508216858, 2.7554028034210205, 2.169262647628784, 1.0334581136703491, 1.3327702283859253, 1.0381382703781128]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.711932897567749] ms
 --  Average per query NF    [1.357886791229248] ms
 --  Average per query vegas [2.354046106338501] ms
Mean [14.512]  Median [1.160]  95th [2.248]  99th [320.870]  max [1832.000]
Mean [14.512]  Median [1.160]  95th [2.248]  99th [320.870]  max [1832.000]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.464962 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.607002