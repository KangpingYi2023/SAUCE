Input arguments = Namespace(data_update='tupleskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 5, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.163766145706177
tensor(0.9933)
result is  tensor(379620.7188)
Enter testHyper
ReportEsts: [1.1842257976531982, 1.0890743732452393, 1.283912181854248, 1.0787534713745117, 1.2858439683914185, 1.169090747833252, 1.2051489353179932, 1.2839802503585815, 1.0349870920181274, 1.163199543952942, 1.0104438066482544, 1.1766948699951172, 1.1422368288040161, 1.0580357313156128, 1.0208061933517456, 1.277467131614685, 1.3380217552185059, 1.1320664882659912, 1.1835681200027466, 1.0586735010147095, 1.1444189548492432, 1.0153429508209229, 1.1197504997253418, 1.0269488096237183, 1.0469655990600586, 1.1853525638580322, 1.0577139854431152, 1.2966680526733398, 1.0965522527694702, 1.0954124927520752, 1.1238027811050415, 1.274688959121704, 1.020844578742981, 1.1547764539718628, 1.2265278100967407, 1.0508785247802734, 1.39448881149292, 1.0507662296295166, 1.0949639081954956, 1.0604790449142456, 1.0602993965148926, 1.1230043172836304, 1.0634835958480835, 1.090606689453125, 1.1073315143585205, 1.0827664136886597, 1.0841290950775146, 1.5287935733795166, 1.0399929285049438, 1.106598973274231, 1.1912144422531128, 1.3690707683563232, 1.1140680313110352, 1.239423394203186, 1.184731364250183, 1.0136277675628662, 1.2607476711273193, 1.1045366525650024, 1.1669408082962036, 1.3241955041885376, 1.4834617376327515, 1.153895616531372, 1.2851386070251465, 1.116098403930664, 1.2643678188323975, 1.1714285612106323, 1.208092451095581, 1.0168675184249878, 1.0511754751205444, 1.2105263471603394, 1.0789930820465088, 1.078737497329712, 1.2486540079116821, 1.1797796487808228, 1.0872020721435547, 1.0218087434768677, 1.7700251340866089, 1.059761643409729, 1.0384759902954102, 1.357433795928955, 1.048734426498413, 1.212566614151001, 1.0020933151245117, 1.204719066619873, 1.2237610816955566, 1.0410937070846558, 1.0819125175476074, 1.0123059749603271, 1.0803048610687256, 1.0267020463943481, 1.0598456859588623, 1.1543691158294678, 1.021637201309204, 1.3301111459732056, 1.107954502105713, 1.1872214078903198, 1.106402039527893, 1.3462209701538086, 1.0166666507720947, 1.2062541246414185, 1.115803837776184, 1.1590921878814697, 1.0537381172180176, 1.002936840057373, 1.0087865591049194, 1.048095941543579, 1.2277508974075317, 1.1954624652862549, 1.0422886610031128, 1.0531038045883179, 1.2629917860031128, 1.0772058963775635, 1.2413474321365356, 1.0626839399337769, 1.0714037418365479, 1.140703558921814, 1.0041851997375488, 1.019476294517517, 1.2956273555755615, 1.0384001731872559, 1.1955193281173706, 1.1395059823989868, 1.071947693824768, 1.158867359161377, 1.2708333730697632, 1.228642225265503, 1.0105974674224854, 1.2802342176437378, 1.3505244255065918, 1.1242485046386719, 1.298517107963562, 1.1718863248825073, 1.1243008375167847, 1.5, 1.1470528841018677, 1.206878423690796, 1.0248756408691406, 1.160650372505188, 1.030730128288269, 1.265211582183838, 1.1833839416503906, 1.1466368436813354, 1.210842490196228, 1.2971954345703125, 1.0517016649246216, 1.0261507034301758, 1.117691993713379, 1.4776650667190552, 1.0233091115951538, 1.0635653734207153, 1.1042400598526, 1.1583130359649658, 1.3171123266220093, 1.0726045370101929, 1.1585599184036255, 1.0132209062576294, 1.273823857307434, 1.0180463790893555, 1.1210427284240723, 1.2682781219482422, 1.1751266717910767, 1.0163816213607788, 1.0542683601379395, 1.3385714292526245, 1.169764518737793, 1.1151536703109741, 1.1198465824127197, 1.2758527994155884, 1.0569454431533813, 1.0188970565795898, 1.0323090553283691, 1.059492588043213, 1.0714285373687744, 1.2228167057037354, 1.0282697677612305, 1.106392502784729, 1.0743440389633179, 1.1702041625976562, 1.2455716133117676, 1.3495888710021973, 1.059308648109436, 1.0100011825561523, 1.0094839334487915, 1.1041879653930664, 1.1187975406646729, 1.1183931827545166, 1.0553926229476929, 1.3032281398773193, 1.019948959350586, 1.3394185304641724, 1.0113334655761719, 1.0821726322174072, 1.590415120124817, 1.1258381605148315, 1.9450408220291138, 1.1831501722335815, 1.062442660331726, 1.1692308187484741, 1.018301010131836, 1.0620850324630737]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7646830081939697] ms
 --  Average per query NF    [1.360243558883667] ms
 --  Average per query vegas [2.4044394493103027] ms
Mean [1.152]  Median [1.119]  95th [1.351]  99th [1.592]  max [1.945]
Mean [1.152]  Median [1.119]  95th [1.351]  99th [1.592]  max [1.945]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.836915 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=tupleskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
TupleSkewSample - START
0.001
TupleSkewSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[1.6808510e-05 1.2922287e-04 1.4370680e-04 1.0430813e-04 2.1326542e-04]
Distance score: 0.00012146234803367406
SAUCE Drift detection: True
Detection latency: 0.0228s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 1.991486 | Model-update-time: 2.233143


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=tupleskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.169150590896606
tensor(0.9982)
result is  tensor(457794.6562)
Enter testHyper
ReportEsts: [1.0864313840866089, 1.0450544357299805, 1.2703081369400024, 1.4750473499298096, 1.0670613050460815, 1.0134048461914062, 1.1242016553878784, 1.190684199333191, 1.037984013557434, 1.095349669456482, 1.0692858695983887, 1.006601095199585, 1.4538835287094116, 1.0, 1.1461774110794067, 1.0194334983825684, 1.0489201545715332, 1.1791598796844482, 1.1345174312591553, 1.2577595710754395, 1.1668429374694824, 1.0106143951416016, 1.7975293397903442, 1.1150627136230469, 1.2640714645385742, 1.308746337890625, 1.079040765762329, 1.0871539115905762, 1.1438840627670288, 1.52670156955719, 1.251165509223938, 1.48305082321167, 1.0309889316558838, 1.074198603630066, 1.1357234716415405, 1.101180911064148, 1.0251356363296509, 1.2054959535598755, 2.039238929748535, 1.0313773155212402, 1.0671812295913696, 1.0520408153533936, 1.068554401397705, 1.0707685947418213, 1.1298164129257202, 1.0718189477920532, 1.5991735458374023, 1.1701431274414062, 1.4571428298950195, 1.1548746824264526, 1.0216008424758911, 1.0267893075942993, 1.1254472732543945, 1.0213431119918823, 1.0271049737930298, 1.0327268838882446, 1.1601861715316772, 1.1986793279647827, 1.3603328466415405, 1.1906088590621948, 2.035087823867798, 1.0129495859146118, 1.2313348054885864, 1.5396325588226318, 1.0065007209777832, 1.1318087577819824, 1.3217536211013794, 1.1018542051315308, 1.1447025537490845, 1.072400450706482, 1.4787769317626953, 1.0196607112884521, 1.0143567323684692, 1.0613245964050293, 1.2594774961471558, 1.1640337705612183, 1.476426362991333, 1.1968460083007812, 1.130382776260376, 1.064881443977356, 1.1454286575317383, 1.2598108053207397, 1.0558106899261475, 1.2438663244247437, 1.4915211200714111, 1.1357702016830444, 1.2675557136535645, 1.5231127738952637, 1.0277172327041626, 1.6096653938293457, 1.0307124853134155, 1.1677075624465942, 1.3648828268051147, 1.0012527704238892, 1.6986725330352783, 1.033595085144043, 1.030971884727478, 1.286320447921753, 1.4716417789459229, 1.0150498151779175, 1.2332326173782349, 1.157872200012207, 1.0147058963775635, 1.2379276752471924, 1.1475498676300049, 1.3949329853057861, 1.060217022895813, 1.2237181663513184, 1.0, 1.0085651874542236, 1.323192834854126, 1.052604079246521, 1.106674075126648, 1.2065749168395996, 1.363773226737976, 1.0222426652908325, 1.0888901948928833, 1.4095876216888428, 1.286974549293518, 1.0089285373687744, 1.0340616703033447, 1.323496699333191, 1.0394165515899658, 1.0923469066619873, 1.1629629135131836, 1.0581623315811157, 1.032869815826416, 1.7504078149795532, 1.0337088108062744, 1.0338491201400757, 1.6634408235549927, 1.1236817836761475, 1.0282446146011353, 1.5022727251052856, 1.543859601020813, 1.0629149675369263, 1.0542900562286377, 1.1490249633789062, 1.0883327722549438, 1.044440507888794, 1.0987749099731445, 1.1914047002792358, 1.04996919631958, 1.0666704177856445, 1.0777543783187866, 1.3188506364822388, 1.2126436233520508, 1.074629306793213, 1.240069031715393, 1.140350103378296, 1.3448275327682495, 1.1609498262405396, 1.1657066345214844, 1.0741324424743652, 1.0227279663085938, 1.2590371370315552, 1.0776482820510864, 2.5390625, 1.0442439317703247, 1.2522863149642944, 1.042643666267395, 1.1416666507720947, 1.31658136844635, 1.0142523050308228, 1.1011569499969482, 2.639575958251953, 1.0107285976409912, 1.1801286935806274, 1.161102294921875, 1.172602891921997, 1.2050734758377075, 1.1143652200698853, 1.677374243736267, 1.1181788444519043, 1.1441092491149902, 1.027268409729004, 1.1578562259674072, 1.0169423818588257, 1.037441611289978, 1.2515207529067993, 2.0526316165924072, 1.2875486612319946, 1.054425835609436, 1.5249557495117188, 1.407501220703125, 1.087646245956421, 1.271322250366211, 1.2391815185546875, 1.2822601795196533, 1.011578917503357, 1.1939278841018677, 1.0432497262954712, 1.2759100198745728, 2.080653190612793, 1.1179392337799072, 50.75, 1.3716109991073608, 1.0617778301239014, 1.895052433013916, 1.014910340309143]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7092161178588867] ms
 --  Average per query NF    [1.363217830657959] ms
 --  Average per query vegas [2.3459982872009277] ms
Mean [1.460]  Median [1.138]  95th [1.701]  99th [2.540]  max [50.750]
Mean [1.460]  Median [1.138]  95th [1.701]  99th [2.540]  max [50.750]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.348541 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.461575