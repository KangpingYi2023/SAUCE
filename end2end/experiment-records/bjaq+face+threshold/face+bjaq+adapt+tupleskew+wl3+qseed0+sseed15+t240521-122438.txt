Input arguments = Namespace(data_update='tupleskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 15, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.169810771942139
tensor(0.9952)
result is  tensor(380341.6250)
Enter testHyper
ReportEsts: [1.1932551860809326, 1.081095814704895, 1.4364591836929321, 1.026321291923523, 1.2371944189071655, 1.1138315200805664, 1.4011249542236328, 1.0702095031738281, 1.023539423942566, 1.084568738937378, 1.0801033973693848, 1.1472457647323608, 1.237121820449829, 1.0334821939468384, 1.1121760606765747, 1.2503762245178223, 1.2820892333984375, 1.17505943775177, 1.2220067977905273, 1.0076531171798706, 1.1812833547592163, 1.030489444732666, 1.1508547067642212, 1.023571491241455, 1.2202891111373901, 1.1853525638580322, 1.0962837934494019, 1.7487818002700806, 1.0081690549850464, 1.035093069076538, 1.1773678064346313, 1.1482750177383423, 1.1069073677062988, 1.0597354173660278, 1.1152610778808594, 1.0976868867874146, 1.7091175317764282, 1.0554895401000977, 1.0139776468276978, 1.0941317081451416, 1.0229105949401855, 1.1014755964279175, 1.0079140663146973, 1.0030885934829712, 1.1109232902526855, 1.1496598720550537, 1.1455113887786865, 1.2634817361831665, 1.0073283910751343, 1.0541455745697021, 1.2099738121032715, 1.3489116430282593, 1.0170427560806274, 1.300986886024475, 1.0541942119598389, 1.0751043558120728, 1.209345817565918, 1.1131852865219116, 1.1725465059280396, 1.3111722469329834, 1.2863531112670898, 1.1744109392166138, 1.436112403869629, 1.0933109521865845, 1.2406015396118164, 1.3714286088943481, 1.057335615158081, 1.0798357725143433, 1.088138222694397, 1.4947367906570435, 1.0734024047851562, 1.0005056858062744, 1.1955448389053345, 1.2460004091262817, 1.1761630773544312, 1.13004732131958, 1.4255684614181519, 1.0074938535690308, 1.0104371309280396, 1.3288551568984985, 1.0814056396484375, 1.140526533126831, 1.0331189632415771, 1.1914358139038086, 1.3021904230117798, 1.0710935592651367, 1.1197113990783691, 1.0387893915176392, 1.041027307510376, 1.0186582803726196, 1.0411875247955322, 1.4568151235580444, 1.010457992553711, 1.2549020051956177, 1.0955055952072144, 1.1002286672592163, 1.05120050907135, 1.3873183727264404, 1.0, 1.1141278743743896, 1.148667573928833, 1.1359301805496216, 1.0344586372375488, 1.005890965461731, 1.0186468362808228, 1.0226283073425293, 1.0793651342391968, 1.2094241380691528, 1.0717508792877197, 1.0592682361602783, 1.197830319404602, 1.0811808109283447, 1.0662580728530884, 1.0995301008224487, 1.2164136171340942, 1.065727710723877, 1.019428014755249, 1.0567522048950195, 1.336544394493103, 1.0076904296875, 1.2360260486602783, 1.117703914642334, 1.0911515951156616, 1.1877349615097046, 1.2960271835327148, 1.2011969089508057, 1.1768171787261963, 1.2891508340835571, 1.2540584802627563, 1.1092184782028198, 1.123146414756775, 1.203875184059143, 1.2799875736236572, 1.4285714626312256, 1.1028183698654175, 1.1583092212677002, 1.0484100580215454, 1.0858536958694458, 1.1011168956756592, 1.1896766424179077, 1.180098533630371, 1.1504360437393188, 1.0908509492874146, 1.2053872346878052, 1.0054242610931396, 1.0685675144195557, 1.0515943765640259, 1.3095989227294922, 1.0328130722045898, 1.1181107759475708, 1.2013630867004395, 1.1667734384536743, 1.315002679824829, 1.0832213163375854, 1.0261117219924927, 1.0310642719268799, 1.219122052192688, 1.024198055267334, 1.0738884210586548, 1.1720679998397827, 1.1347999572753906, 1.0630899667739868, 1.0676592588424683, 1.314165472984314, 1.1158392429351807, 1.1187101602554321, 1.138005256652832, 1.295000433921814, 1.0744794607162476, 1.0593560934066772, 1.0664503574371338, 1.0550768375396729, 1.149350643157959, 1.2438833713531494, 1.0596048831939697, 1.1358275413513184, 1.0160349607467651, 1.2603962421417236, 1.2060561180114746, 1.0051547288894653, 1.115635871887207, 1.0140032768249512, 1.0089211463928223, 1.1276812553405762, 1.1633466482162476, 1.1374207735061646, 1.2059760093688965, 1.3098796606063843, 1.0728154182434082, 1.3568145036697388, 1.000793695449829, 1.0826151371002197, 1.5418692827224731, 1.2035841941833496, 1.3256134986877441, 1.2415118217468262, 1.0780324935913086, 1.1515151262283325, 1.1030197143554688, 1.0770584344863892]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.64865779876709] ms
 --  Average per query NF    [1.3556444644927979] ms
 --  Average per query vegas [2.293013334274292] ms
Mean [1.148]  Median [1.115]  95th [1.388]  99th [1.544]  max [1.749]
Mean [1.148]  Median [1.115]  95th [1.388]  99th [1.544]  max [1.749]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.778328 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=tupleskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
TupleSkewSample - START
0.001
TupleSkewSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[9.5069408e-05 1.1211634e-04 7.3909760e-05 6.2763691e-05 1.8894672e-05]
Distance score: 7.255077071022242e-05
SAUCE Drift detection: True
Detection latency: 0.0240s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 1.996836 | Model-update-time: 2.230799


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=tupleskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.173547506332397
tensor(0.9951)
result is  tensor(456356.8125)
Enter testHyper
ReportEsts: [1.1180741786956787, 1.0754640102386475, 1.0114613771438599, 1.2193394899368286, 1.009495735168457, 1.0535376071929932, 1.1623477935791016, 1.1615554094314575, 1.1171467304229736, 1.06162691116333, 1.0959125757217407, 1.0366671085357666, 1.8758621215820312, 1.230523943901062, 1.1506723165512085, 1.0013432502746582, 1.7737704515457153, 1.14404296875, 1.0464999675750732, 1.2724722623825073, 1.0733915567398071, 1.4434592723846436, 1.0970919132232666, 1.0111356973648071, 1.1213980913162231, 1.2557059526443481, 1.0297071933746338, 1.2065541744232178, 1.114609718322754, 1.8497109413146973, 1.4761072397232056, 1.6355931758880615, 1.0594497919082642, 1.0967967510223389, 1.0761083364486694, 1.077682614326477, 1.251807451248169, 1.1025917530059814, 1.684744119644165, 1.0039812326431274, 1.0895421504974365, 1.1353768110275269, 1.001810908317566, 1.0216608047485352, 1.089693307876587, 1.135591745376587, 1.1416345834732056, 1.0035624504089355, 1.3428571224212646, 1.2146843671798706, 1.0267105102539062, 1.060631275177002, 1.0091841220855713, 1.030233383178711, 1.0684711933135986, 1.1941323280334473, 1.1270734071731567, 1.0618500709533691, 1.1466861963272095, 1.2245256900787354, 1.3267326354980469, 1.0979502201080322, 1.1030391454696655, 1.2722139358520508, 1.0779447555541992, 1.0648263692855835, 1.3931334018707275, 1.0036498308181763, 1.1192238330841064, 1.0340276956558228, 1.1056978702545166, 1.3376775979995728, 1.1521306037902832, 1.0126994848251343, 1.0357972383499146, 1.0838901996612549, 1.2055538892745972, 1.1967365741729736, 1.3487244844436646, 1.2392579317092896, 2.081818103790283, 1.0587632656097412, 1.0824263095855713, 1.159392237663269, 1.3761606216430664, 1.570212721824646, 1.2952650785446167, 1.3893643617630005, 1.1816649436950684, 1.1264101266860962, 1.1607338190078735, 1.2719120979309082, 1.438761830329895, 1.1175627708435059, 1.0155919790267944, 1.03912353515625, 1.0884740352630615, 1.1772267818450928, 1.1976405382156372, 1.330342173576355, 1.1017025709152222, 1.2176859378814697, 1.034313678741455, 1.1156673431396484, 1.0458498001098633, 1.2027273178100586, 1.0528385639190674, 1.0734211206436157, 1.03438401222229, 1.0354034900665283, 2.321917772293091, 1.0612508058547974, 1.0642887353897095, 1.1858779191970825, 1.2344388961791992, 1.0069327354431152, 1.1455469131469727, 1.2109078168869019, 1.0829254388809204, 1.1858407258987427, 1.0420931577682495, 1.223052978515625, 1.0620111227035522, 1.1562939882278442, 1.0577056407928467, 1.036232352256775, 1.0226267576217651, 1.4190938472747803, 1.0546947717666626, 1.207258701324463, 1.0111044645309448, 1.0964382886886597, 1.1243371963500977, 1.578125, 1.5393664836883545, 1.389760136604309, 1.103440761566162, 1.0555058717727661, 1.2016440629959106, 1.0305777788162231, 1.002956509590149, 1.1216919422149658, 1.1059021949768066, 1.0456116199493408, 1.061132788658142, 1.0165064334869385, 1.2057143449783325, 1.1176542043685913, 1.200677752494812, 1.1605144739151, 1.02035653591156, 1.0917373895645142, 1.1190685033798218, 1.0824426412582397, 1.017325758934021, 1.3031082153320312, 1.0746673345565796, 1.0959999561309814, 1.4175996780395508, 1.309369444847107, 1.0045621395111084, 1.3376835584640503, 1.7688524723052979, 1.0085049867630005, 1.1279106140136719, 1.117659091949463, 1.099213719367981, 1.1418282985687256, 1.1486965417861938, 1.280418872833252, 1.0963160991668701, 1.1742634773254395, 1.6458046436309814, 1.2266852855682373, 1.0955111980438232, 1.0579389333724976, 1.1407444477081299, 1.0700243711471558, 1.1475809812545776, 1.0161561965942383, 1.8157894611358643, 1.1172538995742798, 1.0861222743988037, 1.4023511409759521, 1.3434587717056274, 1.8572977781295776, 1.0336191654205322, 1.0803050994873047, 1.2453538179397583, 1.0156432390213013, 1.1356086730957031, 1.1564024686813354, 1.1945841312408447, 1.7632311582565308, 1.0427712202072144, 1.3413755893707275, 1.5616700649261475, 1.1242884397506714, 1.0960265398025513, 1.018410563468933]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7249529361724854] ms
 --  Average per query NF    [1.354658603668213] ms
 --  Average per query vegas [2.3702943325042725] ms
Mean [1.187]  Median [1.118]  95th [1.648]  99th [1.878]  max [2.322]
Mean [1.187]  Median [1.118]  95th [1.648]  99th [1.878]  max [2.322]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.378056 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.444382