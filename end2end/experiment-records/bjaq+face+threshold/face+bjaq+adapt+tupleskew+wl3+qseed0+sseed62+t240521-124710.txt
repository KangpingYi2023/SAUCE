Input arguments = Namespace(data_update='tupleskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 62, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.16802430152893
tensor(0.9992)
result is  tensor(381869.8125)
Enter testHyper
ReportEsts: [1.1458743810653687, 1.1292147636413574, 1.454351544380188, 1.1320277452468872, 1.2525044679641724, 1.1743299961090088, 1.2688926458358765, 1.1951203346252441, 1.0427621603012085, 1.1753697395324707, 1.0051679611206055, 1.0889830589294434, 1.0550991296768188, 1.0424107313156128, 1.1799124479293823, 1.269446611404419, 1.417099952697754, 1.120783805847168, 1.2182667255401611, 1.0688775777816772, 1.0438899993896484, 1.0203421115875244, 1.122083306312561, 1.0657237768173218, 1.1053663492202759, 1.0144665241241455, 1.0422297716140747, 1.2304761409759521, 1.0091688632965088, 1.0415014028549194, 1.0709471702575684, 1.1881941556930542, 1.002553939819336, 1.0840595960617065, 1.0343024730682373, 1.0181453227996826, 1.5436227321624756, 1.0363984107971191, 1.081641435623169, 1.141317367553711, 1.0452818870544434, 1.1092162132263184, 1.0875405073165894, 1.072054147720337, 1.111557126045227, 1.0056688785552979, 1.0838826894760132, 1.222553014755249, 1.0754982233047485, 1.0896785259246826, 1.146766185760498, 1.4046666622161865, 1.1620745658874512, 1.0591858625411987, 1.1188148260116577, 1.0941121578216553, 1.3037383556365967, 1.108852505683899, 1.1413451433181763, 1.3444937467575073, 1.205607533454895, 1.1618646383285522, 1.306244969367981, 1.3531782627105713, 1.3414634466171265, 1.0285714864730835, 1.1087533235549927, 1.0582878589630127, 1.141563057899475, 1.2736842632293701, 1.0196882486343384, 1.0836191177368164, 1.2892062664031982, 1.1423232555389404, 1.0085121393203735, 1.057597041130066, 1.857391357421875, 1.0172444581985474, 1.0287714004516602, 1.4865479469299316, 1.1584619283676147, 1.1038604974746704, 1.0373013019561768, 1.2583576440811157, 1.2265664339065552, 1.1353187561035156, 1.0084121227264404, 1.1471374034881592, 1.0128620862960815, 1.1127787828445435, 1.148018479347229, 1.3760356903076172, 1.0191128253936768, 1.25662100315094, 1.0209424495697021, 1.1236400604248047, 1.1250706911087036, 1.2264165878295898, 1.0, 1.1563524007797241, 1.1203830242156982, 1.0610500574111938, 1.0173602104187012, 1.004392385482788, 1.0043933391571045, 1.0552353858947754, 1.1241655349731445, 1.1937172412872314, 1.096537709236145, 1.054638147354126, 1.3489677906036377, 1.0984067916870117, 1.2131072282791138, 1.0288219451904297, 1.0578416585922241, 1.1464647054672241, 1.0056744813919067, 1.0620404481887817, 1.3052527904510498, 1.0276771783828735, 1.1646825075149536, 1.1109424829483032, 1.2871240377426147, 1.3049896955490112, 1.3139535188674927, 1.1941807270050049, 1.1254938840866089, 1.0365417003631592, 1.3446475267410278, 1.1396125555038452, 1.1308246850967407, 1.2108732461929321, 1.1205717325210571, 1.5357142686843872, 1.0567963123321533, 1.0149645805358887, 1.0584874153137207, 1.0543088912963867, 1.0338512659072876, 1.0010454654693604, 1.1793020963668823, 1.1469851732254028, 1.048887014389038, 1.2658227682113647, 1.0188623666763306, 1.0432863235473633, 1.114113450050354, 1.4903751611709595, 1.0039736032485962, 1.11328125, 1.1705461740493774, 1.1493397951126099, 1.3080191612243652, 1.1246522665023804, 1.2635962963104248, 1.0107909440994263, 1.2500131130218506, 1.0483776330947876, 1.027282476425171, 1.1681885719299316, 1.1660425662994385, 1.046972393989563, 1.042198896408081, 1.1801007986068726, 1.1028037071228027, 1.1578947305679321, 1.1452021598815918, 1.0716743469238281, 1.0437127351760864, 1.0323314666748047, 1.076533317565918, 1.2364740371704102, 1.0714285373687744, 1.234186053276062, 1.071924090385437, 1.0692548751831055, 1.0204081535339355, 1.38758385181427, 1.0777957439422607, 1.116848111152649, 1.012892723083496, 1.0274020433425903, 1.0177165269851685, 1.046986699104309, 1.1289387941360474, 1.124735713005066, 1.0356251001358032, 1.1948785781860352, 1.073880910873413, 1.5007094144821167, 1.0263783931732178, 1.0146247148513794, 1.7904642820358276, 1.3248289823532104, 1.6589933633804321, 1.1875, 1.1537307500839233, 1.0704225301742554, 1.007066249847412, 1.0821380615234375]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7459075450897217] ms
 --  Average per query NF    [1.3626301288604736] ms
 --  Average per query vegas [2.383277416229248] ms
Mean [1.144]  Median [1.112]  95th [1.405]  99th [1.660]  max [1.857]
Mean [1.144]  Median [1.112]  95th [1.405]  99th [1.660]  max [1.857]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.895278 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=tupleskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
TupleSkewSample - START
0.001
TupleSkewSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[1.5199184e-05 1.0430813e-05 3.8743019e-06 3.6406517e-04 3.0875206e-05]
Distance score: 8.488893217872828e-05
SAUCE Drift detection: True
Detection latency: 0.0227s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.004804 | Model-update-time: 2.226538


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=tupleskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.196640968322754
tensor(0.9954)
result is  tensor(456492.6562)
Enter testHyper
ReportEsts: [1.0844961404800415, 1.0588250160217285, 1.6618075370788574, 1.1636404991149902, 1.0765337944030762, 1.022684097290039, 1.2487881183624268, 1.085456132888794, 1.085431694984436, 1.2155362367630005, 1.0076086521148682, 1.1122409105300903, 1.5588972568511963, 1.0196309089660645, 1.0689239501953125, 1.090054988861084, 1.0458873510360718, 1.07614266872406, 1.083688735961914, 1.3057489395141602, 1.0977126359939575, 1.0680843591690063, 1.5447676181793213, 1.1128361225128174, 1.0534098148345947, 1.1696661710739136, 1.057213306427002, 1.2491192817687988, 1.2286627292633057, 1.1984282732009888, 1.2572463750839233, 1.4745762348175049, 1.1777323484420776, 1.0233474969863892, 1.1305121183395386, 1.1037086248397827, 1.1884416341781616, 1.094656229019165, 1.1265463829040527, 1.1118159294128418, 1.1598432064056396, 1.1877394914627075, 1.086309552192688, 1.0105475187301636, 1.0431135892868042, 1.0948758125305176, 1.0550103187561035, 1.0532822608947754, 1.3809523582458496, 1.1011313199996948, 1.0628899335861206, 1.1159467697143555, 1.057747483253479, 1.026293396949768, 1.0671330690383911, 1.1943069696426392, 1.1926895380020142, 1.1459985971450806, 1.170121669769287, 1.2059266567230225, 2.281622886657715, 1.010758399963379, 1.0917136669158936, 1.1445337533950806, 1.084747552871704, 1.13502836227417, 1.2301071882247925, 1.0179545879364014, 1.173360824584961, 1.0538105964660645, 1.1276798248291016, 1.1138943433761597, 1.1433424949645996, 1.2799363136291504, 1.1764895915985107, 1.034467101097107, 1.1794872283935547, 1.2745097875595093, 1.1371608972549438, 1.1052954196929932, 1.4925124645233154, 1.0590933561325073, 1.1200414896011353, 1.222566843032837, 1.3547847270965576, 1.600000023841858, 1.105076551437378, 1.5935606956481934, 1.1731833219528198, 1.279822826385498, 1.205202341079712, 1.053938388824463, 1.1610454320907593, 1.1236763000488281, 1.1093754768371582, 1.0759141445159912, 1.21122145652771, 1.1987370252609253, 1.6072670221328735, 1.182133436203003, 1.0520492792129517, 1.0935721397399902, 1.5555555820465088, 1.0842350721359253, 1.1471959352493286, 1.0840708017349243, 1.0634821653366089, 1.0926998853683472, 1.0085959434509277, 1.0057616233825684, 1.295448660850525, 1.0413764715194702, 1.279388666152954, 1.3765323162078857, 1.1772205829620361, 1.0180689096450806, 1.1773638725280762, 1.5726170539855957, 1.0345795154571533, 1.0089285373687744, 1.1191747188568115, 1.1912659406661987, 1.054691195487976, 1.4328052997589111, 1.0173033475875854, 1.0431004762649536, 1.0153353214263916, 1.3581395149230957, 1.0679234266281128, 1.0043697357177734, 1.1061983108520508, 1.14888334274292, 1.032007098197937, 1.3353534936904907, 1.5018287897109985, 1.0847108364105225, 1.0528138875961304, 1.2888257503509521, 1.0408812761306763, 1.08284592628479, 1.08670175075531, 1.1627610921859741, 1.0509215593338013, 1.150153636932373, 1.0033628940582275, 1.195469856262207, 1.14673912525177, 1.0413106679916382, 1.1050689220428467, 1.1317344903945923, 1.3090888261795044, 1.0251551866531372, 1.276953935623169, 1.0509529113769531, 1.0092304944992065, 1.2780007123947144, 1.303221583366394, 2.935483932495117, 1.7188667058944702, 1.014053225517273, 1.0514849424362183, 1.060623288154602, 1.1630885601043701, 1.12655508518219, 1.2297651767730713, 1.2231898307800293, 1.0366283655166626, 1.2417813539505005, 1.059765338897705, 1.1834080219268799, 1.0072590112686157, 1.2725257873535156, 1.8754500150680542, 1.1608939170837402, 1.022544026374817, 1.0577973127365112, 1.1690977811813354, 1.1693856716156006, 1.0691763162612915, 1.0408858060836792, 1.9736841917037964, 1.2170886993408203, 1.146735668182373, 1.2668706178665161, 1.1185499429702759, 1.1714609861373901, 1.1014404296875, 1.1265851259231567, 1.6013585329055786, 1.0004750490188599, 1.0814800262451172, 1.0330734252929688, 1.3153421878814697, 1.6432801485061646, 1.1360650062561035, 1.0826445817947388, 1.686511516571045, 1.1413954496383667, 1.116357445716858, 1.1154727935791016]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.736085891723633] ms
 --  Average per query NF    [1.3532507419586182] ms
 --  Average per query vegas [2.3828351497650146] ms
Mean [1.186]  Median [1.122]  95th [1.600]  99th [1.977]  max [2.935]
Mean [1.186]  Median [1.122]  95th [1.600]  99th [1.977]  max [2.935]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.413915 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.565452