Input arguments = Namespace(data_update='tupleskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 42, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.19985818862915
tensor(0.9952)
result is  tensor(380343.2812)
Enter testHyper
ReportEsts: [1.087095856666565, 1.0353178977966309, 1.500863790512085, 1.0366393327713013, 1.255463719367981, 1.0771127939224243, 1.2118531465530396, 1.1881661415100098, 1.081510305404663, 1.0218709707260132, 1.139534831047058, 1.2309322357177734, 1.0315314531326294, 1.046875, 1.0928208827972412, 1.2395225763320923, 1.2354830503463745, 1.2821853160858154, 1.1145004034042358, 1.0892857313156128, 1.132892370223999, 1.1797752380371094, 1.1612764596939087, 1.138795256614685, 1.160826563835144, 1.0985532999038696, 1.060247778892517, 1.5581283569335938, 1.017555594444275, 1.1367104053497314, 1.1830435991287231, 1.0399173498153687, 1.0057673454284668, 1.0189235210418701, 1.0744935274124146, 1.1520096063613892, 1.3244127035140991, 1.304267406463623, 1.0037412643432617, 1.1174850463867188, 1.0398286581039429, 1.0758345127105713, 1.0887775421142578, 1.0794042348861694, 1.1236002445220947, 1.0340136289596558, 1.0929930210113525, 1.3483970165252686, 1.1602482795715332, 1.1201353073120117, 1.2841225862503052, 1.345466136932373, 1.006535530090332, 1.1677000522613525, 1.1317743062973022, 1.0781177282333374, 1.2271027565002441, 1.2895537614822388, 1.318780541419983, 1.3132387399673462, 1.0701731443405151, 1.190513014793396, 1.4461054801940918, 1.0304925441741943, 1.3469387292861938, 1.2571429014205933, 1.1504586935043335, 1.1448755264282227, 1.0262515544891357, 1.2736842632293701, 1.2180209159851074, 1.0534073114395142, 1.1383496522903442, 1.200862169265747, 1.0584099292755127, 1.0673977136611938, 2.2276737689971924, 1.0070922374725342, 1.1024103164672852, 1.1873964071273804, 1.0915149450302124, 1.0238134860992432, 1.0019100904464722, 1.2367538213729858, 1.2035740613937378, 1.1328831911087036, 1.0193768739700317, 1.003984808921814, 1.0787187814712524, 1.1563977003097534, 1.018593430519104, 1.2446879148483276, 1.0054093599319458, 1.2269282341003418, 1.1470588445663452, 1.1212750673294067, 1.1798651218414307, 1.2168426513671875, 1.0, 1.1874356269836426, 1.0499999523162842, 1.0419940948486328, 1.0735156536102295, 1.0, 1.0653765201568604, 1.018072247505188, 1.2458422183990479, 1.1832460165023804, 1.081413984298706, 1.033555507659912, 1.2016324996948242, 1.079189658164978, 1.1940773725509644, 1.0236115455627441, 1.0992233753204346, 1.2472527027130127, 1.068145990371704, 1.0132851600646973, 1.321815848350525, 1.1543737649917603, 1.1964054107666016, 1.0934869050979614, 1.108288288116455, 1.1504769325256348, 1.2214146852493286, 1.2353487014770508, 1.0741671323776245, 1.1163562536239624, 1.3160135746002197, 1.1295925378799438, 1.0736768245697021, 1.2390397787094116, 1.2339962720870972, 1.3928571939468384, 1.1662085056304932, 1.0036754608154297, 1.0312750339508057, 1.0523576736450195, 1.0336536169052124, 1.039673924446106, 1.149186134338379, 1.0617201328277588, 1.1406965255737305, 1.3475871086120605, 1.0495166778564453, 1.03999924659729, 1.0940980911254883, 1.5226666927337646, 1.0030817985534668, 1.0909801721572876, 1.1542081832885742, 1.1695936918258667, 1.3829309940338135, 1.0960932970046997, 1.098106026649475, 1.052140712738037, 1.06051504611969, 1.0365785360336304, 1.0125643014907837, 1.140256643295288, 1.214877963066101, 1.0591559410095215, 1.0505321025848389, 1.1997438669204712, 1.2984869480133057, 1.070169448852539, 1.0482579469680786, 1.2197904586791992, 1.0057238340377808, 1.0359587669372559, 1.1302814483642578, 1.1679316759109497, 1.1233766078948975, 1.2199186086654663, 1.0190906524658203, 1.1109659671783447, 1.0296404361724854, 1.3465921878814697, 1.115939974784851, 1.0097225904464722, 1.013413667678833, 1.0531405210494995, 1.0164870023727417, 1.1062308549880981, 1.0977905988693237, 1.0983086824417114, 1.0515981912612915, 1.2073252201080322, 1.0184270143508911, 1.3427482843399048, 1.0033633708953857, 1.0032745599746704, 1.469240665435791, 1.3399840593338013, 1.5175879001617432, 1.163265347480774, 1.119508147239685, 1.1692308187484741, 1.1058156490325928, 1.1534196138381958]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.763047456741333] ms
 --  Average per query NF    [1.365736722946167] ms
 --  Average per query vegas [2.397310733795166] ms
Mean [1.145]  Median [1.116]  95th [1.348]  99th [1.523]  max [2.228]
Mean [1.145]  Median [1.116]  95th [1.348]  99th [1.523]  max [2.228]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.862770 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=tupleskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
TupleSkewSample - START
0.001
TupleSkewSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[1.06453896e-04 7.21216202e-06 1.40666962e-05 5.57303429e-05
 9.35792923e-06]
Distance score: 3.8564205169677734e-05
SAUCE Drift detection: True
Detection latency: 0.0233s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.004004 | Model-update-time: 2.229754


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=tupleskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.157419443130493
tensor(0.9937)
result is  tensor(455730.)
Enter testHyper
ReportEsts: [1.0141438245773315, 1.035522699356079, 1.0339943170547485, 3.6419754028320312, 1.101426124572754, 1.1907771825790405, 1.2666938304901123, 1.1157317161560059, 1.1244608163833618, 1.051348328590393, 1.0417804718017578, 1.3028433322906494, 1.0310262441635132, 1.2559365034103394, 1.018204927444458, 1.0247389078140259, 1.0251779556274414, 1.1816118955612183, 1.1009360551834106, 1.3325101137161255, 1.2380383014678955, 1.0709214210510254, 1.0561118125915527, 1.0079092979431152, 1.1826518774032593, 1.0973092317581177, 1.0619738101959229, 1.2615541219711304, 1.2485861778259277, 1.3280575275421143, 1.0740913152694702, 1.5338983535766602, 1.057225227355957, 1.7433809041976929, 1.1556012630462646, 1.1096229553222656, 1.085687279701233, 1.0262473821640015, 1.1760237216949463, 1.2124626636505127, 1.0413219928741455, 1.0334378480911255, 3.3586957454681396, 1.095908761024475, 1.0034685134887695, 1.333397388458252, 1.3079441785812378, 1.0658701658248901, 1.3142857551574707, 1.06696355342865, 1.0357866287231445, 1.0019131898880005, 1.08171546459198, 1.025437355041504, 1.140323281288147, 1.3599157333374023, 1.2107325792312622, 1.2148469686508179, 1.4164079427719116, 1.017073392868042, 1.5098592042922974, 1.0550203323364258, 1.1194580793380737, 1.0583332777023315, 1.0695935487747192, 1.1554466485977173, 1.3687387704849243, 1.005418062210083, 1.104429841041565, 1.1058789491653442, 1.17368745803833, 1.0663230419158936, 1.2132819890975952, 1.1611260175704956, 1.142343282699585, 1.0073603391647339, 1.0252528190612793, 1.0623397827148438, 1.0245944261550903, 1.0197603702545166, 1.036851167678833, 1.0290403366088867, 1.1845589876174927, 1.1833701133728027, 1.2136846780776978, 1.6042553186416626, 1.1782817840576172, 1.264668345451355, 1.0631792545318604, 1.045107364654541, 1.0523165464401245, 1.1659289598464966, 1.2848467826843262, 1.242676019668579, 1.2899043560028076, 1.038670301437378, 1.0506861209869385, 1.167887568473816, 1.2628118991851807, 1.4176621437072754, 1.0675959587097168, 1.1728185415267944, 1.0124069452285767, 1.3471403121948242, 1.0670676231384277, 1.1332929134368896, 1.0668845176696777, 1.2501204013824463, 1.0115941762924194, 1.1271520853042603, 1.0111753940582275, 1.0347603559494019, 1.1662530899047852, 1.2705289125442505, 1.068361759185791, 1.0521541833877563, 1.2035529613494873, 1.3024086952209473, 1.1304200887680054, 1.1504424810409546, 1.1289654970169067, 1.0072529315948486, 1.0134960412979126, 1.1766659021377563, 1.2132328748703003, 1.2335339784622192, 1.3792555332183838, 1.0547730922698975, 1.07689368724823, 1.2253159284591675, 1.1495020389556885, 1.2271661758422852, 1.170593023300171, 1.5425903797149658, 1.3031634092330933, 1.0545035600662231, 1.000465750694275, 1.1460295915603638, 1.078389048576355, 1.000867247581482, 1.0972697734832764, 1.2071343660354614, 1.155969500541687, 1.055001974105835, 1.042925477027893, 1.0833308696746826, 1.2057143449783325, 1.0585936307907104, 1.032728672027588, 1.3025405406951904, 1.2365113496780396, 1.115926742553711, 1.1640069484710693, 1.1631908416748047, 1.1274393796920776, 1.1055071353912354, 1.4363770484924316, 1.1048387289047241, 1.156904697418213, 1.2069624662399292, 1.0045652389526367, 1.2096583843231201, 1.5678308010101318, 1.0935728549957275, 1.162033200263977, 1.1119517087936401, 1.2065770626068115, 1.1984766721725464, 1.7417962551116943, 1.261122226715088, 1.0610138177871704, 1.0812656879425049, 1.5449477434158325, 1.0640121698379517, 1.0312763452529907, 1.003867506980896, 1.0992956161499023, 1.0737974643707275, 1.1817513704299927, 1.0384259223937988, 1.7894736528396606, 1.279109001159668, 1.1327242851257324, 1.4414572715759277, 1.4642225503921509, 1.2844319343566895, 1.533449411392212, 1.1445157527923584, 1.326884150505066, 1.091984748840332, 1.2292457818984985, 1.039642572402954, 1.2877041101455688, 1.6880990266799927, 1.0537705421447754, 1.0363669395446777, 1.2856197357177734, 1.1178377866744995, 1.0137825012207031, 1.0534311532974243]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.756164312362671] ms
 --  Average per query NF    [1.378406286239624] ms
 --  Average per query vegas [2.377758026123047] ms
Mean [1.189]  Median [1.128]  95th [1.534]  99th [1.805]  max [3.642]
Mean [1.189]  Median [1.128]  95th [1.534]  99th [1.805]  max [3.642]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.379569 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.501268