Input arguments = Namespace(data_update='valueskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 23, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.162872552871704
tensor(0.9985)
result is  tensor(381603.0625)
Enter testHyper
ReportEsts: [1.2092124223709106, 1.060321569442749, 1.2976794242858887, 1.05538010597229, 1.271232008934021, 1.1277328729629517, 1.1846530437469482, 1.0813720226287842, 1.077957034111023, 1.064979076385498, 1.1619293689727783, 1.0921610593795776, 1.009822130203247, 1.0602678060531616, 1.0733402967453003, 1.3082252740859985, 1.4204745292663574, 1.1495249271392822, 1.1705617904663086, 1.1403061151504517, 1.0635502338409424, 1.0806916952133179, 1.121382474899292, 1.1416312456130981, 1.0020461082458496, 1.1392405033111572, 1.0844594240188599, 1.292517066001892, 1.0613696575164795, 1.237310528755188, 1.1064207553863525, 1.0554665327072144, 1.073520302772522, 1.049781322479248, 1.099118709564209, 1.0559039115905762, 1.5539917945861816, 1.1525630950927734, 1.0512909889221191, 1.0323936939239502, 1.016846776008606, 1.1898887157440186, 1.011366367340088, 1.0464853048324585, 1.0606380701065063, 1.0464853048324585, 1.1354182958602905, 1.319350004196167, 1.031907320022583, 1.1844332218170166, 1.1670886278152466, 1.3276622295379639, 1.0054042339324951, 1.1663225889205933, 1.0266258716583252, 1.0424200296401978, 1.3532710075378418, 1.172888994216919, 1.0618999004364014, 1.398657202720642, 1.35012948513031, 1.270742416381836, 1.4375864267349243, 1.0334757566452026, 1.170212745666504, 1.2857142686843872, 1.0866551399230957, 1.0178996324539185, 1.1659080982208252, 1.2947368621826172, 1.037007212638855, 1.0078469514846802, 1.2353143692016602, 1.2715024948120117, 1.196402907371521, 1.164586067199707, 1.732118844985962, 1.055119514465332, 1.0315419435501099, 1.288539171218872, 1.2195402383804321, 1.1085447072982788, 1.0040534734725952, 1.2483940124511719, 1.282081961631775, 1.1538454294204712, 1.042994737625122, 1.1212610006332397, 1.00444757938385, 1.0576214790344238, 1.0539158582687378, 1.3715400695800781, 1.0206109285354614, 1.3784122467041016, 1.1271675825119019, 1.0436557531356812, 1.2649481296539307, 1.2602739334106445, 1.0526316165924072, 1.2087819576263428, 1.1327800750732422, 1.0733309984207153, 1.0323306322097778, 1.000732660293579, 1.0410041809082031, 1.0777250528335571, 1.1049938201904297, 1.1727749109268188, 1.053849458694458, 1.0554070472717285, 1.2312425374984741, 1.0821791887283325, 1.1585766077041626, 1.0472782850265503, 1.25362229347229, 1.2270270586013794, 1.0946866273880005, 1.0900297164916992, 1.3682316541671753, 1.3407235145568848, 1.1385998725891113, 1.0711328983306885, 1.0638127326965332, 1.168468713760376, 1.1574612855911255, 1.2214196920394897, 1.2138742208480835, 1.072754979133606, 1.2821576595306396, 1.0925183296203613, 1.0803587436676025, 1.1633548736572266, 1.214418888092041, 1.4642857313156128, 1.1423776149749756, 1.1740614175796509, 1.006255030632019, 1.1762601137161255, 1.1375337839126587, 1.2710963487625122, 1.0989596843719482, 1.0627286434173584, 1.027052879333496, 1.2415897846221924, 1.091437816619873, 1.1126848459243774, 1.036540150642395, 1.290859580039978, 1.0218082666397095, 1.3328125476837158, 1.2666274309158325, 1.164466142654419, 1.3073248863220215, 1.1494274139404297, 1.1414302587509155, 1.041390299797058, 1.0204441547393799, 1.0122472047805786, 1.0912771224975586, 1.1250970363616943, 1.1615909337997437, 1.0517479181289673, 1.0961148738861084, 1.2577180862426758, 1.2243839502334595, 1.0750893354415894, 1.0681631565093994, 1.280529260635376, 1.0158019065856934, 1.112457036972046, 1.021799087524414, 1.0516752004623413, 1.201298713684082, 1.320793628692627, 1.1638283729553223, 1.0201162099838257, 1.0063167810440063, 1.4835981130599976, 1.1124207973480225, 1.0050044059753418, 1.0408077239990234, 1.049575924873352, 1.0130791664123535, 1.2104188203811646, 1.1521188020706177, 1.1226215362548828, 1.005651831626892, 1.1695963144302368, 1.0322341918945312, 1.3284144401550293, 1.0513321161270142, 1.0051219463348389, 1.3770807981491089, 1.4204738140106201, 1.7721023559570312, 1.1618704795837402, 1.067694902420044, 1.1515151262283325, 1.0385407209396362, 1.1188911199569702]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.756946325302124] ms
 --  Average per query NF    [1.3592815399169922] ms
 --  Average per query vegas [2.397664785385132] ms
Mean [1.150]  Median [1.121]  95th [1.377]  99th [1.556]  max [1.772]
Mean [1.150]  Median [1.121]  95th [1.377]  99th [1.556]  max [1.772]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.907901 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=valueskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
ValueSample - START
ValueSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[1.0259509e-02 2.7418137e-06 0.0000000e+00 1.7881393e-07 4.1723251e-07]
Distance score: 0.0020525692962110043
SAUCE Drift detection: True
Detection latency: 0.0233s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.043848 | Model-update-time: 2.216730


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=valueskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.16680908203125
tensor(0.9972)
result is  tensor(457296.7188)
Enter testHyper
ReportEsts: [1.1852703094482422, 1.0229716300964355, 1.0779036283493042, 1.2733333110809326, 1.2793456315994263, 1.306479573249817, 1.0544458627700806, 1.119820475578308, 2.2655646800994873, 1.0600805282592773, 1.0976532697677612, 1.0876922607421875, 1.8400852680206299, 1.063490867614746, 401.7272644042969, 1.2833268642425537, 3.4910941123962402, 1.1361507177352905, 1.0545299053192139, 1.4284430742263794, 1.153287410736084, 1.1179577112197876, 1.0479933023452759, 1.0073972940444946, 1.091132640838623, 1.4698610305786133, 1.1606765985488892, 1.01878821849823, 1.2906899452209473, 1.2009884119033813, 1.200385332107544, 1.3815789222717285, 1.0745354890823364, 1.0029528141021729, 1.056616187095642, 1.204738974571228, 1.0963232517242432, 1.0528218746185303, 2.042996883392334, 1.2446218729019165, 1.0025089979171753, 1.052072286605835, 266.2083435058594, 1.0162781476974487, 1.0918734073638916, 1.2271431684494019, 1.7039128541946411, 1.4507036209106445, 1.1614173650741577, 1.3697811365127563, 1.0706804990768433, 1.0709549188613892, 1.3015638589859009, 1.116499900817871, 1.277431607246399, 1.3264939785003662, 1.171560525894165, 1.078667402267456, 1.0223568677902222, 1.1089017391204834, 1.3142857551574707, 1.2569037675857544, 1.3661346435546875, 1.6540074348449707, 1.1458324193954468, 1.0010817050933838, 1.347123146057129, 1.1415894031524658, 1.047477126121521, 1.2817769050598145, 1.1543079614639282, 1.0971355438232422, 1.086574912071228, 1.1289018392562866, 1.1859912872314453, 1.1672372817993164, 30.38888931274414, 1.0190387964248657, 1.5319384336471558, 1.054172158241272, 1.1364928483963013, 1.0130581855773926, 1.395383596420288, 1.2432608604431152, 1.1081719398498535, 1.6851063966751099, 1.251064419746399, 1.4994994401931763, 1.1936372518539429, 1.1458815336227417, 1.1731133460998535, 1.107782006263733, 1.292799711227417, 1.016871690750122, 1.1845077276229858, 1.1133252382278442, 1.2488386631011963, 1.2848141193389893, 1.5364832878112793, 2.176443099975586, 1.3417387008666992, 1.0827499628067017, 1.0441176891326904, 1.230562686920166, 1.1494001150131226, 1.0322843790054321, 1.049059510231018, 1.0225592851638794, 1.1948424577713013, 1.146579623222351, 1.9290844202041626, 1.1951276063919067, 1.0863053798675537, 1.2172611951828003, 1.014796495437622, 1.5874089002609253, 1.0235118865966797, 1.1318597793579102, 1.0055311918258667, 1.2307692766189575, 1.153306245803833, 1.1496562957763672, 1.0651694536209106, 2.9186296463012695, 1.1718111038208008, 1.143471360206604, 1.1211105585098267, 1.0732483863830566, 1.0142842531204224, 5.940267562866211, 3.147139549255371, 1.0952357053756714, 1.0440788269042969, 3.430680990219116, 1.6565656661987305, 1.27362859249115, 1.1662675142288208, 1.0210049152374268, 1.3596372604370117, 1.2135647535324097, 1.0573818683624268, 1.3912644386291504, 1.2479369640350342, 1.1190260648727417, 1.2085505723953247, 1.1339788436889648, 1.4619883298873901, 1.104914665222168, 1.053159236907959, 1.2631394863128662, 1.084554672241211, 1.2483980655670166, 1.089081048965454, 1.171173095703125, 1.1540075540542603, 1.0892215967178345, 1.0738736391067505, 1.1138211488723755, 1.0150525569915771, 1.086323618888855, 1.0638867616653442, 3.034090995788574, 1.386993646621704, 1.0400371551513672, 1.113717794418335, 1.4467960596084595, 1.0553935766220093, 2.564704179763794, 127.0, 1.297810673713684, 1.1177457571029663, 1.1084372997283936, 1.4726536273956299, 1.0254396200180054, 1.0520299673080444, 1.0011855363845825, 1.783220648765564, 1.0555044412612915, 1.1701380014419556, 1.1756846904754639, 1.5111111402511597, 1.141308069229126, 1.0196970701217651, 1.187292218208313, 1.0868685245513916, 5.034722328186035, 1.4143295288085938, 1.181357979774475, 1.218611240386963, 1.1828927993774414, 1.036022663116455, 1.0154900550842285, 1.14887535572052, 2.0639593601226807, 1.162442684173584, 1.0372847318649292, 1.4361937046051025, 1.252360463142395, 1.3644213676452637, 1.4319623708724976]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.624253273010254] ms
 --  Average per query NF    [1.3588809967041016] ms
 --  Average per query vegas [2.2653722763061523] ms
Mean [5.414]  Median [1.157]  95th [2.924]  99th [128.392]  max [401.727]
Mean [5.414]  Median [1.157]  95th [2.924]  99th [128.392]  max [401.727]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.332658 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.566209