Input arguments = Namespace(data_update='sample', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 50, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.167654514312744
tensor(0.9938)
result is  tensor(379802.9375)
Enter testHyper
ReportEsts: [1.0908846855163574, 1.0126967430114746, 1.1849669218063354, 1.0241535902023315, 1.2804217338562012, 1.1414880752563477, 1.1588778495788574, 1.2047547101974487, 1.105698585510254, 1.1139930486679077, 1.115417718887329, 1.1269067525863647, 1.1308923959732056, 1.0089285373687744, 1.1152570247650146, 1.4253852367401123, 1.4057352542877197, 1.1423990726470947, 1.1782208681106567, 1.0102040767669678, 1.0627620220184326, 1.0387811660766602, 1.0922733545303345, 1.0102020502090454, 1.2087723016738892, 1.1112115383148193, 1.0529279708862305, 1.4342806339263916, 1.0024524927139282, 1.0576746463775635, 1.1883646249771118, 1.3066556453704834, 1.099334955215454, 1.0785636901855469, 1.1214380264282227, 1.229111671447754, 1.3543500900268555, 1.16841721534729, 1.0662939548492432, 1.221077799797058, 1.039633870124817, 1.219883918762207, 1.0298283100128174, 1.0376886129379272, 1.1098668575286865, 1.048752784729004, 1.2061725854873657, 1.3908365964889526, 1.0453615188598633, 1.165820598602295, 1.1850899457931519, 1.397678256034851, 1.1384366750717163, 1.2390351295471191, 1.1142200231552124, 1.0027893781661987, 1.1149532794952393, 1.122574806213379, 1.1205005645751953, 1.4015979766845703, 1.2888041734695435, 1.1714720726013184, 1.3215179443359375, 1.0335233211517334, 1.4473683834075928, 1.0571428537368774, 1.208092451095581, 1.0565228462219238, 1.0529354810714722, 1.2736842632293701, 1.0474658012390137, 1.000438928604126, 1.1359935998916626, 1.1439878940582275, 1.2147667407989502, 1.0964604616165161, 1.9402357339859009, 1.049373745918274, 1.0331536531448364, 1.3635889291763306, 1.19429349899292, 1.138103723526001, 1.0487278699874878, 1.3324651718139648, 1.3044832944869995, 1.0685513019561768, 1.096218466758728, 1.0083926916122437, 1.0204404592514038, 1.0643502473831177, 1.0167289972305298, 1.2390751838684082, 1.0028849840164185, 1.2935370206832886, 1.107954502105713, 1.0303428173065186, 1.1150656938552856, 1.3656543493270874, 1.0526316165924072, 1.1019567251205444, 1.1438547372817993, 1.0563840866088867, 1.0527137517929077, 1.0014662742614746, 1.021338939666748, 1.0428940057754517, 1.2260825634002686, 1.1884816884994507, 1.0880186557769775, 1.0389952659606934, 1.17033052444458, 1.1569595336914062, 1.2357312440872192, 1.0550868511199951, 1.072099208831787, 1.1237623691558838, 1.0111514329910278, 1.0402424335479736, 1.3365178108215332, 1.09597647190094, 1.226167917251587, 1.1025941371917725, 1.1746349334716797, 1.1438281536102295, 1.323643445968628, 1.1642591953277588, 1.2017345428466797, 1.2168954610824585, 1.3434782028198242, 1.108216404914856, 1.1040970087051392, 1.3327525854110718, 1.3144810199737549, 1.5, 1.1462461948394775, 1.0787311792373657, 1.022165298461914, 1.1466666460037231, 1.0556902885437012, 1.3165863752365112, 1.105231761932373, 1.1388983726501465, 1.0431568622589111, 1.204576015472412, 1.1144331693649292, 1.0119601488113403, 1.0967350006103516, 1.3467341661453247, 1.0886075496673584, 1.008238673210144, 1.2283694744110107, 1.139341115951538, 1.340043544769287, 1.2091264724731445, 1.1581593751907349, 1.005199670791626, 1.1120259761810303, 1.001125454902649, 1.0453113317489624, 1.1452701091766357, 1.2198655605316162, 1.0377942323684692, 1.1166417598724365, 1.373900294303894, 1.2102564573287964, 1.0009502172470093, 1.1333887577056885, 1.2720006704330444, 1.0430136919021606, 1.010954737663269, 1.0258880853652954, 1.0109412670135498, 1.1363636255264282, 1.186758041381836, 1.0507493019104004, 1.0667102336883545, 1.0349854230880737, 1.204535961151123, 1.1246527433395386, 1.0518707036972046, 1.025710940361023, 1.0948741436004639, 1.0235792398452759, 1.2002042531967163, 1.1988409757614136, 1.0930233001708984, 1.0002028942108154, 1.242822527885437, 1.058321475982666, 1.183000087738037, 1.0406407117843628, 1.063808798789978, 1.5824785232543945, 1.2470908164978027, 1.7915254831314087, 1.1366568803787231, 1.1081700325012207, 1.085714340209961, 1.0159116983413696, 1.0458167791366577]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.782740831375122] ms
 --  Average per query NF    [1.3647270202636719] ms
 --  Average per query vegas [2.41801381111145] ms
Mean [1.149]  Median [1.115]  95th [1.391]  99th [1.585]  max [1.940]
Mean [1.149]  Median [1.115]  95th [1.391]  99th [1.585]  max [1.940]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.853408 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=sample', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
Sample - START
Sample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[2.9802322e-07 5.9604645e-08 2.3841858e-07 1.2516975e-06 4.7683716e-07]
Distance score: 4.6491624061673065e-07
SAUCE Drift detection: False
Detection latency: 0.0234s

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.023100 | Model-update-time: 0.000000


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=sample', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.185457468032837
tensor(0.9955)
result is  tensor(456539.0312)
Enter testHyper
ReportEsts: [1.0872489213943481, 1.0615334510803223, 1.1936872005462646, 1.0859538316726685, 1.1103729009628296, 1.4963334798812866, 1.267304539680481, 1.1081387996673584, 1.053118348121643, 1.1454182863235474, 1.0607616901397705, 1.1012295484542847, 1.1415525674819946, 1.2480348348617554, 1.1645469665527344, 1.0089421272277832, 1.7200689315795898, 1.1264716386795044, 1.0473376512527466, 1.2653647661209106, 1.1220670938491821, 1.292243480682373, 1.0404518842697144, 1.038059949874878, 1.2521084547042847, 1.1990567445755005, 1.0349607467651367, 1.1449480056762695, 1.3006627559661865, 1.65727698802948, 1.191076636314392, 1.2866666316986084, 1.0178669691085815, 1.0957813262939453, 1.0445653200149536, 1.0068141222000122, 1.1141308546066284, 1.1964179277420044, 1.1439188718795776, 1.160728931427002, 1.0268689393997192, 1.0480256080627441, 1.0179665088653564, 1.014685034751892, 1.0727269649505615, 1.1757421493530273, 1.29189932346344, 1.3066247701644897, 1.0230768918991089, 1.3417366743087769, 1.0363035202026367, 1.108746886253357, 1.0453240871429443, 1.0394026041030884, 1.061923861503601, 1.497564435005188, 1.2114359140396118, 1.148133397102356, 1.2839263677597046, 1.096544861793518, 1.3712446689605713, 1.0652990341186523, 1.0803662538528442, 1.7335231304168701, 1.0291234254837036, 1.0251368284225464, 1.3030002117156982, 1.0876739025115967, 1.165850043296814, 1.0834804773330688, 1.134647011756897, 1.1245431900024414, 1.0619398355484009, 1.014393925666809, 1.2357438802719116, 1.1031746864318848, 1.128995418548584, 1.181458830833435, 1.2922521829605103, 1.1070455312728882, 1.175911784172058, 1.069520115852356, 1.0247026681900024, 1.1291990280151367, 1.2048603296279907, 1.3356890678405762, 1.1865427494049072, 1.5016733407974243, 1.2364189624786377, 1.029990792274475, 1.0484528541564941, 1.0339967012405396, 1.2788621187210083, 1.2180551290512085, 1.2747139930725098, 1.0193135738372803, 1.1094204187393188, 1.2081979513168335, 1.0053871870040894, 1.0666396617889404, 1.1185909509658813, 1.1029388904571533, 1.1670588254928589, 1.1449596881866455, 1.1335588693618774, 1.3510560989379883, 1.1295526027679443, 1.2166907787322998, 1.1717451810836792, 1.0596619844436646, 1.0630338191986084, 1.025171160697937, 1.1772102117538452, 1.2926160097122192, 1.0556485652923584, 1.1638630628585815, 1.1274960041046143, 1.137190341949463, 1.1273081302642822, 1.2393162250518799, 1.0951564311981201, 1.1505711078643799, 1.2882863283157349, 1.432634711265564, 1.009299397468567, 1.098345160484314, 1.2811130285263062, 1.22171950340271, 1.008336067199707, 1.2368698120117188, 1.0575191974639893, 1.1892871856689453, 1.1664199829101562, 1.8732227087020874, 1.5432525873184204, 1.0727461576461792, 1.0151021480560303, 1.227584719657898, 1.1018403768539429, 1.074138879776001, 1.0237610340118408, 1.0808151960372925, 1.058721899986267, 1.1472195386886597, 1.0353596210479736, 1.0609461069107056, 1.4055556058883667, 1.108273983001709, 1.0908958911895752, 1.1204661130905151, 1.0324079990386963, 1.0626376867294312, 1.0319948196411133, 1.0349498987197876, 1.033974051475525, 1.1147105693817139, 1.0207595825195312, 1.440000057220459, 1.048478603363037, 1.0562124252319336, 1.033488392829895, 1.0557582378387451, 1.1067674160003662, 1.038562536239624, 1.0217506885528564, 1.2900428771972656, 1.0082943439483643, 1.1634241342544556, 1.0743801593780518, 1.0976415872573853, 1.122485876083374, 1.1189371347427368, 1.33395516872406, 1.1574991941452026, 1.0234436988830566, 1.0435490608215332, 1.2003192901611328, 1.2143216133117676, 1.0613774061203003, 1.0758676528930664, 1.600000023841858, 1.1029094457626343, 1.0989370346069336, 1.4707558155059814, 1.3102253675460815, 1.1382122039794922, 1.2707581520080566, 1.1574113368988037, 1.3335342407226562, 1.0249089002609253, 1.2173850536346436, 1.061885118484497, 1.1907671689987183, 1.5796597003936768, 1.0987757444381714, 1.1530612707138062, 1.278357744216919, 1.0563582181930542, 1.2589147090911865, 1.0882306098937988]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.738909959793091] ms
 --  Average per query NF    [1.356356143951416] ms
 --  Average per query vegas [2.382553815841675] ms
Mean [1.160]  Median [1.120]  95th [1.472]  99th [1.720]  max [1.873]
Mean [1.160]  Median [1.120]  95th [1.472]  99th [1.720]  max [1.873]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.217190 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=0 | total-time=26.118483