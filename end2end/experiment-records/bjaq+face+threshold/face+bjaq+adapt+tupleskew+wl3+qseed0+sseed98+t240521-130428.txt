Input arguments = Namespace(data_update='tupleskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 98, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.189246416091919
tensor(0.9935)
result is  tensor(379680.5000)
Enter testHyper
ReportEsts: [1.1642346382141113, 1.054664969444275, 1.566457748413086, 1.04695725440979, 1.271612286567688, 1.091651439666748, 1.203104853630066, 1.1077240705490112, 1.1009762287139893, 1.1629801988601685, 1.107665777206421, 1.1326271295547485, 1.1284390687942505, 1.0535714626312256, 1.1644130945205688, 1.3437730073928833, 1.357078194618225, 1.126603364944458, 1.1754740476608276, 1.1479592323303223, 1.014451265335083, 1.0442912578582764, 1.0905041694641113, 1.1075078248977661, 1.126357913017273, 1.106690764427185, 1.1475225687026978, 1.3821138143539429, 1.0232259035110474, 1.171294927597046, 1.1734657287597656, 1.252511978149414, 1.130429744720459, 1.0510891675949097, 1.1494399309158325, 1.0983517169952393, 1.4431626796722412, 1.055192232131958, 1.1607427597045898, 1.0535329580307007, 1.0195591449737549, 1.0622882843017578, 1.0952339172363281, 1.111228346824646, 1.0745826959609985, 1.0272108316421509, 1.0336754322052002, 1.2669206857681274, 1.2123003005981445, 1.106598973274231, 1.188144326210022, 1.3735332489013672, 1.013347864151001, 1.1513828039169312, 1.1152215003967285, 1.0361613035202026, 1.1112149953842163, 1.1733702421188354, 1.0913046598434448, 1.4243589639663696, 1.2166852951049805, 1.1520437002182007, 1.3620872497558594, 1.1277673244476318, 1.2087912559509277, 1.1714285612106323, 1.1009657382965088, 1.0052977800369263, 1.0088951587677002, 1.4105262756347656, 1.0804505348205566, 1.112770676612854, 1.2981914281845093, 1.313620686531067, 1.092302680015564, 1.0915476083755493, 2.04191255569458, 1.045577883720398, 1.0712144374847412, 1.45387601852417, 1.004097819328308, 1.0667097568511963, 1.101338267326355, 1.3331029415130615, 1.216188907623291, 1.037030577659607, 1.016959547996521, 1.0324337482452393, 1.0306119918823242, 1.0428954362869263, 1.011688232421875, 1.4314264059066772, 1.027417540550232, 1.2971954345703125, 1.2662338018417358, 1.1538755893707275, 1.084241271018982, 1.2876219749450684, 1.0714285373687744, 1.0956839323043823, 1.2561349868774414, 1.0579891204833984, 1.0553083419799805, 1.0102488994598389, 1.076255202293396, 1.1600667238235474, 1.2193557024002075, 1.1762652397155762, 1.047516107559204, 1.0202020406723022, 1.0806235074996948, 1.0801843404769897, 1.0823172330856323, 1.1424527168273926, 1.1067578792572021, 1.0913461446762085, 1.0075585842132568, 1.0652650594711304, 1.1471556425094604, 1.0968941450119019, 1.2745755910873413, 1.1232924461364746, 1.0977529287338257, 1.0544639825820923, 1.2814922332763672, 1.1837598085403442, 1.1604799032211304, 1.1239207983016968, 1.3048986196517944, 1.1115564107894897, 1.0153543949127197, 1.214213252067566, 1.0941578149795532, 1.5, 1.071568250656128, 1.1874507665634155, 1.084953784942627, 1.20747971534729, 1.0534273386001587, 1.3202208280563354, 1.1817412376403809, 1.1524990797042847, 1.0164234638214111, 1.364017367362976, 1.0492932796478271, 1.0136654376983643, 1.085042119026184, 1.5272948741912842, 1.0988489389419556, 1.0663352012634277, 1.1770968437194824, 1.151262640953064, 1.288179874420166, 1.2103544473648071, 1.1239577531814575, 1.1006906032562256, 1.0710127353668213, 1.0145589113235474, 1.0257763862609863, 1.205013394355774, 1.1700396537780762, 1.0275342464447021, 1.0585851669311523, 1.2560322284698486, 1.191919207572937, 1.090500831604004, 1.1920154094696045, 1.334326982498169, 1.0438716411590576, 1.0393736362457275, 1.1050853729248047, 1.0296604633331299, 1.1363636255264282, 1.0987014770507812, 1.187329649925232, 1.0742064714431763, 1.0619194507598877, 1.152498483657837, 1.1700072288513184, 1.0254855155944824, 1.0390739440917969, 1.1144089698791504, 1.0220134258270264, 1.1235954761505127, 1.1966679096221924, 1.0803382396697998, 1.0656818151474, 1.2642505168914795, 1.0371425151824951, 1.3241875171661377, 1.0515377521514893, 1.0356066226959229, 1.4356136322021484, 1.24064040184021, 1.8009881973266602, 1.229695439338684, 1.0733639001846313, 1.0410958528518677, 1.066392183303833, 1.0703519582748413]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.744475841522217] ms
 --  Average per query NF    [1.356360912322998] ms
 --  Average per query vegas [2.3881149291992188] ms
Mean [1.150]  Median [1.108]  95th [1.411]  99th [1.569]  max [2.042]
Mean [1.150]  Median [1.108]  95th [1.411]  99th [1.569]  max [2.042]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.864594 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=tupleskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
TupleSkewSample - START
0.001
TupleSkewSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[2.0682812e-05 3.3378601e-06 6.1988831e-05 6.6280365e-05 8.4042549e-06]
Distance score: 3.2138825190486386e-05
SAUCE Drift detection: True
Detection latency: 0.0226s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 1.991616 | Model-update-time: 2.233709


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=tupleskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.161601543426514
tensor(0.9954)
result is  tensor(456470.7812)
Enter testHyper
ReportEsts: [1.0324987173080444, 1.0555099248886108, 1.1133143901824951, 9.616666793823242, 1.1311475038528442, 1.0220601558685303, 1.0321686267852783, 1.0050907135009766, 1.0538655519485474, 1.2641026973724365, 1.101754069328308, 1.0100536346435547, 1.4436781406402588, 1.1124855279922485, 1.0019044876098633, 1.0276466608047485, 1.1016100645065308, 1.1247774362564087, 1.0661823749542236, 1.3321572542190552, 1.1358197927474976, 1.5128552913665771, 1.1625100374221802, 1.086988925933838, 1.3903862237930298, 1.2513759136199951, 1.1552940607070923, 1.0770984888076782, 1.023672103881836, 1.4223549365997314, 1.1639602184295654, 2.0443038940429688, 1.1501832008361816, 1.1146340370178223, 1.0485808849334717, 1.1021353006362915, 1.0946928262710571, 1.0603628158569336, 1.3904695510864258, 1.02908194065094, 1.0648930072784424, 1.1900237798690796, 1.1911649703979492, 1.204228401184082, 1.0165733098983765, 1.2448294162750244, 2.027027130126953, 1.2165027856826782, 1.2142857313156128, 1.1537951231002808, 1.0338778495788574, 1.0544729232788086, 1.1023414134979248, 1.1527265310287476, 1.084159255027771, 1.2137281894683838, 1.1436655521392822, 1.067563533782959, 1.182104229927063, 1.1563454866409302, 1.3041362762451172, 1.0051435232162476, 1.1505000591278076, 1.2372932434082031, 1.1572681665420532, 1.0741302967071533, 1.404957890510559, 1.074563980102539, 1.0808383226394653, 1.0921651124954224, 1.1864018440246582, 1.2284808158874512, 1.2109107971191406, 1.137141466140747, 2.869999885559082, 1.2161693572998047, 1.05084228515625, 1.0467453002929688, 1.267199993133545, 1.1612507104873657, 1.3562062978744507, 1.1782171726226807, 1.1606286764144897, 1.2978178262710571, 1.2265511751174927, 1.6382979154586792, 1.2437838315963745, 1.5516787767410278, 1.070090651512146, 1.0153424739837646, 1.1367632150650024, 1.1849749088287354, 1.4148517847061157, 1.170804500579834, 1.057348608970642, 1.0020692348480225, 1.0206185579299927, 1.2651379108428955, 1.0920133590698242, 1.0190908908843994, 1.033876657485962, 1.1465370655059814, 1.620596170425415, 1.0579726696014404, 1.1899033784866333, 1.1688963174819946, 1.0675711631774902, 1.0218193531036377, 1.0200573205947876, 1.0579956769943237, 1.0405991077423096, 1.1540250778198242, 1.218877911567688, 1.2831364870071411, 1.2459990978240967, 1.0717649459838867, 1.1327247619628906, 1.1805297136306763, 1.260600209236145, 1.0530973672866821, 1.044080138206482, 1.3800623416900635, 1.131412386894226, 1.109100103378296, 1.0494773387908936, 1.2192869186401367, 1.062436819076538, 1.3606810569763184, 1.0404143333435059, 1.1569186449050903, 1.2300716638565063, 1.0038381814956665, 1.11910080909729, 1.064853549003601, 1.2430846691131592, 1.1495506763458252, 1.0724899768829346, 1.1688098907470703, 1.190843105316162, 1.0553638935089111, 1.0000765323638916, 1.152670979499817, 1.0142292976379395, 1.0447964668273926, 1.0545105934143066, 1.0386085510253906, 1.2559523582458496, 1.0328493118286133, 1.1560474634170532, 1.0758109092712402, 1.111425757408142, 1.0073081254959106, 1.1425082683563232, 1.0519428253173828, 1.008428931236267, 1.2422105073928833, 1.3488444089889526, 1.1048387289047241, 1.0554453134536743, 1.0391371250152588, 1.048426628112793, 1.2224749326705933, 1.1456066370010376, 1.1305962800979614, 1.1364531517028809, 1.0356838703155518, 1.0355401039123535, 1.0476807355880737, 1.0707228183746338, 1.2973636388778687, 1.1069717407226562, 1.128937005996704, 1.368384838104248, 1.205413579940796, 1.2377467155456543, 1.2286784648895264, 1.1974743604660034, 1.1136947870254517, 1.1501682996749878, 1.135741114616394, 1.9736841917037964, 1.023514986038208, 1.1298551559448242, 1.613121747970581, 1.6851834058761597, 1.249300241470337, 1.0161197185516357, 1.04727303981781, 1.4333815574645996, 1.0066591501235962, 1.178242802619934, 1.140625, 1.1628886461257935, 1.477220058441162, 1.0761258602142334, 1.4307783842086792, 1.3675376176834106, 1.1320551633834839, 1.133561611175537, 1.0013437271118164]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7134206295013428] ms
 --  Average per query NF    [1.359642744064331] ms
 --  Average per query vegas [2.3537778854370117] ms
Mean [1.220]  Median [1.136]  95th [1.515]  99th [2.053]  max [9.617]
Mean [1.220]  Median [1.136]  95th [1.515]  99th [2.053]  max [9.617]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.365031 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.480519