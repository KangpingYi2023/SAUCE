Input arguments = Namespace(data_update='valueskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 27, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.161758184432983
tensor(0.9949)
result is  tensor(380235.0938)
Enter testHyper
ReportEsts: [1.1429774761199951, 1.037299633026123, 1.357219934463501, 1.2101495265960693, 1.3043878078460693, 1.1023980379104614, 1.2281144857406616, 1.2308236360549927, 1.1087557077407837, 1.141096830368042, 1.1274763345718384, 1.2451270818710327, 1.0943855047225952, 1.046875, 1.052512764930725, 1.205704689025879, 1.149889349937439, 1.376009464263916, 1.084923267364502, 1.09183669090271, 1.11797297000885, 1.1010905504226685, 1.1866049766540527, 1.0018415451049805, 1.2229028940200806, 1.1419529914855957, 1.1658220291137695, 1.3821138143539429, 1.0020678043365479, 1.1892991065979004, 1.1046470403671265, 1.0594810247421265, 1.016404390335083, 1.0609744787216187, 1.1119667291641235, 1.1328423023223877, 1.4062960147857666, 1.1016316413879395, 1.0482103824615479, 1.0501796007156372, 1.084136724472046, 1.1156264543533325, 1.1088999509811401, 1.0613417625427246, 1.0982463359832764, 1.0272108316421509, 1.0434021949768066, 1.3009129762649536, 1.2501779794692993, 1.086294412612915, 1.277008295059204, 1.388925552368164, 1.0996875762939453, 1.1371477842330933, 1.0711003541946411, 1.0435791015625, 1.2355140447616577, 1.1046035289764404, 1.4096187353134155, 1.5452016592025757, 1.2521138191223145, 1.1526603698730469, 1.3135960102081299, 1.1132808923721313, 1.1619718074798584, 1.1714285612106323, 1.163265347480774, 1.1187591552734375, 1.0008763074874878, 1.3473684787750244, 1.0138661861419678, 1.1189684867858887, 1.2468385696411133, 1.3837710618972778, 1.1487005949020386, 1.0417147874832153, 1.7820115089416504, 1.0101345777511597, 1.0136481523513794, 1.4143803119659424, 1.2919843196868896, 1.1482797861099243, 1.0836946964263916, 1.227248191833496, 1.317330002784729, 1.102378249168396, 1.0666521787643433, 1.0729382038116455, 1.057572603225708, 1.0153237581253052, 1.0514066219329834, 1.2235265970230103, 1.0047101974487305, 1.2340806722640991, 1.0051546096801758, 1.1456464529037476, 1.0295368432998657, 1.2330518960952759, 1.0526316165924072, 1.210654377937317, 1.1818181276321411, 1.0810579061508179, 1.0157899856567383, 1.022455096244812, 1.0031479597091675, 1.0027960538864136, 1.2145540714263916, 1.2111692428588867, 1.0370687246322632, 1.029933214187622, 1.0919321775436401, 1.084181308746338, 1.1648815870285034, 1.0100767612457275, 1.1874347925186157, 1.0758293867111206, 1.0317543745040894, 1.0332773923873901, 1.2945555448532104, 1.0920156240463257, 1.2952858209609985, 1.093142032623291, 1.2196439504623413, 1.0546764135360718, 1.2931201457977295, 1.194903016090393, 1.2131083011627197, 1.1464186906814575, 1.2653563022613525, 1.0961923599243164, 1.0300686359405518, 1.264285922050476, 1.1202610731124878, 1.5357142686843872, 1.112484097480774, 1.0071390867233276, 1.0027949810028076, 1.2861788272857666, 1.1505675315856934, 1.157289743423462, 1.1287769079208374, 1.125614881515503, 1.075705647468567, 1.2642135620117188, 1.0689963102340698, 1.0164430141448975, 1.130703330039978, 1.4397295713424683, 1.0810290575027466, 1.1102982759475708, 1.136739730834961, 1.1594667434692383, 1.3356833457946777, 1.1191226243972778, 1.0078316926956177, 1.1180800199508667, 1.0866245031356812, 1.034327507019043, 1.021971344947815, 1.1925991773605347, 1.1598905324935913, 1.0620826482772827, 1.0442252159118652, 1.3366619348526, 1.0630630254745483, 1.138683557510376, 1.1054357290267944, 1.3461140394210815, 1.0978564023971558, 1.0196272134780884, 1.0352036952972412, 1.0892220735549927, 1.1298701763153076, 1.238588809967041, 1.1389645338058472, 1.1418107748031616, 1.0034013986587524, 1.300606608390808, 1.119001030921936, 1.223159670829773, 1.061126947402954, 1.134873628616333, 1.0092962980270386, 1.1082737445831299, 1.108294129371643, 1.163847804069519, 1.1013643741607666, 1.255854606628418, 1.0335421562194824, 1.2628594636917114, 1.0109567642211914, 1.0726367235183716, 1.4513094425201416, 1.2294361591339111, 1.621911883354187, 1.2000000476837158, 1.0621925592422485, 1.1875, 1.1405622959136963, 1.0852922201156616]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7991249561309814] ms
 --  Average per query NF    [1.3778305053710938] ms
 --  Average per query vegas [2.4212944507598877] ms
Mean [1.151]  Median [1.119]  95th [1.384]  99th [1.546]  max [1.782]
Mean [1.151]  Median [1.119]  95th [1.384]  99th [1.546]  max [1.782]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.859331 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=valueskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
ValueSample - START
ValueSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[1.0463059e-02 6.5565109e-07 5.3644180e-07 3.5762787e-07 2.3841858e-07]
Distance score: 0.0020929693710058928
SAUCE Drift detection: True
Detection latency: 0.0233s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.052747 | Model-update-time: 2.228136


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=valueskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.167741537094116
tensor(0.9934)
result is  tensor(455590.8750)
Enter testHyper
ReportEsts: [1.0114275217056274, 1.0277246236801147, 1.0028408765792847, 1.1204437017440796, 1.3086912631988525, 1.3782389163970947, 1.2102229595184326, 1.0889582633972168, 7.5641889572143555, 1.0006459951400757, 1.0428612232208252, 1.1843892335891724, 1.0194647312164307, 1.1651883125305176, 11.699399948120117, 1.0447683334350586, 1.5049999952316284, 1.0978844165802002, 1.028329610824585, 1.3418570756912231, 1.047891616821289, 1.8702653646469116, 1.0111356973648071, 1.0773046016693115, 1.305128574371338, 1.3973109722137451, 1.1711814403533936, 1.0548722743988037, 1.2315011024475098, 1.2408510446548462, 1.1414391994476318, 1.2014389038085938, 1.0516467094421387, 1.0248006582260132, 1.0797561407089233, 1.2210115194320679, 1.1493765115737915, 2.9397025108337402, 1.236452579498291, 1.1804144382476807, 1.0239644050598145, 1.0726447105407715, 17.22068977355957, 1.0642679929733276, 1.028555989265442, 1.2056092023849487, 1.1152170896530151, 1.028806209564209, 1.0078431367874146, 1.587837815284729, 1.0302634239196777, 1.056903600692749, 1.1476925611495972, 1.159807562828064, 1.4430423974990845, 1.5043094158172607, 1.2815157175064087, 1.1807072162628174, 1.075974464416504, 1.1102144718170166, 1.5569007396697998, 1.3624670505523682, 2.021228313446045, 1.5493581295013428, 1.1313486099243164, 1.2473348379135132, 1.3294271230697632, 1.1431306600570679, 1.1961429119110107, 1.3452801704406738, 1.1758455038070679, 1.340130090713501, 1.1218116283416748, 1.087692379951477, 1.0580122470855713, 1.1217398643493652, 1200.0, 1.0247535705566406, 1.1387925148010254, 2.948852062225342, 1.4647012948989868, 1.1347395181655884, 1.2074768543243408, 1.0831705331802368, 1.1232942342758179, 1.302931547164917, 1.2112830877304077, 1.44280207157135, 1.1679348945617676, 1.4637093544006348, 1.180032730102539, 1.194577693939209, 1.4030712842941284, 1.0609556436538696, 1.3430804014205933, 1.0365866422653198, 4.218010425567627, 1.0478147268295288, 1.1217844486236572, 1.00197434425354, 1.374446153640747, 1.0858567953109741, 1.0680627822875977, 1.1072866916656494, 1.0515742301940918, 1.387399435043335, 1.0168633460998535, 1.0147345066070557, 1.127659559249878, 1.2008603811264038, 1.1700605154037476, 1.133442997932434, 1.1699838638305664, 1.3510191440582275, 1.09333336353302, 1.2167032957077026, 1.0800795555114746, 1.1332170963287354, 1.4794871807098389, 1.1370967626571655, 1.2365601062774658, 1.1614255905151367, 2.8893826007843018, 5.9414801597595215, 1.0690199136734009, 1.0270816087722778, 1.0892430543899536, 1.0749601125717163, 1.0135310888290405, 1.0980470180511475, 1.039588451385498, 1.0475330352783203, 1.4160538911819458, 1.4591611623764038, 1.3037036657333374, 1.010688066482544, 1.0879875421524048, 1.049003005027771, 1.3199654817581177, 1.1006908416748047, 1.1186705827713013, 1.021577000617981, 1.179669976234436, 1.0022739171981812, 1.6554350852966309, 1.0298376083374023, 1.4941176176071167, 1.0481183528900146, 1.1942671537399292, 1.1571391820907593, 1.0189712047576904, 1.2555598020553589, 1.1247937679290771, 1.193356990814209, 1.0029443502426147, 1.0185191631317139, 1.1683708429336548, 1.1138211488723755, 1.091831922531128, 1.4083348512649536, 7.240744113922119, 1.402976155281067, 1.4665573835372925, 1.1860251426696777, 1.1299229860305786, 2.0464329719543457, 1.0222028493881226, 1.2177811861038208, 28.25, 1.069663166999817, 1.0051658153533936, 1.1105239391326904, 1.4996553659439087, 1.0496011972427368, 1.0915032625198364, 1.1141427755355835, 1.0826129913330078, 1.0955806970596313, 1.1321454048156738, 1.1313235759735107, 1.3829786777496338, 1.1349806785583496, 1.024898648262024, 1.3073011636734009, 1.6380819082260132, 1.0332801342010498, 2.1853017807006836, 1.264949083328247, 1.3319523334503174, 1.1420578956604004, 2.3207690715789795, 1.0089901685714722, 1.3742036819458008, 2.0232558250427246, 1.006598711013794, 1.0132359266281128, 1.3876227140426636, 1.0, 1.2845659255981445, 1.0862231254577637]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.627946376800537] ms
 --  Average per query NF    [1.3552463054656982] ms
 --  Average per query vegas [2.272700071334839] ms
Mean [7.592]  Median [1.142]  95th [2.892]  99th [17.331]  max [1200.000]
Mean [7.592]  Median [1.142]  95th [2.892]  99th [17.331]  max [1200.000]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.359578 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.568380