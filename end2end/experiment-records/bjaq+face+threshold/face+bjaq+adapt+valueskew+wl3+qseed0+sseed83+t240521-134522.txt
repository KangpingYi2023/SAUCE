Input arguments = Namespace(data_update='valueskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 83, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.167830228805542
tensor(0.9983)
result is  tensor(381520.6562)
Enter testHyper
ReportEsts: [1.205629587173462, 1.0752414464950562, 1.4144361019134521, 1.0016874074935913, 1.2393585443496704, 1.1204994916915894, 1.3694390058517456, 1.080726146697998, 1.032322645187378, 1.0804266929626465, 1.0473729372024536, 1.131355881690979, 1.0883644819259644, 1.0691964626312256, 1.1223911046981812, 1.2308748960494995, 1.2462691068649292, 1.1306413412094116, 1.1669495105743408, 1.03316330909729, 1.2183419466018677, 1.0045924186706543, 1.1218496561050415, 1.0662946701049805, 1.119986891746521, 1.1265822649002075, 1.0456081628799438, 1.3469557762145996, 1.0021698474884033, 1.1164683103561401, 1.112451195716858, 1.1423884630203247, 1.0664023160934448, 1.0534559488296509, 1.1135727167129517, 1.1123595237731934, 1.4976238012313843, 1.1885982751846313, 1.084295630455017, 1.1732934713363647, 1.0186970233917236, 1.0798258781433105, 1.0090245008468628, 1.0306904315948486, 1.077540636062622, 1.0056688785552979, 1.0617576837539673, 1.2722302675247192, 1.1549501419067383, 1.0321489572525024, 1.1974025964736938, 1.3293375968933105, 1.0335674285888672, 1.3122097253799438, 1.0392907857894897, 1.0044043064117432, 1.2719626426696777, 1.022968053817749, 1.1556386947631836, 1.4104951620101929, 1.2098037004470825, 1.1737709045410156, 1.3124184608459473, 1.206701397895813, 1.1870503425598145, 1.1714285612106323, 1.106796145439148, 1.0000889301300049, 1.0455536842346191, 1.357894778251648, 1.1178057193756104, 1.0660743713378906, 1.3198564052581787, 1.0131851434707642, 1.1197919845581055, 1.062860131263733, 2.045041561126709, 1.114732027053833, 1.1593530178070068, 1.0706101655960083, 1.1443912982940674, 1.1489259004592896, 1.025255799293518, 1.3464926481246948, 1.2322160005569458, 1.1150580644607544, 1.1433608531951904, 1.1059268712997437, 1.0617482662200928, 1.0422091484069824, 1.0555940866470337, 1.3102999925613403, 1.0021684169769287, 1.3987293243408203, 1.1206896305084229, 1.0662673711776733, 1.0400696992874146, 1.2456110715866089, 1.0, 1.2183315753936768, 1.1835260391235352, 1.1268221139907837, 1.0636540651321411, 1.016837477684021, 1.0296025276184082, 1.054836630821228, 1.0741102695465088, 1.1745200157165527, 1.0629578828811646, 1.0934038162231445, 1.364306926727295, 1.0932835340499878, 1.1607823371887207, 1.036049723625183, 1.0828793048858643, 1.1522842645645142, 1.0352013111114502, 1.0248513221740723, 1.429290533065796, 1.0821137428283691, 1.185640811920166, 1.1226714849472046, 1.3265986442565918, 1.1022579669952393, 1.3667635917663574, 1.2040858268737793, 1.1685025691986084, 1.1648998260498047, 1.3684676885604858, 1.0908483266830444, 1.0272551774978638, 1.1355527639389038, 1.219390869140625, 1.4285714626312256, 1.192522406578064, 1.0577579736709595, 1.007431983947754, 1.2861788272857666, 1.1441951990127563, 1.1272834539413452, 1.0834287405014038, 1.1596221923828125, 1.1116626262664795, 1.367038369178772, 1.1173254251480103, 1.0441162586212158, 1.0354949235916138, 1.7876760959625244, 1.0510425567626953, 1.2303266525268555, 1.2428709268569946, 1.1985642910003662, 1.3052464723587036, 1.1647385358810425, 1.153342843055725, 1.0644536018371582, 1.1833534240722656, 1.0506471395492554, 1.0280898809432983, 1.1656818389892578, 1.2961446046829224, 1.0501809120178223, 1.066602110862732, 1.3160111904144287, 1.2620320320129395, 1.100959062576294, 1.186231255531311, 1.0816280841827393, 1.1927522420883179, 1.0300414562225342, 1.011181354522705, 1.0366884469985962, 1.1688311100006104, 1.111352562904358, 1.1679155826568604, 1.0709397792816162, 1.0140913724899292, 1.1645543575286865, 1.265443205833435, 1.0001779794692993, 1.0092183351516724, 1.1206632852554321, 1.008639931678772, 1.0010215044021606, 1.103223443031311, 1.1310782432556152, 1.0411546230316162, 1.3098796606063843, 1.0192875862121582, 1.4740447998046875, 1.0383485555648804, 1.0323247909545898, 1.6763583421707153, 1.2303370237350464, 1.9557173252105713, 1.1030164957046509, 1.1213005781173706, 1.085714340209961, 1.130064606666565, 1.030776858329773]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7779414653778076] ms
 --  Average per query NF    [1.3619256019592285] ms
 --  Average per query vegas [2.416015863418579] ms
Mean [1.153]  Median [1.119]  95th [1.399]  99th [1.789]  max [2.045]
Mean [1.153]  Median [1.119]  95th [1.399]  99th [1.789]  max [2.045]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.866703 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=valueskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
ValueSample - START
ValueSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[2.9535472e-02 4.7683716e-07 1.4305115e-06 5.9604645e-08 2.3841858e-07]
Distance score: 0.005907535552978516
SAUCE Drift detection: True
Detection latency: 0.0233s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.061456 | Model-update-time: 2.225155


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=valueskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.159440040588379
tensor(0.9983)
result is  tensor(457798.5312)
Enter testHyper
ReportEsts: [1.0004945993423462, 1.0393344163894653, 1.0028328895568848, 1.133463978767395, 1.2467955350875854, 1.1604572534561157, 1.1457616090774536, 1.01412034034729, 1.1883177757263184, 1.0782784223556519, 1.0235414505004883, 1.3507049083709717, 1.002392292022705, 1.0598218441009521, 509.4571533203125, 1.29062819480896, 4.2606635093688965, 1.0420900583267212, 1.0380486249923706, 1.2618333101272583, 1.163509488105774, 1.4646430015563965, 1.0627872943878174, 1.1851308345794678, 1.0825567245483398, 1.3060818910598755, 1.2234594821929932, 1.102830171585083, 1.1263518333435059, 1.366447925567627, 1.0595121383666992, 1.1521738767623901, 1.0439130067825317, 1.0556931495666504, 1.0645191669464111, 1.3538347482681274, 1.1435153484344482, 1.1632757186889648, 6.272244930267334, 1.407879114151001, 1.0031505823135376, 1.015102505683899, 1136.0, 1.0038692951202393, 1.0515741109848022, 1.093490481376648, 5.867748737335205, 1.107013463973999, 1.070038914680481, 1.2739397287368774, 1.037564992904663, 1.086419701576233, 1.0319485664367676, 2.067814588546753, 1.0782949924468994, 1.4243229627609253, 1.3640623092651367, 1.0716973543167114, 1.0654034614562988, 1.0257748365402222, 1.6020151376724243, 1.1893724203109741, 1.0740776062011719, 1.4409172534942627, 1.1860029697418213, 1.071791648864746, 1.332343339920044, 1.3422927856445312, 1.0015876293182373, 1.3274608850479126, 1.094269037246704, 1.0797569751739502, 1.1635429859161377, 1.0346115827560425, 1.0065562725067139, 1.0950231552124023, 190.08163452148438, 1.2015868425369263, 1.4400883913040161, 1.0392510890960693, 1.1914491653442383, 1.1328541040420532, 1.2188599109649658, 1.0488308668136597, 1.0761468410491943, 1.5744681358337402, 1.1306246519088745, 1.6085885763168335, 1.0086983442306519, 1.22599196434021, 1.2438182830810547, 1.458612084388733, 1.2785478830337524, 1.1474909782409668, 1.0006884336471558, 1.140973687171936, 1.0395593643188477, 1.0931240320205688, 3.468770742416382, 5.709607124328613, 1.4548439979553223, 1.3578051328659058, 1.0024570226669312, 1.1770309209823608, 1.2046732902526855, 1.01096773147583, 1.2598297595977783, 1.068015694618225, 1.14673912525177, 1.0667881965637207, 1.3627272844314575, 1.0431243181228638, 1.0679099559783936, 1.2144004106521606, 1.1163376569747925, 1.5333138704299927, 1.0711160898208618, 1.317995309829712, 1.0827417373657227, 1.039370059967041, 1.2057214975357056, 1.1537233591079712, 1.2981891632080078, 4.75, 1.213462233543396, 1.230776309967041, 1.050062656402588, 1.0227617025375366, 1.0230273008346558, 3.5468878746032715, 8.319808006286621, 1.0368399620056152, 1.0801728963851929, 1.416934609413147, 1.4755892753601074, 1.316589593887329, 1.073941707611084, 1.034749984741211, 1.2239634990692139, 1.1846991777420044, 1.0936768054962158, 1.0038601160049438, 1.3017629384994507, 1.1588423252105713, 1.2259297370910645, 1.2402673959732056, 1.419540286064148, 1.3119454383850098, 1.1932569742202759, 1.2368789911270142, 1.0050251483917236, 1.2016584873199463, 1.162147045135498, 1.117578387260437, 1.2146018743515015, 1.0842465162277222, 1.14425790309906, 1.0620155334472656, 1.0825011730194092, 1.075661301612854, 1.1715646982192993, 1.1416666507720947, 1.0935550928115845, 1.0858056545257568, 1.2101291418075562, 1.1336650848388672, 1.046470046043396, 3.7985126972198486, 337.0, 1.1644290685653687, 1.1371062994003296, 1.0666817426681519, 1.4840940237045288, 1.0621403455734253, 1.0608971118927002, 1.0145186185836792, 4.425287246704102, 1.0305118560791016, 1.014061450958252, 1.1585086584091187, 1.644444465637207, 1.1670600175857544, 1.0319517850875854, 1.6679857969284058, 1.1360474824905396, 7.516838550567627, 2.1947824954986572, 1.2577487230300903, 1.4635730981826782, 1.1252295970916748, 1.0158528089523315, 1.0433152914047241, 1.2439008951187134, 1.682176947593689, 1.2684094905853271, 1.2265725135803223, 1.2164584398269653, 1.1323751211166382, 1.3486088514328003, 1.088765025138855]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.709346055984497] ms
 --  Average per query NF    [1.3524103164672852] ms
 --  Average per query vegas [2.356935739517212] ms
Mean [12.247]  Median [1.150]  95th [4.442]  99th [338.725]  max [1136.000]
Mean [12.247]  Median [1.150]  95th [4.442]  99th [338.725]  max [1136.000]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.380573 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.580985