Input arguments = Namespace(data_update='valueskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 49, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.16467022895813
tensor(0.9957)
result is  tensor(380510.5938)
Enter testHyper
ReportEsts: [1.1157115697860718, 1.0482177734375, 1.297910213470459, 1.045272707939148, 1.259928822517395, 1.1095867156982422, 1.2817131280899048, 1.0856330394744873, 1.0706021785736084, 1.0321317911148071, 1.0861326456069946, 1.1360169649124146, 1.1221097707748413, 1.0513392686843872, 1.1683084964752197, 1.0046390295028687, 1.3292895555496216, 1.120308756828308, 1.1402080059051514, 1.0535714626312256, 1.126746416091919, 1.101460337638855, 1.0869828462600708, 1.148518443107605, 1.148574709892273, 1.0795660018920898, 1.0292792320251465, 1.4523380994796753, 1.0087008476257324, 1.1037534475326538, 1.1323164701461792, 1.235019326210022, 1.0348325967788696, 1.0799826383590698, 1.1158788204193115, 1.2001254558563232, 1.310803771018982, 1.3063151836395264, 1.2131922245025635, 1.1086227893829346, 1.0114251375198364, 1.0751088857650757, 1.0048037767410278, 1.0673234462738037, 1.0912740230560303, 1.1961451768875122, 1.1022578477859497, 1.2249122858047485, 1.0171726942062378, 1.0507614612579346, 1.1730279922485352, 1.4677813053131104, 1.0039170980453491, 1.186618685722351, 1.312558889389038, 1.0560964345932007, 1.1794393062591553, 1.040629506111145, 1.2042865753173828, 1.4510231018066406, 1.5120536088943481, 1.1760786771774292, 1.288995623588562, 1.1546913385391235, 1.375, 1.3142857551574707, 1.0904347896575928, 1.0179953575134277, 1.0842641592025757, 1.4736841917037964, 1.0337892770767212, 1.0921344757080078, 1.2010036706924438, 1.0391708612442017, 1.1407166719436646, 1.1411699056625366, 1.8613698482513428, 1.0043432712554932, 1.0093854665756226, 1.3053836822509766, 1.1413404941558838, 1.1444032192230225, 1.0526481866836548, 1.1932505369186401, 1.2525686025619507, 1.1464781761169434, 1.0384140014648438, 1.0625473260879517, 1.0121527910232544, 1.069906234741211, 1.1631313562393188, 1.343855619430542, 1.010818600654602, 1.2612282037734985, 1.1538461446762085, 1.0699199438095093, 1.0100513696670532, 1.1663177013397217, 1.034482717514038, 1.1305121183395386, 1.2427921295166016, 1.1022229194641113, 1.0262583494186401, 1.000732660293579, 1.0041841268539429, 1.0905563831329346, 1.1806339025497437, 1.179755687713623, 1.0587772130966187, 1.0099010467529297, 1.2422488927841187, 1.1035782098770142, 1.2662149667739868, 1.0777875185012817, 1.0868204832077026, 1.1073170900344849, 1.083356499671936, 1.0216102600097656, 1.2532778978347778, 1.2949813604354858, 1.2535430192947388, 1.1153581142425537, 1.1192904710769653, 1.1483101844787598, 1.2616279125213623, 1.2277135848999023, 1.0558072328567505, 1.2813482284545898, 1.264320731163025, 1.1282565593719482, 1.024090051651001, 1.1093121767044067, 1.1193287372589111, 1.5357142686843872, 1.0747288465499878, 1.1107902526855469, 1.0550585985183716, 1.0113821029663086, 1.0922361612319946, 1.4840961694717407, 1.1442580223083496, 1.046202301979065, 1.1382043361663818, 1.2560522556304932, 1.0320929288864136, 1.1779638528823853, 1.0263522863388062, 1.6542551517486572, 1.0101381540298462, 1.1398437023162842, 1.149814248085022, 1.2254838943481445, 1.3429661989212036, 1.154556155204773, 1.1560683250427246, 1.0096852779388428, 1.0784602165222168, 1.0360157489776611, 1.0365056991577148, 1.214085340499878, 1.1717803478240967, 1.095175862312317, 1.0305700302124023, 1.2941988706588745, 1.250331163406372, 1.079316258430481, 1.1174789667129517, 1.1870390176773071, 1.0502874851226807, 1.1627739667892456, 1.1930334568023682, 1.2018049955368042, 1.097402572631836, 1.0919578075408936, 1.1178474426269531, 1.0294005870819092, 1.024295449256897, 1.4220093488693237, 1.1680508852005005, 1.0474501848220825, 1.0089439153671265, 1.0704150199890137, 1.002947449684143, 1.1981613636016846, 1.127852201461792, 1.116279125213623, 1.0198420286178589, 1.2745654582977295, 1.0654493570327759, 1.3715490102767944, 1.003167748451233, 1.1303330659866333, 1.538959264755249, 1.3849326372146606, 1.8719007968902588, 1.1535714864730835, 1.2413922548294067, 1.225806474685669, 1.1898479461669922, 1.1961818933486938]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7692952156066895] ms
 --  Average per query NF    [1.3630223274230957] ms
 --  Average per query vegas [2.4062728881835938] ms
Mean [1.156]  Median [1.121]  95th [1.451]  99th [1.656]  max [1.872]
Mean [1.156]  Median [1.121]  95th [1.451]  99th [1.656]  max [1.872]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.840000 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=valueskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
ValueSample - START
ValueSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[8.7364316e-03 1.1324883e-06 4.1723251e-07 1.3113022e-06 5.9604645e-08]
Distance score: 0.0017478704685345292
SAUCE Drift detection: True
Detection latency: 0.0237s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.056902 | Model-update-time: 2.256954


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=valueskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.160390138626099
tensor(0.9949)
result is  tensor(456256.)
Enter testHyper
ReportEsts: [1.222946047782898, 1.0748976469039917, 1.0198299884796143, 1.3559322357177734, 1.1947380304336548, 1.4945321083068848, 1.3499691486358643, 1.1220520734786987, 1.0281291007995605, 1.126826524734497, 1.0024088621139526, 1.3085097074508667, 2.017326831817627, 1.181227207183838, 25.19607925415039, 1.1531022787094116, 2.128000020980835, 1.0867085456848145, 1.0202889442443848, 1.40045964717865, 1.2069238424301147, 1.6907097101211548, 1.109793782234192, 1.0349032878875732, 1.1593221426010132, 1.4447753429412842, 1.1041810512542725, 1.1221338510513306, 1.1325300931930542, 1.1673338413238525, 1.0853126049041748, 1.3333333730697632, 1.054763674736023, 1.0497750043869019, 1.0168441534042358, 1.081196665763855, 1.1075825691223145, 1.4192677736282349, 1.5972955226898193, 1.817148208618164, 1.027359962463379, 1.0306553840637207, 46.908164978027344, 1.116171956062317, 1.0089635848999023, 1.1202630996704102, 1.534445881843567, 1.2382868528366089, 1.1405622959136963, 1.1634637117385864, 1.0518746376037598, 1.0230988264083862, 1.683814287185669, 1.2284412384033203, 1.2622653245925903, 1.3273742198944092, 1.1679579019546509, 1.0882230997085571, 1.0538663864135742, 1.1435348987579346, 1.3816630840301514, 1.1692469120025635, 1.1917845010757446, 1.8711656332015991, 1.0451167821884155, 1.037289023399353, 1.289802074432373, 1.2392016649246216, 1.0645734071731567, 1.2265522480010986, 1.04985773563385, 1.4459935426712036, 1.0006126165390015, 1.082955241203308, 1.0553483963012695, 1.04029381275177, 264.0, 1.278135061264038, 1.085955262184143, 1.0453336238861084, 1.0278422832489014, 1.0788776874542236, 1.1417123079299927, 1.165676236152649, 1.1327860355377197, 1.6510637998580933, 1.1839754581451416, 1.6085561513900757, 1.1543989181518555, 1.1668912172317505, 1.0868256092071533, 1.108128309249878, 1.387698769569397, 1.3372288942337036, 1.3653172254562378, 1.0715250968933105, 1.1096258163452148, 1.2408615350723267, 1.5679172277450562, 1.7996526956558228, 1.155874252319336, 1.0198034048080444, 1.0563725233078003, 1.0743682384490967, 1.0825035572052002, 1.15929114818573, 1.0014668703079224, 1.0069433450698853, 1.232758641242981, 1.0068583488464355, 4.62851619720459, 1.1149405241012573, 1.0458896160125732, 1.4094136953353882, 1.099705457687378, 2.208503484725952, 1.1682889461517334, 1.0865181684494019, 1.0906827449798584, 1.0232558250427246, 1.0645513534545898, 1.0331294536590576, 1.1707907915115356, 2.1187682151794434, 1.119375228881836, 1.2793996334075928, 1.0098289251327515, 1.0449612140655518, 1.0548949241638184, 1.7692562341690063, 1.6824266910552979, 1.1544772386550903, 1.244462251663208, 1.6797966957092285, 1.7195358276367188, 1.2612359523773193, 1.0410667657852173, 1.0714881420135498, 1.4242005348205566, 1.1723859310150146, 1.0166057348251343, 1.0126410722732544, 1.3441485166549683, 1.037523627281189, 1.1312130689620972, 1.037495732307434, 1.5057470798492432, 1.1321206092834473, 1.1842397451400757, 1.21061110496521, 1.0104913711547852, 1.2483980655670166, 1.1424356698989868, 1.2528045177459717, 1.2854245901107788, 1.1055140495300293, 1.2056140899658203, 1.0620155334472656, 1.106765866279602, 1.042444109916687, 1.1403899192810059, 1.4452381134033203, 1.165126919746399, 1.009387493133545, 1.109706997871399, 1.4428136348724365, 1.0211819410324097, 1.2010701894760132, 290.75, 1.2461135387420654, 1.0448285341262817, 1.1257933378219604, 1.4673333168029785, 1.102173924446106, 1.0193288326263428, 1.0099295377731323, 1.1143457889556885, 1.1407623291015625, 1.0676339864730835, 1.049314022064209, 1.8333333730697632, 1.1173409223556519, 1.0991417169570923, 1.101628065109253, 1.1545510292053223, 2.359999895095825, 1.2794475555419922, 1.237779140472412, 1.5460177659988403, 1.1923168897628784, 1.021868348121643, 1.0016536712646484, 1.2859987020492554, 1.9563130140304565, 1.1782079935073853, 1.090361475944519, 1.6306788921356201, 1.0490775108337402, 1.36896550655365, 1.3753019571304321]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7189316749572754] ms
 --  Average per query NF    [1.3575851917266846] ms
 --  Average per query vegas [2.361346483230591] ms
Mean [4.355]  Median [1.143]  95th [1.959]  99th [49.079]  max [290.750]
Mean [4.355]  Median [1.143]  95th [1.959]  99th [49.079]  max [290.750]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.367513 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.577427