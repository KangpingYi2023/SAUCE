Input arguments = Namespace(data_update='valueskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 59, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.161822080612183
tensor(0.9968)
result is  tensor(380959.7188)
Enter testHyper
ReportEsts: [1.235276222229004, 1.0165995359420776, 1.142948865890503, 1.1419246196746826, 1.2426191568374634, 1.1041631698608398, 1.1913135051727295, 1.00089693069458, 1.0649158954620361, 1.061277151107788, 1.164513349533081, 1.1752119064331055, 1.0402992963790894, 1.0446428060531616, 1.079190731048584, 1.3820585012435913, 1.1931076049804688, 1.1172208786010742, 1.185608983039856, 1.0892857313156128, 1.052937626838684, 1.1209964752197266, 1.131988286972046, 1.1702300310134888, 1.117209792137146, 1.0759493112564087, 1.0655968189239502, 1.4154250621795654, 1.0027304887771606, 1.1266402006149292, 1.1830435991287231, 1.1349767446517944, 1.079234004020691, 1.0044898986816406, 1.1816834211349487, 1.0496938228607178, 1.235074758529663, 1.0401638746261597, 1.0320154428482056, 1.004692554473877, 1.0185996294021606, 1.1394532918930054, 1.1875895261764526, 1.0372263193130493, 1.0640186071395874, 1.0272108316421509, 1.081015706062317, 1.3795692920684814, 1.0554721355438232, 1.0846023559570312, 1.1850899457931519, 1.223222017288208, 1.050597071647644, 1.3200935125350952, 1.1320687532424927, 1.0542420148849487, 1.2766355276107788, 1.187585473060608, 1.3061840534210205, 1.2673003673553467, 1.5580874681472778, 1.1519204378128052, 1.301284670829773, 1.137147307395935, 1.1498258113861084, 1.1714285612106323, 1.1307483911514282, 1.002423644065857, 1.2202900648117065, 1.2842105627059937, 1.0539017915725708, 1.0441293716430664, 1.220698356628418, 1.0557185411453247, 1.0754646062850952, 1.1701269149780273, 1.7582815885543823, 1.0601972341537476, 1.067048192024231, 1.2816901206970215, 1.071671485900879, 1.1172670125961304, 1.0484822988510132, 1.1788300275802612, 1.2419084310531616, 1.019966959953308, 1.085060477256775, 1.1270112991333008, 1.0192044973373413, 1.0990960597991943, 1.0245389938354492, 1.383720874786377, 1.0100973844528198, 1.27230703830719, 1.0372340679168701, 1.0497874021530151, 1.300489902496338, 1.1566765308380127, 1.01694917678833, 1.0676902532577515, 1.21875, 1.0678250789642334, 1.020238995552063, 1.0065885782241821, 1.050523042678833, 1.008236289024353, 1.1855425834655762, 1.1815009117126465, 1.1213033199310303, 1.0644607543945312, 1.1950733661651611, 1.0882079601287842, 1.2278136014938354, 1.0218846797943115, 1.1328387260437012, 1.0271493196487427, 1.0238970518112183, 1.154133915901184, 1.3531813621520996, 1.0424093008041382, 1.1477071046829224, 1.1153581142425537, 1.0666799545288086, 1.1627546548843384, 1.3304263353347778, 1.1813867092132568, 1.102264642715454, 1.0646967887878418, 1.3944042921066284, 1.1292585134506226, 1.2422484159469604, 1.2527451515197754, 1.168116807937622, 1.5357142686843872, 1.068923830986023, 1.0034246444702148, 1.0726083517074585, 1.108617901802063, 1.128804326057434, 1.4569687843322754, 1.1941858530044556, 1.2155245542526245, 1.0451592206954956, 1.405795931816101, 1.1253154277801514, 1.0091125965118408, 1.0829603672027588, 1.6549088954925537, 1.0368276834487915, 1.0836647748947144, 1.182873249053955, 1.1845917701721191, 1.2861618995666504, 1.1075369119644165, 1.1214970350265503, 1.152418613433838, 1.0810796022415161, 1.0151385068893433, 1.0064632892608643, 1.1585198640823364, 1.2645198106765747, 1.0587620735168457, 1.029195785522461, 1.2853223085403442, 1.2470277547836304, 1.0897480249404907, 1.2415040731430054, 1.1675904989242554, 1.011528491973877, 1.044154167175293, 1.094191312789917, 1.0262397527694702, 1.1688311100006104, 1.2351891994476318, 1.0592643022537231, 1.0056713819503784, 1.0354713201522827, 1.337260365486145, 1.1961222887039185, 1.040246844291687, 1.0206526517868042, 1.1126682758331299, 1.040250539779663, 1.2053115367889404, 1.1227816343307495, 1.1469345092773438, 1.1274665594100952, 1.2554157972335815, 1.1013129949569702, 1.403394341468811, 1.0044649839401245, 1.026131510734558, 1.3561415672302246, 1.304584264755249, 1.5997376441955566, 1.1709970235824585, 1.079866647720337, 1.1343283653259277, 1.1176351308822632, 1.182503342628479]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7650680541992188] ms
 --  Average per query NF    [1.3600969314575195] ms
 --  Average per query vegas [2.404971122741699] ms
Mean [1.147]  Median [1.122]  95th [1.384]  99th [1.600]  max [1.758]
Mean [1.147]  Median [1.122]  95th [1.384]  99th [1.600]  max [1.758]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.840307 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=valueskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
ValueSample - START
ValueSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[8.3446503e-07 1.7881393e-07 9.5367432e-07 1.7881393e-07 1.6690135e-02]
Distance score: 0.003338456153869629
SAUCE Drift detection: True
Detection latency: 0.0231s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.046560 | Model-update-time: 2.231873


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=valueskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.21286654472351
tensor(0.9960)
result is  tensor(456765.2812)
Enter testHyper
ReportEsts: [1.2565629482269287, 1.0653263330459595, 1.240412950515747, 5.558200836181641, 1.0627894401550293, 2.2930638790130615, 1.1219080686569214, 1.184831976890564, 1.1623315811157227, 1.071339726448059, 1.0192148685455322, 1.4539347887039185, 1.1002386808395386, 1.1294485330581665, 1.052138328552246, 1.1898365020751953, 9.530092239379883, 1.2063982486724854, 1.0217838287353516, 1.117547869682312, 1.0270262956619263, 10.111834526062012, 27.04790496826172, 1.0460888147354126, 1.179505467414856, 1.5560368299484253, 1.3826658725738525, 1.3799887895584106, 1.7269890308380127, 1.3792024850845337, 1.371212124824524, 1.398305058479309, 1.2748768329620361, 91.9502944946289, 1.1429044008255005, 1.1074776649475098, 1.053617000579834, 1.0881357192993164, 1.487688660621643, 1.3435397148132324, 1.0349992513656616, 1.1366539001464844, 83.52528381347656, 1.101709008216858, 1.0925840139389038, 1.1836810111999512, 1.152086615562439, 1.0498602390289307, 1.3809523582458496, 1.2041099071502686, 1.1825284957885742, 1.4265410900115967, 1.1106230020523071, 1.1252374649047852, 1.0456186532974243, 1.3944110870361328, 1.1603999137878418, 1.0316989421844482, 1.2745510339736938, 1.1328052282333374, 4.321608066558838, 1.0316662788391113, 1.0513579845428467, 2.5126242637634277, 1.035760521888733, 1.0622003078460693, 1.3180028200149536, 1.201542854309082, 1.1044387817382812, 1.0777469873428345, 1.135385513305664, 1.0856447219848633, 1.1494495868682861, 1.0928515195846558, 1.181573748588562, 1.1383342742919922, 1.0687830448150635, 1.2183598279953003, 1.2349811792373657, 1.1051064729690552, 1.1954022645950317, 1.1034778356552124, 1.2057676315307617, 1.1183817386627197, 1.4041703939437866, 1.5957447290420532, 1.321112871170044, 1.480183482170105, 1.0115282535552979, 19.88245964050293, 1.142894983291626, 1.0982484817504883, 2.2317545413970947, 1.129095435142517, 1.7048057317733765, 1.1259621381759644, 1.0814008712768555, 1.3252335786819458, 1.1936619281768799, 1.6222889423370361, 1.2231502532958984, 1.1401711702346802, 1.2757731676101685, 1.54862642288208, 1.0851713418960571, 1.196825385093689, 1.0271497964859009, 1.0427632331848145, 1.166212558746338, 1.2180736064910889, 1.0561087131500244, 1.0695276260375977, 1.2411404848098755, 1.2775565385818481, 1.3326643705368042, 1.0687085390090942, 1.5394492149353027, 1.0242823362350464, 1.6546152830123901, 1.1327433586120605, 1.0422970056533813, 1.0827549695968628, 1.063818335533142, 4.022857189178467, 1.0692204236984253, 1.2327756881713867, 1.2198306322097778, 1.2379471063613892, 1.2613033056259155, 1.0824089050292969, 1.0178991556167603, 1.2738921642303467, 1.0106005668640137, 7.029885292053223, 1.3563748598098755, 1.3068406581878662, 1.3399044275283813, 1.0568889379501343, 1.1237208843231201, 1.0214375257492065, 1.0492305755615234, 1.093019723892212, 1.033360481262207, 1.096972942352295, 1.0449155569076538, 1.0235756635665894, 1.3105590343475342, 1.0857264995574951, 1.088811993598938, 1.3353973627090454, 1.0709487199783325, 1.024699330329895, 1.2823938131332397, 1.0119026899337769, 1.0969732999801636, 1.1410495042800903, 1.1884477138519287, 1.4639999866485596, 1.7844310998916626, 1.0336700677871704, 1.0335437059402466, 1.2065476179122925, 2.6097447872161865, 1.0800721645355225, 1.1035962104797363, 1.7251449823379517, 1.314300298690796, 1.530219554901123, 1.0018692016601562, 1.2751113176345825, 1.173255443572998, 1.2029430866241455, 1.3495508432388306, 1.32015860080719, 1.126757264137268, 1.204852819442749, 1.0881048440933228, 1.3555339574813843, 1.055572748184204, 1.2047851085662842, 1.9736841917037964, 1.0807944536209106, 1.036651372909546, 1.6348159313201904, 2.0793814659118652, 1.0183981657028198, 4.1460957527160645, 1.0637799501419067, 2.7136409282684326, 1.040519118309021, 1.211058497428894, 1.0138444900512695, 1.0168408155441284, 1.4799476861953735, 1.0001683235168457, 1.613222599029541, 1.203680396080017, 1.0236120223999023, 1.9870967864990234, 1.0584793090820312]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [4.571248292922974] ms
 --  Average per query NF    [1.4850199222564697] ms
 --  Average per query vegas [3.086228370666504] ms
Mean [2.508]  Median [1.164]  95th [4.029]  99th [27.613]  max [91.950]
Mean [2.508]  Median [1.164]  95th [4.029]  99th [27.613]  max [91.950]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.623298 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.766841