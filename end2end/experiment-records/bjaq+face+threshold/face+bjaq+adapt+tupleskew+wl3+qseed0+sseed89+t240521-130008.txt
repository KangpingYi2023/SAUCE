Input arguments = Namespace(data_update='tupleskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 89, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.160317182540894
tensor(0.9958)
result is  tensor(380559.5000)
Enter testHyper
ReportEsts: [1.1719470024108887, 1.0448089838027954, 1.2879910469055176, 1.1794061660766602, 1.2368344068527222, 1.067720651626587, 1.2389447689056396, 1.0619118213653564, 1.145714282989502, 1.1022071838378906, 1.0663220882415771, 1.123305082321167, 1.0984880924224854, 1.0848214626312256, 1.029953956604004, 1.2053229808807373, 1.2621856927871704, 1.2972683906555176, 1.2233904600143433, 1.165816307067871, 1.0359047651290894, 1.0887598991394043, 1.1540604829788208, 1.047400712966919, 1.081679344177246, 1.0967450141906738, 1.0532094240188599, 1.5779188871383667, 1.0084242820739746, 1.1200284957885742, 1.1291238069534302, 1.1666425466537476, 1.121308445930481, 1.0769964456558228, 1.1487399339675903, 1.2320126295089722, 1.4211745262145996, 1.133439064025879, 1.1200079917907715, 1.063233494758606, 1.0227068662643433, 1.1358249187469482, 1.0550657510757446, 1.0733442306518555, 1.0591590404510498, 1.0634920597076416, 1.056503415107727, 1.3634055852890015, 1.0193341970443726, 1.1116751432418823, 1.146766185760498, 1.3677377700805664, 1.064677119255066, 1.248815894126892, 1.1421418190002441, 1.002781629562378, 1.3028037548065186, 1.1302117109298706, 1.212244987487793, 1.4255774021148682, 1.21367609500885, 1.2006021738052368, 1.2368299961090088, 1.1268632411956787, 1.3924050331115723, 1.1714285612106323, 1.137930989265442, 1.0452760457992554, 1.0489085912704468, 1.3157894611358643, 1.0401673316955566, 1.1082810163497925, 1.1404469013214111, 1.229085922241211, 1.158068299293518, 1.224686861038208, 2.1226425170898438, 1.0421849489212036, 1.0353477001190186, 1.4444444179534912, 1.1896358728408813, 1.182038426399231, 1.0141785144805908, 1.2046033143997192, 1.1938762664794922, 1.0285674333572388, 1.0431551933288574, 1.0459016561508179, 1.1051349639892578, 1.0976864099502563, 1.0072091817855835, 1.322800874710083, 1.0146359205245972, 1.2534730434417725, 1.1470588445663452, 1.1700719594955444, 1.1306819915771484, 1.049905776977539, 1.0333333015441895, 1.0993353128433228, 1.151898741722107, 1.0416581630706787, 1.068219542503357, 1.0065885782241821, 1.1443514823913574, 1.0349611043930054, 1.1810952425003052, 1.2251309156417847, 1.0258277654647827, 1.017729640007019, 1.0966144800186157, 1.105660319328308, 1.0768723487854004, 1.0409870147705078, 1.004288911819458, 1.1237623691558838, 1.009645938873291, 1.002321720123291, 1.320648431777954, 1.1300777196884155, 1.2708128690719604, 1.1526838541030884, 1.2512502670288086, 1.191643476486206, 1.3226743936538696, 1.1975855827331543, 1.0486092567443848, 1.3203614950180054, 1.2674323320388794, 1.099198341369629, 1.0560928583145142, 1.183058261871338, 1.0839030742645264, 1.5, 1.0474145412445068, 1.0283539295196533, 1.0166585445404053, 1.2009756565093994, 1.1271567344665527, 1.0627777576446533, 1.1823385953903198, 1.0004634857177734, 1.027585506439209, 1.2872141599655151, 1.069502592086792, 1.0077041387557983, 1.1165469884872437, 1.5442391633987427, 1.1042152643203735, 1.0079545974731445, 1.040215015411377, 1.1926676034927368, 1.302485466003418, 1.0008193254470825, 1.0701189041137695, 1.1385923624038696, 1.1096134185791016, 1.0377039909362793, 1.024889349937439, 1.1976723670959473, 1.172595739364624, 1.0104838609695435, 1.060787558555603, 1.261103630065918, 1.1512194871902466, 1.074906349182129, 1.2253247499465942, 1.3575963973999023, 1.0931278467178345, 1.0098669528961182, 1.02901291847229, 1.1189069747924805, 1.1363636255264282, 1.228389859199524, 1.0667574405670166, 1.1202846765518188, 1.042553186416626, 1.4167890548706055, 1.0856691598892212, 1.1855721473693848, 1.1428269147872925, 1.028685212135315, 1.0699714422225952, 1.1082737445831299, 1.1579138040542603, 1.0856236219406128, 1.0135443210601807, 1.2980490922927856, 1.2723966836929321, 1.34766685962677, 1.0112944841384888, 1.024619460105896, 1.6709601879119873, 1.3396276235580444, 1.9317697286605835, 1.2250316143035889, 1.0480200052261353, 1.1014492511749268, 1.2399470806121826, 1.0843957662582397]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7794220447540283] ms
 --  Average per query NF    [1.3699185848236084] ms
 --  Average per query vegas [2.40950345993042] ms
Mean [1.152]  Median [1.120]  95th [1.394]  99th [1.674]  max [2.123]
Mean [1.152]  Median [1.120]  95th [1.394]  99th [1.674]  max [2.123]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.836414 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=tupleskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
TupleSkewSample - START
0.001
TupleSkewSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[3.3080578e-05 2.5033951e-06 1.3947487e-05 4.5120716e-05 6.9141388e-06]
Distance score: 2.0313262211857364e-05
SAUCE Drift detection: True
Detection latency: 0.0229s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 1.997310 | Model-update-time: 2.221796


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=tupleskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.168073177337646
tensor(0.9909)
result is  tensor(454449.6875)
Enter testHyper
ReportEsts: [1.0569913387298584, 1.1121156215667725, 1.6554251909255981, 1.155771017074585, 1.0077221393585205, 1.1986407041549683, 1.2639487981796265, 1.084686040878296, 1.0956908464431763, 1.0343260765075684, 1.0353368520736694, 1.3442713022232056, 1.3596287965774536, 1.07722806930542, 1.2041691541671753, 1.0016878843307495, 1.0612527132034302, 1.2180043458938599, 1.0703856945037842, 1.3091695308685303, 1.0198829174041748, 1.9493120908737183, 1.1775156259536743, 1.355444312095642, 1.1509112119674683, 1.1314973831176758, 1.1771453619003296, 1.2079557180404663, 1.5815062522888184, 1.5537190437316895, 1.4487179517745972, 1.681564211845398, 1.048269271850586, 1.0226914882659912, 1.1038017272949219, 1.0931317806243896, 1.1264688968658447, 1.059880256652832, 1.1482287645339966, 1.0563570261001587, 1.023023009300232, 1.1876484155654907, 1.000860571861267, 1.0365697145462036, 1.0552273988723755, 1.1448619365692139, 1.0805504322052002, 1.2783244848251343, 1.2761905193328857, 1.1109060049057007, 1.0937714576721191, 1.0144624710083008, 1.063454031944275, 1.1148258447647095, 1.0045362710952759, 1.1763726472854614, 1.2158043384552002, 1.0937297344207764, 1.1385222673416138, 1.1065192222595215, 1.057199239730835, 1.0857089757919312, 1.112816572189331, 1.4827511310577393, 1.0098648071289062, 1.0459963083267212, 1.331716775894165, 1.0748473405838013, 1.079424262046814, 1.0727603435516357, 1.1346944570541382, 1.2415310144424438, 1.1017450094223022, 1.0838693380355835, 1.2657381296157837, 1.143800139427185, 1.5559921264648438, 1.0286651849746704, 1.2823599576950073, 1.1395262479782104, 1.0724759101867676, 1.2385585308074951, 1.047217607498169, 1.1764624118804932, 1.1806986331939697, 1.6170213222503662, 1.2916682958602905, 1.5850317478179932, 1.5407332181930542, 1.6168674230575562, 1.3791005611419678, 1.0918320417404175, 1.3751667737960815, 1.1960070133209229, 1.2144695520401, 1.04403555393219, 1.1099199056625366, 1.308180809020996, 1.0704916715621948, 1.0288981199264526, 1.0704991817474365, 1.1489191055297852, 1.0303030014038086, 1.1354937553405762, 1.2090541124343872, 1.2889817953109741, 1.0340771675109863, 1.1628258228302002, 1.5128204822540283, 1.0520685911178589, 1.0835338830947876, 1.0872230529785156, 1.1069449186325073, 1.111727237701416, 1.1204763650894165, 1.0310965776443481, 1.1354260444641113, 1.0714073181152344, 1.1272966861724854, 1.0560747385025024, 1.0046026706695557, 1.0833333730697632, 1.070770263671875, 1.0261073112487793, 1.001965880393982, 1.169443130493164, 1.255763053894043, 1.4377049207687378, 1.2018316984176636, 1.1119647026062012, 1.1667699813842773, 1.085065245628357, 1.0682306289672852, 1.6578947305679321, 1.4683167934417725, 1.1097309589385986, 1.102939486503601, 1.1380164623260498, 1.0860974788665771, 1.01925790309906, 1.0840132236480713, 1.1845680475234985, 1.0287330150604248, 1.0815727710723877, 1.046988606452942, 1.0880333185195923, 1.178770899772644, 1.1142165660858154, 1.054577350616455, 1.0869964361190796, 1.0044671297073364, 1.0689091682434082, 1.1495782136917114, 1.0426338911056519, 1.0088012218475342, 1.3851025104522705, 1.2033230066299438, 1.0538461208343506, 1.1386704444885254, 1.0831280946731567, 1.0571517944335938, 1.3077380657196045, 1.0639069080352783, 1.015570044517517, 1.059772253036499, 1.2351208925247192, 1.3095006942749023, 1.022632360458374, 1.0901411771774292, 1.0307728052139282, 1.0099931955337524, 1.0453153848648071, 1.356659173965454, 1.1393500566482544, 1.069692611694336, 1.0225775241851807, 1.1016186475753784, 1.0352778434753418, 1.036613941192627, 1.0977504253387451, 1.763157844543457, 1.3445333242416382, 1.0278527736663818, 1.5595263242721558, 1.3223531246185303, 1.238601803779602, 1.0008492469787598, 1.3046648502349854, 1.2938978672027588, 1.0064538717269897, 1.1512349843978882, 1.0814104080200195, 1.1702759265899658, 2.056586742401123, 1.0772794485092163, 1.2831541299819946, 1.0140100717544556, 1.0704127550125122, 1.0483384132385254, 1.0379096269607544]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.618971109390259] ms
 --  Average per query NF    [1.3544058799743652] ms
 --  Average per query vegas [2.2645652294158936] ms
Mean [1.170]  Median [1.107]  95th [1.561]  99th [1.765]  max [2.057]
Mean [1.170]  Median [1.107]  95th [1.561]  99th [1.765]  max [2.057]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.347848 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.453788