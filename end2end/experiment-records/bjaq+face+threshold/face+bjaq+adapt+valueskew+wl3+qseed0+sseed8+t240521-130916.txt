Input arguments = Namespace(data_update='valueskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 8, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.208553552627563
tensor(0.9923)
result is  tensor(379228.2500)
Enter testHyper
ReportEsts: [1.1831927299499512, 1.0883827209472656, 1.3162167072296143, 1.2796378135681152, 1.2610501050949097, 1.106214165687561, 1.1911062002182007, 1.1764805316925049, 1.1341923475265503, 1.1265891790390015, 1.0034452676773071, 1.0815677642822266, 1.1201655864715576, 1.0691964626312256, 1.0186179876327515, 1.2178188562393188, 1.0859448909759521, 1.1051068305969238, 1.2035328149795532, 1.0816326141357422, 1.1537293195724487, 1.1230747699737549, 1.127958059310913, 1.0592601299285889, 1.065425157546997, 1.055153727531433, 1.096002221107483, 1.314076542854309, 1.1073670387268066, 1.1465771198272705, 1.1401206254959106, 1.1649348735809326, 1.024609088897705, 1.0982283353805542, 1.1207791566848755, 1.1830230951309204, 1.3976984024047852, 1.0276787281036377, 1.0194355249404907, 1.1097819805145264, 1.027850866317749, 1.1915819644927979, 1.05411696434021, 1.112183690071106, 1.0961335897445679, 1.0442177057266235, 1.1181988716125488, 1.2771172523498535, 1.2253676652908325, 1.0355329513549805, 1.1943005323410034, 1.325991153717041, 1.0213046073913574, 1.0214359760284424, 1.0895382165908813, 1.0329160690307617, 1.2345794439315796, 1.0915676355361938, 1.2158973217010498, 1.385286808013916, 1.2166852951049805, 1.160487174987793, 1.2708908319473267, 1.2674274444580078, 1.1913357973098755, 1.0285714864730835, 1.1589648723602295, 1.0373915433883667, 1.1928822994232178, 1.2842105627059937, 1.0128720998764038, 1.0402899980545044, 1.105249047279358, 1.08859121799469, 1.040534257888794, 1.3786308765411377, 1.7278738021850586, 1.1353102922439575, 1.024199366569519, 1.4455218315124512, 1.0270190238952637, 1.1473106145858765, 1.0655277967453003, 1.3175487518310547, 1.1831694841384888, 1.117517352104187, 1.0184146165847778, 1.2204792499542236, 1.061294674873352, 1.093871831893921, 1.133406639099121, 1.4418050050735474, 1.002893328666687, 1.2313199043273926, 1.0427807569503784, 1.1508033275604248, 1.0660998821258545, 1.3061827421188354, 1.01694917678833, 1.175077199935913, 1.2938388586044312, 1.0299184322357178, 1.0636831521987915, 1.0051244497299194, 1.0518208742141724, 1.020504355430603, 1.1401950120925903, 1.1884816884994507, 1.0719879865646362, 1.0347867012023926, 1.3927794694900513, 1.0984067916870117, 1.0569223165512085, 1.0781700611114502, 1.3298945426940918, 1.1822916269302368, 1.0226885080337524, 1.0571391582489014, 1.3978188037872314, 1.1613292694091797, 1.1456706523895264, 1.0698909759521484, 1.212842583656311, 1.146270990371704, 1.2562984228134155, 1.1849979162216187, 1.1379846334457397, 1.1902285814285278, 1.2127158641815186, 1.113560438156128, 1.24025559425354, 1.2881238460540771, 1.19328773021698, 1.5, 1.174545407295227, 1.0539568662643433, 1.056129813194275, 1.1723576784133911, 1.1626101732254028, 1.407652735710144, 1.1460500955581665, 1.0231337547302246, 1.0986899137496948, 1.3183090686798096, 1.0717040300369263, 1.040848731994629, 1.1674820184707642, 1.4888737201690674, 1.1403875350952148, 1.1171164512634277, 1.0741757154464722, 1.1933085918426514, 1.3011093139648438, 1.0249671936035156, 1.2184412479400635, 1.0533424615859985, 1.0583370923995972, 1.0095666646957397, 1.0006382465362549, 1.2113995552062988, 1.0388730764389038, 1.007820963859558, 1.0879217386245728, 1.246010661125183, 1.1639950275421143, 1.040026307106018, 1.1130694150924683, 1.4576168060302734, 1.0971884727478027, 1.0087536573410034, 1.0822927951812744, 1.0242770910263062, 1.1688311100006104, 1.1636849641799927, 1.128406047821045, 1.0163336992263794, 1.116618037223816, 1.3271435499191284, 1.0118046998977661, 1.0844186544418335, 1.1373090744018555, 1.0483344793319702, 1.0031414031982422, 1.1767109632492065, 1.1003259420394897, 1.1236786842346191, 1.0306843519210815, 1.244544506072998, 1.0430941581726074, 1.3663814067840576, 1.063081979751587, 1.0006637573242188, 1.3851007223129272, 1.2951915264129639, 1.5380511283874512, 1.3932422399520874, 1.0713213682174683, 1.085714340209961, 1.0187331438064575, 1.0520915985107422]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7448441982269287] ms
 --  Average per query NF    [1.3608086109161377] ms
 --  Average per query vegas [2.384035587310791] ms
Mean [1.149]  Median [1.119]  95th [1.393]  99th [1.500]  max [1.728]
Mean [1.149]  Median [1.119]  95th [1.393]  99th [1.500]  max [1.728]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.879267 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=valueskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
ValueSample - START
ValueSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[3.5762787e-07 0.0000000e+00 5.9604645e-08 1.7881393e-07 8.9221001e-03]
Distance score: 0.0017845391994342208
SAUCE Drift detection: True
Detection latency: 0.0233s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.054314 | Model-update-time: 2.223250


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=valueskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.173327684402466
tensor(0.9959)
result is  tensor(456733.8125)
Enter testHyper
ReportEsts: [1.0314068794250488, 1.1146713495254517, 1.2942073345184326, 1.7227704524993896, 1.0829625129699707, 3.353187084197998, 1.311306118965149, 1.0440802574157715, 1.4415957927703857, 1.0041477680206299, 1.106946587562561, 1.5365933179855347, 1.078758955001831, 1.2063924074172974, 1.189569354057312, 1.5553090572357178, 1.4203448295593262, 1.1017760038375854, 1.0908491611480713, 1.8269926309585571, 1.1807092428207397, 1.8156399726867676, 3.4116358757019043, 1.0347565412521362, 1.04647696018219, 1.4606568813323975, 1.299384355545044, 1.4811040163040161, 34.78260803222656, 1.1510554552078247, 1.571095585823059, 1.381355881690979, 1.2265750169754028, 85.15037536621094, 1.0215115547180176, 1.0808900594711304, 1.0614746809005737, 1.1618460416793823, 1.2662386894226074, 1.0577657222747803, 1.0422041416168213, 1.2081736326217651, 60.378379821777344, 1.071989893913269, 1.2383719682693481, 1.0613176822662354, 1.37361478805542, 1.1966496706008911, 1.2809523344039917, 1.1202641725540161, 1.086961269378662, 1.2925513982772827, 1.0216381549835205, 1.1142642498016357, 1.0976921319961548, 1.062849521636963, 1.188233733177185, 1.1027581691741943, 1.259556770324707, 1.1309562921524048, 1.0872211456298828, 1.043581247329712, 1.0053783655166626, 1.3317244052886963, 1.1219054460525513, 1.0388658046722412, 1.3912651538848877, 1.802681803703308, 1.1944589614868164, 1.0990031957626343, 1.106105923652649, 1.314315676689148, 1.0651992559432983, 1.1518512964248657, 1.2618672847747803, 1.0173418521881104, 1.165961742401123, 1.0393515825271606, 1.2197068929672241, 1.0601820945739746, 1.4530816078186035, 1.0273187160491943, 1.308256983757019, 1.1738485097885132, 1.1113216876983643, 1.621276617050171, 1.208853006362915, 1.4145879745483398, 1.002575397491455, 1.7512784004211426, 1.0326443910598755, 1.0645331144332886, 1.1073580980300903, 1.598874568939209, 1.1330918073654175, 1.0537935495376587, 1.2197030782699585, 1.1715351343154907, 3.0, 1.9539906978607178, 1.3405272960662842, 1.1083241701126099, 1.2363183498382568, 1.3595095872879028, 1.151265263557434, 1.0330636501312256, 1.1486902236938477, 1.1158448457717896, 1.0855615139007568, 1.202006459236145, 1.041469693183899, 1.1030769348144531, 1.1076748371124268, 1.3086564540863037, 1.1075794696807861, 1.0346746444702148, 1.2973390817642212, 1.2326594591140747, 3.5564441680908203, 1.1061947345733643, 1.003777265548706, 1.1190965175628662, 1.0161571502685547, 1.793576717376709, 1.1184076070785522, 1.377173662185669, 1.2161344289779663, 1.27839994430542, 1.3586844205856323, 1.2133914232254028, 1.0059434175491333, 1.2478469610214233, 1.0314667224884033, 1.3353534936904907, 1.7062256336212158, 1.2797422409057617, 1.2401975393295288, 1.07902991771698, 1.0854358673095703, 1.0066064596176147, 1.1783785820007324, 1.1609511375427246, 1.0053662061691284, 1.8222941160202026, 1.0242048501968384, 1.0039805173873901, 1.3439490795135498, 1.1550947427749634, 1.104701280593872, 1.3588935136795044, 1.044256567955017, 1.0813111066818237, 1.2865053415298462, 1.2021702527999878, 1.0055639743804932, 1.042018175125122, 1.252661108970642, 1.3253967761993408, 7.2842302322387695, 1.1555466651916504, 1.0325801372528076, 1.3637820482254028, 2.783154010772705, 1.1676841974258423, 1.2583662271499634, 33.289703369140625, 1.2916135787963867, 1.1215258836746216, 1.0203883647918701, 1.1417206525802612, 1.1101411581039429, 1.0894023180007935, 1.077704668045044, 1.6594862937927246, 1.033716082572937, 1.2636935710906982, 1.1728862524032593, 1.3162559270858765, 1.1498594284057617, 1.4252548217773438, 1.8684210777282715, 1.159993290901184, 1.0931897163391113, 1.6058212518692017, 1.024802803993225, 1.3054547309875488, 2.078740119934082, 1.007827877998352, 1.1870510578155518, 1.058133840560913, 1.0074986219406128, 1.0208990573883057, 1.1228440999984741, 1.5594855546951294, 1.115525245666504, 4.056716442108154, 1.3668510913848877, 1.2929308414459229, 1.1453287601470947, 1.2098371982574463]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.698132038116455] ms
 --  Average per query NF    [1.3555967807769775] ms
 --  Average per query vegas [2.3425352573394775] ms
Mean [2.357]  Median [1.167]  95th [2.794]  99th [35.039]  max [85.150]
Mean [2.357]  Median [1.167]  95th [2.794]  99th [35.039]  max [85.150]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.381485 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.609351