Input arguments = Namespace(data_update='sample', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 55, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.202532291412354
tensor(0.9926)
result is  tensor(379337.1562)
Enter testHyper
ReportEsts: [1.1296502351760864, 1.041416883468628, 1.4276072978973389, 1.0271636247634888, 1.2212008237838745, 1.0869420766830444, 1.2234644889831543, 1.031188726425171, 1.0338011980056763, 1.0410871505737305, 1.2041343450546265, 1.0633474588394165, 1.1053744554519653, 1.0401785373687744, 1.129625916481018, 1.3141698837280273, 1.4103987216949463, 1.0789786577224731, 1.1311695575714111, 1.1147959232330322, 1.041115641593933, 1.0934462547302246, 1.1291404962539673, 1.0427600145339966, 1.1174548864364624, 1.1672694683074951, 1.0382882356643677, 1.5942744016647339, 1.0148534774780273, 1.0056260824203491, 1.1543099880218506, 1.1719473600387573, 1.0931119918823242, 1.0703250169754028, 1.1377861499786377, 1.0905983448028564, 1.29258131980896, 1.0259573459625244, 1.0176793336868286, 1.0976731777191162, 1.0380758047103882, 1.206579566001892, 1.0113813877105713, 1.1233091354370117, 1.1210649013519287, 1.0680272579193115, 1.1352380514144897, 1.2423487901687622, 1.0803613662719727, 1.162436604499817, 1.1135265827178955, 1.3606716394424438, 1.059569239616394, 1.162893295288086, 1.0689797401428223, 1.0864627361297607, 1.2728972434997559, 1.0960460901260376, 1.1119519472122192, 1.3992443084716797, 1.1162354946136475, 1.1843581199645996, 1.2863190174102783, 1.1082885265350342, 1.325301170349121, 1.2571429014205933, 1.1920151710510254, 1.030970573425293, 1.0411081314086914, 1.399999976158142, 1.054706335067749, 1.0336967706680298, 1.343264102935791, 1.1749238967895508, 1.1140599250793457, 1.2856011390686035, 1.9444762468338013, 1.0469032526016235, 1.1789729595184326, 1.2395764589309692, 1.1076161861419678, 1.119205355644226, 1.1281099319458008, 1.1894007921218872, 1.2540364265441895, 1.074007272720337, 1.0727384090423584, 1.0174022912979126, 1.0853618383407593, 1.07525634765625, 1.014391541481018, 1.1828285455703735, 1.0277984142303467, 1.3434220552444458, 1.1142857074737549, 1.1709092855453491, 1.2839617729187012, 1.2356348037719727, 1.0, 1.2139313220977783, 1.1082544326782227, 1.246589183807373, 1.0397279262542725, 1.0095168352127075, 1.2213388681411743, 1.0218831300735474, 1.2645539045333862, 1.1780104637145996, 1.033970594406128, 1.022122859954834, 1.0758956670761108, 1.0549055337905884, 1.090194821357727, 1.0511162281036377, 1.0782427787780762, 1.0509259700775146, 1.0171525478363037, 1.0038694143295288, 1.1880472898483276, 1.034680962562561, 1.2013022899627686, 1.150338053703308, 1.0934187173843384, 1.0917857885360718, 1.2325581312179565, 1.171378493309021, 1.1406006813049316, 1.0219806432724, 1.264320731163025, 1.16265869140625, 1.1549147367477417, 1.1898460388183594, 1.1068986654281616, 1.4285714626312256, 1.18906569480896, 1.0396429300308228, 1.1813015937805176, 1.083577275276184, 1.130653738975525, 1.1823238134384155, 1.0449001789093018, 1.1066862344741821, 1.1844499111175537, 1.3537018299102783, 1.0548728704452515, 1.1399973630905151, 1.1020783185958862, 1.2608968019485474, 1.1904059648513794, 1.195880651473999, 1.1116746664047241, 1.1868990659713745, 1.3503289222717285, 1.0641179084777832, 1.1513301134109497, 1.04032301902771, 1.2539466619491577, 1.0267304182052612, 1.0866888761520386, 1.2217845916748047, 1.1870942115783691, 1.1622579097747803, 1.071711778640747, 1.310489535331726, 1.1889169216156006, 1.0958000421524048, 1.188754916191101, 1.2614706754684448, 1.0249791145324707, 1.0749561786651611, 1.1218281984329224, 1.1456354856491089, 1.1818181276321411, 1.3907372951507568, 1.049386978149414, 1.1717272996902466, 1.039919137954712, 1.253572940826416, 1.2158795595169067, 1.044685959815979, 1.0542564392089844, 1.04795503616333, 1.0350004434585571, 1.1317671537399292, 1.1151756048202515, 1.1173361539840698, 1.0123172998428345, 1.3609848022460938, 1.05494225025177, 1.3149961233139038, 1.0674147605895996, 1.0064383745193481, 1.5724518299102783, 1.5720974206924438, 1.7711125612258911, 1.0869321823120117, 1.1349729299545288, 1.1692308187484741, 1.269482970237732, 1.0299800634384155]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [4.5915281772613525] ms
 --  Average per query NF    [1.4902877807617188] ms
 --  Average per query vegas [3.101240396499634] ms
Mean [1.152]  Median [1.118]  95th [1.391]  99th [1.596]  max [1.944]
Mean [1.152]  Median [1.118]  95th [1.391]  99th [1.596]  max [1.944]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 12.051986 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=sample', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
Sample - START
Sample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[4.8875809e-06 6.4373016e-06 6.5565109e-07 1.4901161e-06 5.3644180e-07]
Distance score: 2.8014183044433594e-06
SAUCE Drift detection: False
Detection latency: 0.0233s

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.020684 | Model-update-time: 0.000000


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=sample', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.166418313980103
tensor(0.9953)
result is  tensor(456457.9688)
Enter testHyper
ReportEsts: [1.2818611860275269, 1.0482144355773926, 1.2091690301895142, 1.473811149597168, 1.009078025817871, 1.2808287143707275, 1.1687506437301636, 1.0203075408935547, 1.117639422416687, 1.0948282480239868, 1.0035736560821533, 1.2464033365249634, 1.1933174133300781, 1.113623023033142, 1.054649829864502, 1.0391618013381958, 1.802247166633606, 1.1375852823257446, 1.0824661254882812, 1.328098177909851, 1.0347518920898438, 1.050898551940918, 1.114702820777893, 1.09518563747406, 1.3198119401931763, 1.1787954568862915, 1.0552343130111694, 1.1338990926742554, 1.180760383605957, 1.4736394882202148, 1.028780460357666, 1.2605633735656738, 1.1433991193771362, 1.094680905342102, 1.0341311693191528, 1.0767751932144165, 1.1058943271636963, 1.2457393407821655, 1.326977014541626, 1.1949878931045532, 1.0205281972885132, 1.0484580993652344, 1.367233395576477, 1.1152846813201904, 1.043869137763977, 1.1858464479446411, 1.336027979850769, 1.0166529417037964, 1.0039682388305664, 1.1153124570846558, 1.007793664932251, 1.0212211608886719, 1.0575602054595947, 1.0663821697235107, 1.0370335578918457, 1.373340368270874, 1.1549251079559326, 1.2660847902297974, 1.2439758777618408, 1.0079679489135742, 1.3081632852554321, 1.0070360898971558, 1.1296296119689941, 1.075925350189209, 1.131472110748291, 1.0201996564865112, 1.3125425577163696, 1.01616370677948, 1.1480892896652222, 1.0939786434173584, 1.1622793674468994, 1.070700764656067, 1.1585208177566528, 1.077640414237976, 1.052175760269165, 1.056130290031433, 1.118463158607483, 1.13699471950531, 1.3455262184143066, 1.1391669511795044, 1.1738637685775757, 1.0658682584762573, 1.0968538522720337, 1.1731144189834595, 1.2976107597351074, 1.2659574747085571, 1.2216310501098633, 1.5158597230911255, 1.0303590297698975, 1.1208933591842651, 1.127603530883789, 1.071513295173645, 1.3514395952224731, 1.0534124374389648, 1.2281373739242554, 1.048615574836731, 1.047413945198059, 1.1744308471679688, 1.227053165435791, 1.7168978452682495, 1.0487183332443237, 1.1100777387619019, 1.2894736528396606, 1.1836074590682983, 1.0764507055282593, 1.0484769344329834, 1.0652179718017578, 1.0846843719482422, 1.2536872625350952, 1.128176212310791, 1.0890816450119019, 1.0312515497207642, 1.146875023841858, 1.1677032709121704, 1.0574760437011719, 1.2337292432785034, 1.0519553422927856, 1.1526622772216797, 1.3452177047729492, 1.0240000486373901, 1.1870919466018677, 1.1414709091186523, 1.0350055694580078, 1.2859691381454468, 1.0088077783584595, 1.0858912467956543, 1.3166446685791016, 1.229938268661499, 1.0926650762557983, 1.1274110078811646, 1.2382837533950806, 1.131729245185852, 1.1297252178192139, 1.8413069248199463, 1.7257752418518066, 1.0441609621047974, 1.0233373641967773, 1.0317679643630981, 1.092885136604309, 1.0357577800750732, 1.0445135831832886, 1.1709071397781372, 1.0294759273529053, 1.0250698328018188, 1.0010569095611572, 1.1276823282241821, 1.5714285373687744, 1.0249378681182861, 1.1727522611618042, 1.1189348697662354, 1.0707937479019165, 1.0831502676010132, 1.0803471803665161, 1.1338878870010376, 1.0410206317901611, 1.017265796661377, 1.1604888439178467, 1.3278688192367554, 1.0324985980987549, 1.1556780338287354, 1.008552074432373, 1.2946486473083496, 1.2412028312683105, 1.0920941829681396, 1.0547404289245605, 1.126361608505249, 1.0614598989486694, 1.0402476787567139, 1.215653657913208, 1.3533217906951904, 1.0859345197677612, 1.1301757097244263, 1.7149720191955566, 1.0549312829971313, 1.0014437437057495, 1.071593999862671, 1.7403041124343872, 1.0071609020233154, 1.0152381658554077, 1.1293656826019287, 1.6956521272659302, 1.1366480588912964, 1.0365076065063477, 1.4186991453170776, 1.2526270151138306, 1.647711157798767, 1.3125, 1.029778003692627, 1.187131404876709, 1.06387197971344, 1.2528321743011475, 1.0230910778045654, 1.381137490272522, 2.1744000911712646, 1.0323489904403687, 1.6620689630508423, 1.1694444417953491, 1.182331919670105, 1.3136593103408813, 1.2098597288131714]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7665343284606934] ms
 --  Average per query NF    [1.3598895072937012] ms
 --  Average per query vegas [2.406644821166992] ms
Mean [1.172]  Median [1.127]  95th [1.575]  99th [1.803]  max [2.174]
Mean [1.172]  Median [1.127]  95th [1.575]  99th [1.803]  max [2.174]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.219305 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=0 | total-time=26.350898