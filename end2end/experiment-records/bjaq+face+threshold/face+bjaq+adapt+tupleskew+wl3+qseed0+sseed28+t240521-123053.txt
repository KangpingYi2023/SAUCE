Input arguments = Namespace(data_update='tupleskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 28, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.16694951057434
tensor(0.9960)
result is  tensor(380621.9375)
Enter testHyper
ReportEsts: [1.1227924823760986, 1.0513795614242554, 1.222300410270691, 1.1452937126159668, 1.3092085123062134, 1.0928350687026978, 1.1360502243041992, 1.1187957525253296, 1.0731489658355713, 1.1917681694030762, 1.0947458744049072, 1.209110140800476, 1.016944169998169, 1.0067415237426758, 1.355978012084961, 1.4501745700836182, 1.302093744277954, 1.10154390335083, 1.0793492794036865, 1.0204081535339355, 1.029096245765686, 1.0228601694107056, 1.172143578529358, 1.171205997467041, 1.0413297414779663, 1.1437612771987915, 1.0236486196517944, 1.469517707824707, 1.006318211555481, 1.1187061071395874, 1.1734657287597656, 1.0743966102600098, 1.0905373096466064, 1.0373598337173462, 1.1900016069412231, 1.171358585357666, 1.2446465492248535, 1.2451115846633911, 1.0426816940307617, 1.0589221715927124, 1.0252596139907837, 1.0754716396331787, 1.004751443862915, 1.0882008075714111, 1.0904289484024048, 1.0362812280654907, 1.0806890726089478, 1.230525255203247, 1.0017030239105225, 1.1049069166183472, 1.2595628499984741, 1.260921597480774, 1.0651288032531738, 1.22559654712677, 1.1596370935440063, 1.0483596324920654, 1.3738317489624023, 1.1439505815505981, 1.3188189268112183, 1.4134860038757324, 1.247308611869812, 1.2204715013504028, 1.3584109544754028, 1.1650090217590332, 1.2043795585632324, 1.2857142686843872, 1.1256732940673828, 1.0011117458343506, 1.2135862112045288, 1.1789473295211792, 1.0321801900863647, 1.1072643995285034, 1.2899940013885498, 1.2083821296691895, 1.1876742839813232, 1.112847924232483, 1.9973808526992798, 1.0946203470230103, 1.0830210447311401, 1.4596351385116577, 1.2725802659988403, 1.1196898221969604, 1.0822006464004517, 1.3048615455627441, 1.2229840755462646, 1.1424176692962646, 1.2278785705566406, 1.0130819082260132, 1.0028064250946045, 1.118417739868164, 1.0322473049163818, 1.4657162427902222, 1.0003606081008911, 1.399796485900879, 1.0955055952072144, 1.039573073387146, 1.1110762357711792, 1.2706538438796997, 1.034482717514038, 1.1717067956924438, 1.2044117450714111, 1.1207002401351929, 1.0367268323898315, 1.012445092201233, 1.1928870677947998, 1.0286104679107666, 1.1493213176727295, 1.169284462928772, 1.1002224683761597, 1.05978524684906, 1.1751446723937988, 1.089219331741333, 1.2640407085418701, 1.0472475290298462, 1.073258399963379, 1.164102554321289, 1.0294389724731445, 1.0078679323196411, 1.1792612075805664, 1.0163744688034058, 1.2087233066558838, 1.1161860227584839, 1.0500767230987549, 1.1571468114852905, 1.2160853147506714, 1.2116178274154663, 1.1843382120132446, 1.1049174070358276, 1.301600694656372, 1.1242485046386719, 1.1611276865005493, 1.085821270942688, 1.1628340482711792, 1.4285714626312256, 1.0946331024169922, 1.0853242874145508, 1.0191130638122559, 1.0419511795043945, 1.081925392150879, 1.1845201253890991, 1.2123051881790161, 1.1123099327087402, 1.2574715614318848, 1.1515697240829468, 1.0452111959457397, 1.037432312965393, 1.0694632530212402, 1.4008363485336304, 1.0274056196212769, 1.0696732997894287, 1.2638803720474243, 1.1595948934555054, 1.3073248863220215, 1.0808238983154297, 1.2032886743545532, 1.0786809921264648, 1.0303666591644287, 1.013224482536316, 1.121694803237915, 1.118293046951294, 1.3356544971466064, 1.0216020345687866, 1.0354154109954834, 1.3215796947479248, 1.2967033386230469, 1.1106420755386353, 1.2813619375228882, 1.3675768375396729, 1.038650393486023, 1.065321445465088, 1.1081461906433105, 1.1479673385620117, 1.1298701763153076, 1.161790132522583, 1.1049046516418457, 1.032839298248291, 1.013293981552124, 1.2554759979248047, 1.1015918254852295, 1.1513314247131348, 1.0096627473831177, 1.048323631286621, 1.0066759586334229, 1.2104188203811646, 1.0851141214370728, 1.1014798879623413, 1.0790557861328125, 1.2660324573516846, 1.0337809324264526, 1.3949884176254272, 1.024762749671936, 1.0627025365829468, 1.59441339969635, 1.3158307075500488, 1.6651787757873535, 1.209737777709961, 1.1015839576721191, 1.1875, 1.0754175186157227, 1.123240351676941]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7885236740112305] ms
 --  Average per query NF    [1.370539665222168] ms
 --  Average per query vegas [2.4179840087890625] ms
Mean [1.155]  Median [1.119]  95th [1.400]  99th [1.595]  max [1.997]
Mean [1.155]  Median [1.119]  95th [1.400]  99th [1.595]  max [1.997]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.865970 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=tupleskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
TupleSkewSample - START
0.001
TupleSkewSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[8.9168549e-05 2.3186207e-05 6.3002110e-05 1.0728836e-04 4.6074390e-05]
Distance score: 6.574392318725586e-05
SAUCE Drift detection: True
Detection latency: 0.0231s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.003310 | Model-update-time: 2.243601


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=tupleskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.205551385879517
tensor(0.9927)
result is  tensor(455247.1875)
Enter testHyper
ReportEsts: [1.0579380989074707, 1.0471537113189697, 1.2071330547332764, 1.099955677986145, 1.069832682609558, 1.1597490310668945, 1.277863621711731, 1.0523139238357544, 1.6737366914749146, 1.0667469501495361, 1.0567206144332886, 1.0340378284454346, 1.5204819440841675, 1.0880544185638428, 1.0664132833480835, 1.0124720335006714, 1.01773202419281, 1.090714693069458, 1.0433813333511353, 1.2441426515579224, 1.1423906087875366, 1.0510379076004028, 1.2634615898132324, 1.1597645282745361, 1.1937347650527954, 1.1497451066970825, 1.1383335590362549, 1.192346453666687, 1.2684006690979004, 1.841791033744812, 1.1546831130981445, 1.508474588394165, 1.1111825704574585, 1.5599688291549683, 1.0380423069000244, 1.0928475856781006, 1.0118954181671143, 1.0813207626342773, 1.1099727153778076, 1.0726099014282227, 1.0499851703643799, 1.234993577003479, 1.0272655487060547, 1.0063098669052124, 1.027092456817627, 1.1007930040359497, 1.504468560218811, 1.0857820510864258, 1.2523809671401978, 1.192661166191101, 1.0085322856903076, 1.0392824411392212, 1.1148829460144043, 1.0177621841430664, 1.1570059061050415, 1.2659894227981567, 1.2226049900054932, 1.0722906589508057, 1.2538268566131592, 1.1466635465621948, 1.4896694421768188, 1.0373215675354004, 1.1909722089767456, 1.0845983028411865, 1.0626024007797241, 1.0348721742630005, 1.2019635438919067, 1.040526032447815, 1.1625404357910156, 1.1499868631362915, 1.098961353302002, 1.1452467441558838, 1.098685622215271, 1.1731654405593872, 1.0303131341934204, 1.0523931980133057, 1.2675681114196777, 1.138818621635437, 1.3554832935333252, 1.1849554777145386, 1.434017539024353, 1.0685641765594482, 1.0346026420593262, 1.3508718013763428, 1.3871675729751587, 1.6170213222503662, 1.2952697277069092, 1.7731847763061523, 1.2204318046569824, 1.0088601112365723, 1.0142565965652466, 1.2701425552368164, 1.5183603763580322, 1.030654788017273, 1.1994366645812988, 1.0596270561218262, 1.2008533477783203, 1.1346044540405273, 2.048076868057251, 1.3712918758392334, 1.0932188034057617, 1.1947124004364014, 1.0303030014038086, 1.1674928665161133, 1.1497465372085571, 1.0962398052215576, 1.068542718887329, 1.0028910636901855, 1.0200573205947876, 1.0304288864135742, 1.0885357856750488, 1.0071269273757935, 1.1800981760025024, 1.3238003253936768, 1.3201204538345337, 1.0816709995269775, 1.0638518333435059, 1.1145085096359253, 1.2541377544403076, 1.0, 1.0412184000015259, 1.0268346071243286, 1.1257078647613525, 1.0397813320159912, 1.1343696117401123, 1.043254017829895, 1.249191403388977, 1.3395931720733643, 1.0962787866592407, 1.1048917770385742, 1.3123393058776855, 1.1141830682754517, 1.0052571296691895, 1.4686156511306763, 1.3481818437576294, 1.1341952085494995, 1.0644093751907349, 1.0617094039916992, 1.099111557006836, 1.0403465032577515, 1.0538417100906372, 1.1226917505264282, 1.0282384157180786, 1.013176441192627, 1.0070836544036865, 1.0506504774093628, 1.2126436233520508, 1.0731139183044434, 1.1654856204986572, 1.1648786067962646, 1.0510632991790771, 1.1009321212768555, 1.1337637901306152, 1.0136054754257202, 1.0076755285263062, 1.460499882698059, 1.1746547222137451, 1.0378787517547607, 1.1068851947784424, 1.090165615081787, 1.182513952255249, 1.3107142448425293, 1.446052074432373, 1.0619443655014038, 1.1556077003479004, 1.0717601776123047, 1.2321600914001465, 1.231170654296875, 1.74643874168396, 1.2125141620635986, 1.103165864944458, 1.1278084516525269, 1.2165992259979248, 1.242605447769165, 1.2100712060928345, 1.0747601985931396, 1.1047923564910889, 1.0187561511993408, 1.0979520082473755, 1.142267107963562, 1.8157894611358643, 1.0412505865097046, 1.1463754177093506, 1.4605833292007446, 1.4433579444885254, 1.00111985206604, 1.5040816068649292, 1.0652122497558594, 1.442224383354187, 1.0304979085922241, 1.1895205974578857, 1.039477825164795, 1.1719340085983276, 1.6604448556900024, 1.014922857284546, 1.0114715099334717, 1.3359898328781128, 1.0133869647979736, 1.3090062141418457, 1.0095367431640625]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.709409236907959] ms
 --  Average per query NF    [1.3576710224151611] ms
 --  Average per query vegas [2.351738214492798] ms
Mean [1.174]  Median [1.114]  95th [1.518]  99th [1.816]  max [2.048]
Mean [1.174]  Median [1.114]  95th [1.518]  99th [1.816]  max [2.048]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.386444 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.553226