Input arguments = Namespace(data_update='valueskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 19, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.163233757019043
tensor(0.9958)
result is  tensor(380574.4688)
Enter testHyper
ReportEsts: [1.163236141204834, 1.1153076887130737, 1.4289770126342773, 1.1994104385375977, 1.2118016481399536, 1.1504082679748535, 1.2383248805999756, 1.1616721153259277, 1.0893449783325195, 1.1680461168289185, 1.0844099521636963, 1.0436440706253052, 1.0320245027542114, 1.0178571939468384, 1.1337171792984009, 1.3267232179641724, 1.1481164693832397, 1.2013064622879028, 1.0962458848953247, 1.0637755393981934, 1.3052537441253662, 1.0877071619033813, 1.1114320755004883, 1.0655395984649658, 1.2752593755722046, 1.2432187795639038, 1.0760135650634766, 1.363444447517395, 1.0301231145858765, 1.0845285654067993, 1.1585668325424194, 1.0670831203460693, 1.2208638191223145, 1.0579246282577515, 1.1234146356582642, 1.1171568632125854, 1.4676501750946045, 1.0647047758102417, 1.0535025596618652, 1.0547305345535278, 1.0799493789672852, 1.294508934020996, 1.0123904943466187, 1.0418312549591064, 1.107965350151062, 1.2460317611694336, 1.1835181713104248, 1.275950312614441, 1.006046175956726, 1.0423011779785156, 1.152500033378601, 1.3659642934799194, 1.036900281906128, 1.0563567876815796, 1.093779444694519, 1.031293511390686, 1.1514018774032593, 1.2716336250305176, 1.3475905656814575, 1.3472110033035278, 1.387250542640686, 1.193151593208313, 1.3770519495010376, 1.1423455476760864, 1.1578947305679321, 1.085714340209961, 1.0894874334335327, 1.0680139064788818, 1.148998498916626, 1.2000000476837158, 1.1715363264083862, 1.0344932079315186, 1.2353700399398804, 1.2414549589157104, 1.1247612237930298, 1.2966927289962769, 2.022571086883545, 1.0117626190185547, 1.1083496809005737, 1.4136543273925781, 1.0537611246109009, 1.1263123750686646, 1.0322978496551514, 1.221567153930664, 1.1827336549758911, 1.1114436388015747, 1.1226048469543457, 1.14007568359375, 1.0262417793273926, 1.0535699129104614, 1.049163579940796, 1.4221322536468506, 1.0064911842346191, 1.3463796377182007, 1.048387050628662, 1.0631961822509766, 1.263566255569458, 1.4190566539764404, 1.0166666507720947, 1.1578503847122192, 1.06640625, 1.0724724531173706, 1.0186687707901, 1.010354995727539, 1.0438284873962402, 1.042832612991333, 1.1533340215682983, 1.2198952436447144, 1.0415717363357544, 1.0144826173782349, 1.0929960012435913, 1.1151283979415894, 1.1748802661895752, 1.0423762798309326, 1.0155326128005981, 1.0365296602249146, 1.0170862674713135, 1.1254998445510864, 1.2234059572219849, 1.1845626831054688, 1.1642625331878662, 1.1290879249572754, 1.2112421989440918, 1.1896255016326904, 1.3745155334472656, 1.1945934295654297, 1.1486072540283203, 1.2781721353530884, 1.1435973644256592, 1.1015363931655884, 1.1519254446029663, 1.2082394361495972, 1.1942200660705566, 1.5357142686843872, 1.0891858339309692, 1.1609346866607666, 1.0909430980682373, 1.0747967958450317, 1.048659086227417, 1.244632363319397, 1.163671612739563, 1.2162586450576782, 1.1827458143234253, 1.3396198749542236, 1.054419994354248, 1.022418737411499, 1.1137018203735352, 1.620746374130249, 1.0989717245101929, 1.100994348526001, 1.2000824213027954, 1.1571593284606934, 1.2990506887435913, 1.0526741743087769, 1.235170602798462, 1.0112123489379883, 1.051397681236267, 1.0095666646957397, 1.040117859840393, 1.1450910568237305, 1.0402328968048096, 1.0061187744140625, 1.000264286994934, 1.2628031969070435, 1.0678733587265015, 1.102689504623413, 1.0087860822677612, 1.3806265592575073, 1.128097414970398, 1.0504835844039917, 1.0198830366134644, 1.0426795482635498, 1.1168831586837769, 1.175667405128479, 1.1301089525222778, 1.192152976989746, 1.0436105728149414, 1.2568389177322388, 1.1959750652313232, 1.0896642208099365, 1.0867167711257935, 1.0218908786773682, 1.0138201713562012, 1.2175689935684204, 1.1590003967285156, 1.1025370359420776, 1.0813511610031128, 1.2832143306732178, 1.101912260055542, 1.3246021270751953, 1.0421085357666016, 1.0232645273208618, 1.6364679336547852, 1.2443181276321411, 1.6414742469787598, 1.1781154870986938, 1.2536057233810425, 1.1875, 1.0093127489089966, 1.000232458114624]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7587833404541016] ms
 --  Average per query NF    [1.3628840446472168] ms
 --  Average per query vegas [2.3958992958068848] ms
Mean [1.156]  Median [1.125]  95th [1.389]  99th [1.637]  max [2.023]
Mean [1.156]  Median [1.125]  95th [1.389]  99th [1.637]  max [2.023]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.844784 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=valueskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
ValueSample - START
ValueSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[ 6.5565109e-07  2.3841858e-07  9.3305707e-03  5.9604645e-08
 -2.9802322e-08]
Distance score: 0.0018662989605218172
SAUCE Drift detection: True
Detection latency: 0.0233s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.048397 | Model-update-time: 2.227589


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=valueskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.169764280319214
tensor(0.9945)
result is  tensor(456064.7500)
Enter testHyper
ReportEsts: [1.9708095788955688, 1.3012115955352783, 1.0056657791137695, 1.1752336025238037, 1.0756776332855225, 1.2420353889465332, 1.0527629852294922, 1.2545127868652344, 1.0022995471954346, 1.033349871635437, 2.3612442016601562, 1.4515938758850098, 1.0502091646194458, 1.54756760597229, 1.205572485923767, 1.0545965433120728, 1.0615166425704956, 1.3115973472595215, 1.0377683639526367, 1.059730052947998, 1.2374194860458374, 1.081299901008606, 1.6304004192352295, 1.3318464756011963, 1.3197849988937378, 1.0412102937698364, 1.0143566131591797, 1.5042158365249634, 1.4045122861862183, 1.3351647853851318, 1.1195122003555298, 1.6610169410705566, 1.010741114616394, 14.921137809753418, 1.1463145017623901, 1.0985734462738037, 1.045182704925537, 1.1039921045303345, 1.1809086799621582, 1.0932458639144897, 1.0514520406723022, 1.1005181074142456, 1.150942087173462, 1.0054069757461548, 1.016312599182129, 1.1009440422058105, 1.3210965394973755, 1.230543851852417, 1.1195218563079834, 1.117986798286438, 1.2080457210540771, 1.0236470699310303, 1.0875424146652222, 1.123464584350586, 1.136249303817749, 3.111121892929077, 1.1959967613220215, 1.048387050628662, 1.237386703491211, 1.2659883499145508, 1.175438642501831, 1.2441422939300537, 1.507694125175476, 1.5078095197677612, 1.0672599077224731, 1.2437987327575684, 1.1096700429916382, 1.105796456336975, 1.0327584743499756, 1.0352654457092285, 1.2879496812820435, 1.282570719718933, 1.1644701957702637, 1.1448918581008911, 1.2645108699798584, 1.5944361686706543, 24.56989288330078, 1.1337569952011108, 1.152578353881836, 1.0813533067703247, 1.5574795007705688, 2.1811318397521973, 1.0607072114944458, 1.0798290967941284, 1.3387173414230347, 1.3394160270690918, 1.4447492361068726, 1.5441683530807495, 2.3728389739990234, 1.0082837343215942, 1.1378772258758545, 1.0742199420928955, 1.4481605291366577, 1.0949254035949707, 1.1468392610549927, 1.0298434495925903, 1.7724679708480835, 1.2137130498886108, 1.076181173324585, 1.096067190170288, 1.1576038599014282, 1.100489616394043, 1.0124069452285767, 1.0190155506134033, 1.126261830329895, 3.0057122707366943, 1.2157397270202637, 1.1397266387939453, 1.0458452701568604, 1.034041404724121, 1.0376412868499756, 1.0064786672592163, 1.1073695421218872, 1.241140604019165, 1.1687551736831665, 1.1084729433059692, 1.0004013776779175, 1.392777681350708, 2.0208535194396973, 1.0796459913253784, 1.0838758945465088, 1.4841121435165405, 3.2055623531341553, 3.661026954650879, 1.1643733978271484, 1.061462640762329, 1.0195958614349365, 1.019667148590088, 1.1023586988449097, 1.251562476158142, 1.2757313251495361, 1.039809226989746, 1.1224159002304077, 2.705069065093994, 3.055447578430176, 1.33146071434021, 1.5787131786346436, 1.7887496948242188, 1.0788100957870483, 1.1509218215942383, 1.058594822883606, 1.0449174642562866, 1.0371453762054443, 1.331860899925232, 1.3784149885177612, 1.0599427223205566, 1.4912281036376953, 1.1577509641647339, 1.2774266004562378, 1.025017261505127, 15.394800186157227, 1.058764934539795, 1.0280722379684448, 1.0646724700927734, 1.0614274740219116, 1.3960034847259521, 1.1900197267532349, 1.330645203590393, 1.0160493850708008, 1.2866030931472778, 1.0919971466064453, 1.0858560800552368, 1.1929378509521484, 1.0010616779327393, 1.183637022972107, 1.0017050504684448, 1.2074942588806152, 1.058476448059082, 10.537142753601074, 1.4766390323638916, 1.028760313987732, 1.028114676475525, 1.5482709407806396, 1.0006521940231323, 1.0138850212097168, 1.1004023551940918, 2.024893283843994, 1.0543560981750488, 1.134297251701355, 1.2373061180114746, 1.1935484409332275, 1.256860375404358, 1.673747181892395, 1.3569769859313965, 1.2812774181365967, 1.8909616470336914, 1.3279547691345215, 1.0306624174118042, 1.2092128992080688, 1.1809759140014648, 1.2028120756149292, 1.3873119354248047, 1.499898910522461, 1.3256540298461914, 1.100778341293335, 1.2928208112716675, 1.576737880706787, 1.0546190738677979, 1.3460208177566528, 1.0410847663879395]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7263083457946777] ms
 --  Average per query NF    [1.359267234802246] ms
 --  Average per query vegas [2.3670411109924316] ms
Mean [1.585]  Median [1.155]  95th [2.389]  99th [14.926]  max [24.570]
Mean [1.585]  Median [1.155]  95th [2.389]  99th [14.926]  max [24.570]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.406695 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.581757