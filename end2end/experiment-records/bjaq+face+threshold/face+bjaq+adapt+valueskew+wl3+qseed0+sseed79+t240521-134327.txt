Input arguments = Namespace(data_update='valueskew', update_size=80000, dataset='bjaq', debug=False, drift_test='js', model_update='adapt', model='face', end2end=False, query_seed=0, random_seed=42, num_workload=3)
JSON-passed parameters = {'data_updater': {'skew_ratio': '1e-3'}, 'random_seed': 79, 'face': {'learning_rate': '1e-4', 'epochs': 0, 'factor': 'auto'}}
MODEL-PATH=/home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
DATASET-PATH=/home/kangping/code_copy/SAUCE/data/bjaq/end2end/bjaq.npy
Workloads: ['QueryWorkload', 'DataUpdateWorkload', 'QueryWorkload']

WORKLOAD-START | Type: QueryWorkload | Progress: 1/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--end2end']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (382168, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-1234.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.155622720718384
tensor(0.9922)
result is  tensor(379182.7500)
Enter testHyper
ReportEsts: [1.1743146181106567, 1.0418694019317627, 1.501450538635254, 1.1770899295806885, 1.269713282585144, 1.1196377277374268, 1.2002125978469849, 1.220689296722412, 1.0463902950286865, 1.0293067693710327, 1.1412575244903564, 1.177754282951355, 1.0110892057418823, 1.0535714626312256, 1.0502322912216187, 1.3109650611877441, 1.2916786670684814, 1.2152018547058105, 1.1560684442520142, 1.1556122303009033, 1.0966334342956543, 1.0934462547302246, 1.0869828462600708, 1.0254865884780884, 1.0967899560928345, 1.1030741930007935, 1.0641891956329346, 1.4019097089767456, 1.0163894891738892, 1.1211473941802979, 1.0769776105880737, 1.1077733039855957, 1.083346962928772, 1.0571516752243042, 1.1483280658721924, 1.0235902070999146, 1.3272470235824585, 1.0906989574432373, 1.1384406089782715, 1.0815569162368774, 1.0087426900863647, 1.2123850584030151, 1.2123265266418457, 1.0578231811523438, 1.0900063514709473, 1.0340136289596558, 1.0692980289459229, 1.2532758712768555, 1.0607306957244873, 1.1421319246292114, 1.188144326210022, 1.3611111640930176, 1.0450531244277954, 1.2672220468521118, 1.1932728290557861, 1.0343068838119507, 1.3102803230285645, 1.20375657081604, 1.137427806854248, 1.529600739479065, 1.2353028059005737, 1.0961010456085205, 1.3242887258529663, 1.1175403594970703, 1.2595419883728027, 1.0285714864730835, 1.202301025390625, 1.0172992944717407, 1.0064117908477783, 1.221052646636963, 1.0113914012908936, 1.1034207344055176, 1.2013366222381592, 1.2242720127105713, 1.0852574110031128, 1.0061988830566406, 1.9848613739013672, 1.0273680686950684, 1.1879396438598633, 1.1506575345993042, 1.0771573781967163, 1.3291875123977661, 1.0207180976867676, 1.2451077699661255, 1.1928411722183228, 1.052599310874939, 1.0084830522537231, 1.1408827304840088, 1.0033079385757446, 1.0838377475738525, 1.0377919673919678, 1.281414270401001, 1.0191106796264648, 1.2720129489898682, 1.1142857074737549, 1.157209873199463, 1.0239288806915283, 1.176488995552063, 1.0714285373687744, 1.2448272705078125, 1.1422593593597412, 1.1273633241653442, 1.0467591285705566, 1.0022010803222656, 1.0114262104034424, 1.0243333578109741, 1.1745778322219849, 1.2233856916427612, 1.0617468357086182, 1.005065679550171, 1.1633061170578003, 1.0984067916870117, 1.284127950668335, 1.0061427354812622, 1.1570650339126587, 1.0758293867111206, 1.0290993452072144, 1.0014188289642334, 1.234742522239685, 1.058832049369812, 1.2308425903320312, 1.090313196182251, 1.1292924880981445, 1.2272447347640991, 1.246124029159546, 1.2194592952728271, 1.2129169702529907, 1.2907203435897827, 1.3216423988342285, 1.1002004146575928, 1.0623644590377808, 1.1775052547454834, 1.1609694957733154, 1.4285714626312256, 1.1145057678222656, 1.1614596843719482, 1.0571054220199585, 1.0386991500854492, 1.0574456453323364, 1.3605974912643433, 1.1450544595718384, 1.1179910898208618, 1.050165057182312, 1.3996403217315674, 1.0124298334121704, 1.0624926090240479, 1.1113077402114868, 1.4392346143722534, 1.1093769073486328, 1.170880675315857, 1.2072482109069824, 1.203179121017456, 1.3415032625198364, 1.1372486352920532, 1.2005349397659302, 1.161470890045166, 1.037039041519165, 1.0469893217086792, 1.0126042366027832, 1.0975230932235718, 1.1937263011932373, 1.0868186950683594, 1.0222007036209106, 1.2216427326202393, 1.3371105194091797, 1.079316258430481, 1.0647515058517456, 1.2391003370285034, 1.0633748769760132, 1.0006611347198486, 1.0657508373260498, 1.0676053762435913, 1.149350643157959, 1.2262163162231445, 1.019444465637207, 1.233313798904419, 1.0194363594055176, 1.262044906616211, 1.145511269569397, 1.0646613836288452, 1.1061211824417114, 1.030806541442871, 1.0725080966949463, 1.2165474891662598, 1.0905468463897705, 1.1353065967559814, 1.0481224060058594, 1.262917399406433, 1.0007164478302002, 1.428587555885315, 1.0152307748794556, 1.0730571746826172, 1.4234414100646973, 1.4845269918441772, 1.9121992588043213, 1.155635118484497, 1.1288453340530396, 1.1515151262283325, 1.0003304481506348, 1.0158365964889526]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7740015983581543] ms
 --  Average per query NF    [1.3576304912567139] ms
 --  Average per query vegas [2.4163711071014404] ms
Mean [1.150]  Median [1.119]  95th [1.400]  99th [1.533]  max [1.985]
Mean [1.150]  Median [1.119]  95th [1.400]  99th [1.533]  max [1.985]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 1/3 | Workload-time: 11.820359 | Model-update-time: 0.000000


WORKLOAD-START | Type: DataUpdateWorkload | Progress: 2/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/Naru/eval_model.py', '--model=face', '--data_update=valueskew', '--dataset=bjaq', '--drift_test=js', '--end2end', '--update_size=80000', '--query_seed=0', '--eval_type=drift']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
ValueSample - START
ValueSample - END
load_npy_dataset_from_path - df.shape = (458601, 5)
Parsing... done, took 0.0s
Data updated!
Previous data size: (382168, 5), new data size: (76433, 5)
[3.5762787e-07 1.4901161e-06 1.8327177e-02 5.9604645e-08 5.9604645e-08]
Distance score: 0.003665828611701727
SAUCE Drift detection: True
Detection latency: 0.0233s

DRIFT-DETECTED after 2-th workload
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/incremental_train.py', '--dataset=bjaq', '--end2end', '--model=face', '--model_update=adapt', '--update_size=80000', '--epochs=0']
Torch device: cuda:1
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
update_size: 76433
AdaptTask - START
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
train data shape: 80000, transfer data shape:16000
Training done; evaluating likelihood on full data:
Saved to: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
AdaptTask - END

WORKLOAD-FINISHED | Type: DataUpdateWorkload | Progress: 2/3 | Workload-time: 2.058318 | Model-update-time: 2.223827


WORKLOAD-START | Type: QueryWorkload | Progress: 3/3
Going to run: ['python', '/home/kangping/code_copy/SAUCE/FACE/evaluate/Evaluate-FACE-end2end.py', '--dataset=bjaq', '--query_seed=0', '--end2end', '--num_workload=3', '--data_update=valueskew', '--model_update=adapt']
/home/kangping/anaconda3/envs/LndCar/lib/python3.9/site-packages/torchquad/integration/vegas_map.py:314: UserWarning: torch.searchsorted(): input value tensor is non-contiguous, this will lower the performance due to extra data copy when converting non-contiguous tensor to contiguous, please use contiguous input value tensor if possible. This message will only appear once per program. (Triggered internally at /opt/conda/conda-bld/pytorch_1682343997789/work/aten/src/ATen/native/BucketizationUtils.h:33.)
  iy = torch.searchsorted(self.x_edges[d, :], x[:, d], side='right')
DEVICE NAME
 Tesla V100S-PCIE-32GB
GET-MODEL-PATH=./models/end2end/face/bjaq-id2-best-val.t
Load model - START
Load model from: /home/kangping/code_copy/SAUCE/models/end2end/face/bjaq-id2-best-val.t
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
Load model - END
There are 104179 trainable parameters in this model.
Parameters total size is 0.3974113464355469 MB
GET-DATASET-PATH=./data/bjaq/end2end/bjaq.npy
data shape: (458601, 5)
Save oracle results to :
./FACE/evaluate/oracle/bjaq_rng-0.csv
Found oracle card!
torch.Size([5, 2])
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
******** ANY
Took  8.16456413269043
tensor(0.9932)
result is  tensor(455464.8438)
Enter testHyper
ReportEsts: [1.6561256647109985, 1.1599373817443848, 1.0056657791137695, 1.0419143438339233, 1.1197998523712158, 1.1024154424667358, 1.1173465251922607, 1.3951225280761719, 1.12537682056427, 1.2270665168762207, 1.1012523174285889, 1.521559238433838, 1.2367758750915527, 1.29936683177948, 1.1374449729919434, 1.1015372276306152, 1.030495047569275, 1.3613711595535278, 1.0269392728805542, 1.0837458372116089, 1.0881271362304688, 1.1864327192306519, 2.529468536376953, 1.7335331439971924, 1.002847671508789, 1.3129398822784424, 1.1357743740081787, 1.2990443706512451, 1.3069543838500977, 1.1417384147644043, 1.0667966604232788, 1.4745762348175049, 1.014543890953064, 16.879322052001953, 1.0692815780639648, 1.0940972566604614, 1.4468345642089844, 1.012032151222229, 1.1517665386199951, 1.2779464721679688, 1.0907632112503052, 1.1966794729232788, 1.0631383657455444, 1.1214412450790405, 1.1447088718414307, 1.0090662240982056, 1.267220377922058, 1.057660698890686, 1.083665370941162, 7.718390941619873, 1.084303855895996, 1.1137231588363647, 1.2309373617172241, 1.2292009592056274, 1.0798215866088867, 3.4163193702697754, 1.3628602027893066, 1.095369815826416, 1.2621639966964722, 1.117079257965088, 1.2701421976089478, 1.1443933248519897, 1.2634804248809814, 1.58030366897583, 1.0903117656707764, 9.570539474487305, 1.073261022567749, 1.0950665473937988, 1.4298558235168457, 1.1031588315963745, 1.328597068786621, 1.1941190958023071, 1.1526044607162476, 1.018946886062622, 1.0551981925964355, 1.2439314126968384, 16.575313568115234, 1.0641025304794312, 1.0380315780639648, 1.1475005149841309, 1.180435299873352, 1.0817979574203491, 1.1497464179992676, 1.156253457069397, 1.3014925718307495, 1.3543859720230103, 1.2893387079238892, 1.5550522804260254, 1.1131261587142944, 1.1041280031204224, 1.1053167581558228, 1.1627075672149658, 1.555256962776184, 1.0892839431762695, 1.2402560710906982, 1.001597285270691, 1.660772681236267, 1.194792628288269, 1.3889814615249634, 1.2107542753219604, 1.2764512300491333, 1.0436292886734009, 1.1053920984268188, 1.3731859922409058, 1.022640347480774, 1.022117018699646, 1.0533208847045898, 1.1260480880737305, 1.014534831047058, 1.0516630411148071, 1.1254949569702148, 1.1159189939498901, 1.0440212488174438, 1.0317490100860596, 1.0104036331176758, 1.081373691558838, 1.1022839546203613, 1.2677607536315918, 1.0714621543884277, 1.0707964897155762, 1.108520269393921, 1.399999976158142, 1.0650784969329834, 3.653782367706299, 1.098921537399292, 1.0986729860305786, 1.1926289796829224, 1.0103857517242432, 1.2138792276382446, 1.0175578594207764, 1.235682487487793, 1.3564680814743042, 1.047061800956726, 1.0376765727996826, 1.1902086734771729, 1.1933245658874512, 1.1089394092559814, 1.07041335105896, 1.0713955163955688, 1.108801007270813, 1.1860401630401611, 1.0667632818222046, 1.2800074815750122, 1.107183814048767, 1.162148118019104, 1.1335562467575073, 1.47398841381073, 1.1903878450393677, 1.156896710395813, 1.1159201860427856, 10.476621627807617, 1.0119309425354004, 1.2339465618133545, 1.1545240879058838, 1.0516825914382935, 1.2531996965408325, 1.3818720579147339, 1.2879999876022339, 1.0432124137878418, 1.0006154775619507, 1.0009316205978394, 1.2412523031234741, 3.5962939262390137, 1.136354923248291, 1.064056396484375, 1.0239561796188354, 1.4341065883636475, 1.1999363899230957, 45.14967727661133, 1.3579270839691162, 1.3334795236587524, 1.1082814931869507, 1.7269076108932495, 1.0410031080245972, 1.1452528238296509, 1.051722764968872, 1.0642391443252563, 1.3770720958709717, 1.21086847782135, 1.0264430046081543, 1.7105263471603394, 1.2990314960479736, 1.474387526512146, 1.2267175912857056, 1.2955373525619507, 1.054980754852295, 1.3226940631866455, 1.045337438583374, 1.125185489654541, 1.952863335609436, 1.237640380859375, 1.0272022485733032, 1.0279698371887207, 1.6205250024795532, 1.1895829439163208, 1.04042649269104, 1.9659422636032104, 1.0502532720565796, 1.252730131149292, 1.174912691116333]
********** total_n=[200] batchn=[100]  N=[3200]  nitr=[4]  alpha=[0.4]  beta=[0.2] ******
@ Average per query          [3.7005198001861572] ms
 --  Average per query NF    [1.3536572456359863] ms
 --  Average per query vegas [2.346862554550171] ms
Mean [1.728]  Median [1.145]  95th [1.994]  99th [16.578]  max [45.150]
Mean [1.728]  Median [1.145]  95th [1.994]  99th [16.578]  max [45.150]


WORKLOAD-FINISHED | Type: QueryWorkload | Progress: 3/3 | Workload-time: 12.362523 | Model-update-time: 0.000000


Experiment Summary: #data-update-times=1, #drift=1 | total-time=28.518359